import { Construct, IConstruct } from './construct';
import { PhysicalName } from './physical-name';

/**
 * Interface for the Resource construct.
 */
export interface IResource extends IConstruct {
  /**
   * Returns the physical name, as a String.
   *
   * If the user assigned a physical name to the resource, it will be returned,
   * unchanged; can be `undefined`, if a physical name was not provided, or an
   * opaque Token, if a generated name should be assigned lazily at synthesis
   * time.
   */
  readonly physicalName: string;
}

/**
 * Construction properties for {@link Resource}.
 */
export interface ResourceProps {
  /**
   * The physical (that is, visible in the AWS Console) name of this resource.
   * By default, the name will be automatically generated by CloudFormation, at
   * deploy time.
   *
   * @default PhysicalName.auto()
   */
  readonly physicalName?: PhysicalName;
}

/**
 * A construct which represents an AWS resource.
 */
export abstract class Resource extends Construct implements IResource {
  private readonly _physicalName: PhysicalName;

  constructor(scope: Construct, id: string, props: ResourceProps = {}) {
    super(scope, id);

    this._physicalName = props.physicalName || PhysicalName.auto();
  }

  public get physicalName(): string {
    return this._physicalName.value;
  }

  /**
   * @internal
   */
  public _enableCrossEnvironment(): void {
    this._physicalName._resolveCrossEnvironment(this);
  }
}
