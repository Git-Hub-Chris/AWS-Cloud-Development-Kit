"use strict";
var _a;
Object.defineProperty(exports, "__esModule", { value: true });
exports.JobQueue = void 0;
const jsiiDeprecationWarnings = require("../.warnings.jsii.js");
const JSII_RTTI_SYMBOL_1 = Symbol.for("jsii.rtti");
const core_1 = require("aws-cdk-lib/core");
const aws_batch_1 = require("aws-cdk-lib/aws-batch");
/**
 * JobQueues can receive Jobs, which are removed from the queue when
 * sent to the linked ComputeEnvironment(s) to be executed.
 * Jobs exit the queue in FIFO order unless a `SchedulingPolicy` is linked.
 */
class JobQueue extends core_1.Resource {
    /**
     * refer to an existing JobQueue by its arn
     */
    static fromJobQueueArn(scope, id, jobQueueArn) {
        const stack = core_1.Stack.of(scope);
        class Import extends core_1.Resource {
            constructor() {
                super(...arguments);
                this.computeEnvironments = [];
                this.priority = 1;
                this.jobQueueArn = jobQueueArn;
                this.jobQueueName = stack.splitArn(jobQueueArn, core_1.ArnFormat.SLASH_RESOURCE_NAME).resourceName;
            }
            addComputeEnvironment(_computeEnvironment, _order) {
                throw new Error(`cannot add ComputeEnvironments to imported JobQueue '${id}'`);
            }
        }
        return new Import(scope, id);
    }
    constructor(scope, id, props) {
        super(scope, id, {
            physicalName: props?.jobQueueName,
        });
        try {
            jsiiDeprecationWarnings._aws_cdk_aws_batch_alpha_JobQueueProps(props);
        }
        catch (error) {
            if (process.env.JSII_DEBUG !== "1" && error.name === "DeprecationError") {
                Error.captureStackTrace(error, JobQueue);
            }
            throw error;
        }
        this.computeEnvironments = props?.computeEnvironments ?? [];
        this.priority = props?.priority ?? 1;
        this.enabled = props?.enabled;
        this.schedulingPolicy = props?.schedulingPolicy;
        const resource = new aws_batch_1.CfnJobQueue(this, 'Resource', {
            computeEnvironmentOrder: core_1.Lazy.any({
                produce: () => this.computeEnvironments.map((ce) => {
                    return {
                        computeEnvironment: ce.computeEnvironment.computeEnvironmentArn,
                        order: ce.order,
                    };
                }),
            }),
            priority: this.priority,
            jobQueueName: props?.jobQueueName,
            state: (this.enabled ?? true) ? 'ENABLED' : 'DISABLED',
            schedulingPolicyArn: this.schedulingPolicy?.schedulingPolicyArn,
        });
        this.jobQueueArn = this.getResourceArnAttribute(resource.attrJobQueueArn, {
            service: 'batch',
            resource: 'job-queue',
            resourceName: this.physicalName,
        });
        this.jobQueueName = core_1.Stack.of(this).splitArn(this.jobQueueArn, core_1.ArnFormat.SLASH_RESOURCE_NAME).resourceName;
        this.node.addValidation({ validate: () => validateOrderedComputeEnvironments(this.computeEnvironments) });
    }
    addComputeEnvironment(computeEnvironment, order) {
        try {
            jsiiDeprecationWarnings._aws_cdk_aws_batch_alpha_IComputeEnvironment(computeEnvironment);
        }
        catch (error) {
            if (process.env.JSII_DEBUG !== "1" && error.name === "DeprecationError") {
                Error.captureStackTrace(error, this.addComputeEnvironment);
            }
            throw error;
        }
        this.computeEnvironments.push({
            computeEnvironment,
            order,
        });
    }
}
exports.JobQueue = JobQueue;
_a = JSII_RTTI_SYMBOL_1;
JobQueue[_a] = { fqn: "@aws-cdk/aws-batch-alpha.JobQueue", version: "0.0.0" };
function validateOrderedComputeEnvironments(computeEnvironments) {
    const seenOrders = [];
    for (const ce of computeEnvironments) {
        if (seenOrders.includes(ce.order)) {
            return ['assigns the same order to different ComputeEnvironments'];
        }
        seenOrders.push(ce.order);
    }
    return seenOrders.length === 0 ? ['This JobQueue does not link any ComputeEnvironments'] : [];
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiam9iLXF1ZXVlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiam9iLXF1ZXVlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLDJDQUErRTtBQUUvRSxxREFBb0Q7QUF1SXBEOzs7O0dBSUc7QUFDSCxNQUFhLFFBQVMsU0FBUSxlQUFRO0lBQ3BDOztPQUVHO0lBQ0ksTUFBTSxDQUFDLGVBQWUsQ0FBQyxLQUFnQixFQUFFLEVBQVUsRUFBRSxXQUFtQjtRQUM3RSxNQUFNLEtBQUssR0FBRyxZQUFLLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQzlCLE1BQU0sTUFBTyxTQUFRLGVBQVE7WUFBN0I7O2dCQUNrQix3QkFBbUIsR0FBRyxFQUFFLENBQUM7Z0JBQ3pCLGFBQVEsR0FBRyxDQUFDLENBQUM7Z0JBQ2IsZ0JBQVcsR0FBRyxXQUFXLENBQUM7Z0JBQzFCLGlCQUFZLEdBQUcsS0FBSyxDQUFDLFFBQVEsQ0FBQyxXQUFXLEVBQUUsZ0JBQVMsQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDLFlBQWEsQ0FBQztZQUsxRyxDQUFDO1lBSFEscUJBQXFCLENBQUMsbUJBQXdDLEVBQUUsTUFBYztnQkFDbkYsTUFBTSxJQUFJLEtBQUssQ0FBQyx3REFBd0QsRUFBRSxHQUFHLENBQUMsQ0FBQztZQUNqRixDQUFDO1NBQ0Y7UUFFRCxPQUFPLElBQUksTUFBTSxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUMsQ0FBQztLQUM5QjtJQVVELFlBQVksS0FBZ0IsRUFBRSxFQUFVLEVBQUUsS0FBcUI7UUFDN0QsS0FBSyxDQUFDLEtBQUssRUFBRSxFQUFFLEVBQUU7WUFDZixZQUFZLEVBQUUsS0FBSyxFQUFFLFlBQVk7U0FDbEMsQ0FBQyxDQUFDOzs7Ozs7K0NBL0JNLFFBQVE7Ozs7UUFpQ2pCLElBQUksQ0FBQyxtQkFBbUIsR0FBRyxLQUFLLEVBQUUsbUJBQW1CLElBQUksRUFBRSxDQUFDO1FBQzVELElBQUksQ0FBQyxRQUFRLEdBQUcsS0FBSyxFQUFFLFFBQVEsSUFBSSxDQUFDLENBQUM7UUFDckMsSUFBSSxDQUFDLE9BQU8sR0FBRyxLQUFLLEVBQUUsT0FBTyxDQUFDO1FBQzlCLElBQUksQ0FBQyxnQkFBZ0IsR0FBRyxLQUFLLEVBQUUsZ0JBQWdCLENBQUM7UUFFaEQsTUFBTSxRQUFRLEdBQUcsSUFBSSx1QkFBVyxDQUFDLElBQUksRUFBRSxVQUFVLEVBQUU7WUFDakQsdUJBQXVCLEVBQUUsV0FBSSxDQUFDLEdBQUcsQ0FBQztnQkFDaEMsT0FBTyxFQUFFLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLEVBQUUsRUFBRTtvQkFDakQsT0FBTzt3QkFDTCxrQkFBa0IsRUFBRSxFQUFFLENBQUMsa0JBQWtCLENBQUMscUJBQXFCO3dCQUMvRCxLQUFLLEVBQUUsRUFBRSxDQUFDLEtBQUs7cUJBQ2hCLENBQUM7Z0JBQ0osQ0FBQyxDQUFDO2FBQ0gsQ0FBQztZQUNGLFFBQVEsRUFBRSxJQUFJLENBQUMsUUFBUTtZQUN2QixZQUFZLEVBQUUsS0FBSyxFQUFFLFlBQVk7WUFDakMsS0FBSyxFQUFFLENBQUMsSUFBSSxDQUFDLE9BQU8sSUFBSSxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxVQUFVO1lBQ3RELG1CQUFtQixFQUFFLElBQUksQ0FBQyxnQkFBZ0IsRUFBRSxtQkFBbUI7U0FDaEUsQ0FBQyxDQUFDO1FBRUgsSUFBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUMsdUJBQXVCLENBQUMsUUFBUSxDQUFDLGVBQWUsRUFBRTtZQUN4RSxPQUFPLEVBQUUsT0FBTztZQUNoQixRQUFRLEVBQUUsV0FBVztZQUNyQixZQUFZLEVBQUUsSUFBSSxDQUFDLFlBQVk7U0FDaEMsQ0FBQyxDQUFDO1FBQ0gsSUFBSSxDQUFDLFlBQVksR0FBRyxZQUFLLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsV0FBVyxFQUFFLGdCQUFTLENBQUMsbUJBQW1CLENBQUMsQ0FBQyxZQUFhLENBQUM7UUFFM0csSUFBSSxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsRUFBRSxRQUFRLEVBQUUsR0FBRyxFQUFFLENBQUMsa0NBQWtDLENBQUMsSUFBSSxDQUFDLG1CQUFtQixDQUFDLEVBQUUsQ0FBQyxDQUFDO0tBQzNHO0lBRUQscUJBQXFCLENBQUMsa0JBQXVDLEVBQUUsS0FBYTs7Ozs7Ozs7OztRQUMxRSxJQUFJLENBQUMsbUJBQW1CLENBQUMsSUFBSSxDQUFDO1lBQzVCLGtCQUFrQjtZQUNsQixLQUFLO1NBQ04sQ0FBQyxDQUFDO0tBQ0o7O0FBcEVILDRCQXFFQzs7O0FBRUQsU0FBUyxrQ0FBa0MsQ0FBQyxtQkFBZ0Q7SUFDMUYsTUFBTSxVQUFVLEdBQWEsRUFBRSxDQUFDO0lBRWhDLEtBQUssTUFBTSxFQUFFLElBQUksbUJBQW1CLEVBQUU7UUFDcEMsSUFBSSxVQUFVLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsRUFBRTtZQUNqQyxPQUFPLENBQUMseURBQXlELENBQUMsQ0FBQztTQUNwRTtRQUNELFVBQVUsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxDQUFDO0tBQzNCO0lBRUQsT0FBTyxVQUFVLENBQUMsTUFBTSxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxxREFBcUQsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7QUFDaEcsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFybkZvcm1hdCwgSVJlc291cmNlLCBMYXp5LCBSZXNvdXJjZSwgU3RhY2sgfSBmcm9tICdhd3MtY2RrLWxpYi9jb3JlJztcbmltcG9ydCB7IENvbnN0cnVjdCB9IGZyb20gJ2NvbnN0cnVjdHMnO1xuaW1wb3J0IHsgQ2ZuSm9iUXVldWUgfSBmcm9tICdhd3MtY2RrLWxpYi9hd3MtYmF0Y2gnO1xuaW1wb3J0IHsgSUNvbXB1dGVFbnZpcm9ubWVudCB9IGZyb20gJy4vY29tcHV0ZS1lbnZpcm9ubWVudC1iYXNlJztcbmltcG9ydCB7IElTY2hlZHVsaW5nUG9saWN5IH0gZnJvbSAnLi9zY2hlZHVsaW5nLXBvbGljeSc7XG5cbi8qKlxuICogUmVwcmVzZW50cyBhIEpvYlF1ZXVlXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgSUpvYlF1ZXVlIGV4dGVuZHMgSVJlc291cmNlIHtcbiAgLyoqXG4gICAqIFRoZSBuYW1lIG9mIHRoZSBqb2IgcXVldWUuIEl0IGNhbiBiZSB1cCB0byAxMjggbGV0dGVycyBsb25nLlxuICAgKiBJdCBjYW4gY29udGFpbiB1cHBlcmNhc2UgYW5kIGxvd2VyY2FzZSBsZXR0ZXJzLCBudW1iZXJzLCBoeXBoZW5zICgtKSwgYW5kIHVuZGVyc2NvcmVzIChfKVxuICAgKlxuICAgKiBAYXR0cmlidXRlXG4gICAqL1xuICByZWFkb25seSBqb2JRdWV1ZU5hbWU6IHN0cmluZ1xuXG4gIC8qKlxuICAgKiBUaGUgQVJOIG9mIHRoaXMgam9iIHF1ZXVlXG4gICAqXG4gICAqIEBhdHRyaWJ1dGVcbiAgICovXG4gIHJlYWRvbmx5IGpvYlF1ZXVlQXJuOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIFRoZSBzZXQgb2YgY29tcHV0ZSBlbnZpcm9ubWVudHMgbWFwcGVkIHRvIGEgam9iIHF1ZXVlIGFuZCB0aGVpciBvcmRlciByZWxhdGl2ZSB0byBlYWNoIG90aGVyLlxuICAgKiBUaGUgam9iIHNjaGVkdWxlciB1c2VzIHRoaXMgcGFyYW1ldGVyIHRvIGRldGVybWluZSB3aGljaCBjb21wdXRlIGVudmlyb25tZW50IHJ1bnMgYSBzcGVjaWZpYyBqb2IuXG4gICAqIENvbXB1dGUgZW52aXJvbm1lbnRzIG11c3QgYmUgaW4gdGhlIFZBTElEIHN0YXRlIGJlZm9yZSB5b3UgY2FuIGFzc29jaWF0ZSB0aGVtIHdpdGggYSBqb2IgcXVldWUuXG4gICAqIFlvdSBjYW4gYXNzb2NpYXRlIHVwIHRvIHRocmVlIGNvbXB1dGUgZW52aXJvbm1lbnRzIHdpdGggYSBqb2IgcXVldWUuXG4gICAqIEFsbCBvZiB0aGUgY29tcHV0ZSBlbnZpcm9ubWVudHMgbXVzdCBiZSBlaXRoZXIgRUMyIChFQzIgb3IgU1BPVCkgb3IgRmFyZ2F0ZSAoRkFSR0FURSBvciBGQVJHQVRFX1NQT1QpO1xuICAgKiBFQzIgYW5kIEZhcmdhdGUgY29tcHV0ZSBlbnZpcm9ubWVudHMgY2FuJ3QgYmUgbWl4ZWQuXG4gICAqXG4gICAqICpOb3RlKjogQWxsIGNvbXB1dGUgZW52aXJvbm1lbnRzIHRoYXQgYXJlIGFzc29jaWF0ZWQgd2l0aCBhIGpvYiBxdWV1ZSBtdXN0IHNoYXJlIHRoZSBzYW1lIGFyY2hpdGVjdHVyZS5cbiAgICogQVdTIEJhdGNoIGRvZXNuJ3Qgc3VwcG9ydCBtaXhpbmcgY29tcHV0ZSBlbnZpcm9ubWVudCBhcmNoaXRlY3R1cmUgdHlwZXMgaW4gYSBzaW5nbGUgam9iIHF1ZXVlLlxuICAgKi9cbiAgcmVhZG9ubHkgY29tcHV0ZUVudmlyb25tZW50czogT3JkZXJlZENvbXB1dGVFbnZpcm9ubWVudFtdXG5cbiAgLyoqXG4gICAqIFRoZSBwcmlvcml0eSBvZiB0aGUgam9iIHF1ZXVlLlxuICAgKiBKb2IgcXVldWVzIHdpdGggYSBoaWdoZXIgcHJpb3JpdHkgYXJlIGV2YWx1YXRlZCBmaXJzdCB3aGVuIGFzc29jaWF0ZWQgd2l0aCB0aGUgc2FtZSBjb21wdXRlIGVudmlyb25tZW50LlxuICAgKiBQcmlvcml0eSBpcyBkZXRlcm1pbmVkIGluIGRlc2NlbmRpbmcgb3JkZXIuXG4gICAqIEZvciBleGFtcGxlLCBhIGpvYiBxdWV1ZSB3aXRoIGEgcHJpb3JpdHkgdmFsdWUgb2YgMTAgaXMgZ2l2ZW4gc2NoZWR1bGluZyBwcmVmZXJlbmNlIG92ZXIgYSBqb2IgcXVldWUgd2l0aCBhIHByaW9yaXR5IHZhbHVlIG9mIDEuXG4gICAqL1xuICByZWFkb25seSBwcmlvcml0eTogbnVtYmVyXG5cbiAgLyoqXG4gICAqIElmIHRoZSBqb2IgcXVldWUgaXMgZW5hYmxlZCwgaXQgaXMgYWJsZSB0byBhY2NlcHQgam9icy5cbiAgICogT3RoZXJ3aXNlLCBuZXcgam9icyBjYW4ndCBiZSBhZGRlZCB0byB0aGUgcXVldWUsIGJ1dCBqb2JzIGFscmVhZHkgaW4gdGhlIHF1ZXVlIGNhbiBmaW5pc2guXG4gICAqXG4gICAqIEBkZWZhdWx0IHRydWVcbiAgICovXG4gIHJlYWRvbmx5IGVuYWJsZWQ/OiBib29sZWFuXG5cbiAgLyoqXG4gICAqIFRoZSBTY2hlZHVsaW5nUG9saWN5IGZvciB0aGlzIEpvYlF1ZXVlLiBJbnN0cnVjdHMgdGhlIFNjaGVkdWxlciBob3cgdG8gc2NoZWR1bGUgZGlmZmVyZW50IGpvYnMuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gbm8gc2NoZWR1bGluZyBwb2xpY3lcbiAgICovXG4gIHJlYWRvbmx5IHNjaGVkdWxpbmdQb2xpY3k/OiBJU2NoZWR1bGluZ1BvbGljeVxuXG4gIC8qKlxuICAgKiBBZGQgYSBgQ29tcHV0ZUVudmlyb25tZW50YCB0byB0aGlzIFF1ZXVlLlxuICAgKiBUaGUgUXVldWUgd2lsbCBwcmVmZXIgbG93ZXItb3JkZXIgYENvbXB1dGVFbnZpcm9ubWVudGBzLlxuICAgKi9cbiAgYWRkQ29tcHV0ZUVudmlyb25tZW50KGNvbXB1dGVFbnZpcm9ubWVudDogSUNvbXB1dGVFbnZpcm9ubWVudCwgb3JkZXI6IG51bWJlcik6IHZvaWQ7XG59XG5cbi8qKlxuICogUHJvcHMgdG8gY29uZmlndXJlIGEgSm9iUXVldWVcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBKb2JRdWV1ZVByb3BzIHtcbiAgLyoqXG4gICAqIFRoZSBzZXQgb2YgY29tcHV0ZSBlbnZpcm9ubWVudHMgbWFwcGVkIHRvIGEgam9iIHF1ZXVlIGFuZCB0aGVpciBvcmRlciByZWxhdGl2ZSB0byBlYWNoIG90aGVyLlxuICAgKiBUaGUgam9iIHNjaGVkdWxlciB1c2VzIHRoaXMgcGFyYW1ldGVyIHRvIGRldGVybWluZSB3aGljaCBjb21wdXRlIGVudmlyb25tZW50IHJ1bnMgYSBzcGVjaWZpYyBqb2IuXG4gICAqIENvbXB1dGUgZW52aXJvbm1lbnRzIG11c3QgYmUgaW4gdGhlIFZBTElEIHN0YXRlIGJlZm9yZSB5b3UgY2FuIGFzc29jaWF0ZSB0aGVtIHdpdGggYSBqb2IgcXVldWUuXG4gICAqIFlvdSBjYW4gYXNzb2NpYXRlIHVwIHRvIHRocmVlIGNvbXB1dGUgZW52aXJvbm1lbnRzIHdpdGggYSBqb2IgcXVldWUuXG4gICAqIEFsbCBvZiB0aGUgY29tcHV0ZSBlbnZpcm9ubWVudHMgbXVzdCBiZSBlaXRoZXIgRUMyIChFQzIgb3IgU1BPVCkgb3IgRmFyZ2F0ZSAoRkFSR0FURSBvciBGQVJHQVRFX1NQT1QpO1xuICAgKiBFQzIgYW5kIEZhcmdhdGUgY29tcHV0ZSBlbnZpcm9ubWVudHMgY2FuJ3QgYmUgbWl4ZWQuXG4gICAqXG4gICAqICpOb3RlKjogQWxsIGNvbXB1dGUgZW52aXJvbm1lbnRzIHRoYXQgYXJlIGFzc29jaWF0ZWQgd2l0aCBhIGpvYiBxdWV1ZSBtdXN0IHNoYXJlIHRoZSBzYW1lIGFyY2hpdGVjdHVyZS5cbiAgICogQVdTIEJhdGNoIGRvZXNuJ3Qgc3VwcG9ydCBtaXhpbmcgY29tcHV0ZSBlbnZpcm9ubWVudCBhcmNoaXRlY3R1cmUgdHlwZXMgaW4gYSBzaW5nbGUgam9iIHF1ZXVlLlxuICAgKlxuICAgKiBAZGVmYXVsdCBub25lXG4gICAqL1xuICByZWFkb25seSBjb21wdXRlRW52aXJvbm1lbnRzPzogT3JkZXJlZENvbXB1dGVFbnZpcm9ubWVudFtdXG5cbiAgLyoqXG4gICAqIFRoZSBwcmlvcml0eSBvZiB0aGUgam9iIHF1ZXVlLlxuICAgKiBKb2IgcXVldWVzIHdpdGggYSBoaWdoZXIgcHJpb3JpdHkgYXJlIGV2YWx1YXRlZCBmaXJzdCB3aGVuIGFzc29jaWF0ZWQgd2l0aCB0aGUgc2FtZSBjb21wdXRlIGVudmlyb25tZW50LlxuICAgKiBQcmlvcml0eSBpcyBkZXRlcm1pbmVkIGluIGRlc2NlbmRpbmcgb3JkZXIuXG4gICAqIEZvciBleGFtcGxlLCBhIGpvYiBxdWV1ZSB3aXRoIGEgcHJpb3JpdHkgb2YgMTAgaXMgZ2l2ZW4gc2NoZWR1bGluZyBwcmVmZXJlbmNlIG92ZXIgYSBqb2IgcXVldWUgd2l0aCBhIHByaW9yaXR5IG9mIDEuXG4gICAqXG4gICAqIEBkZWZhdWx0IDFcbiAgICovXG4gIHJlYWRvbmx5IHByaW9yaXR5PzogbnVtYmVyXG5cbiAgLyoqXG4gICAqIFRoZSBuYW1lIG9mIHRoZSBqb2IgcXVldWUuIEl0IGNhbiBiZSB1cCB0byAxMjggbGV0dGVycyBsb25nLlxuICAgKiBJdCBjYW4gY29udGFpbiB1cHBlcmNhc2UgYW5kIGxvd2VyY2FzZSBsZXR0ZXJzLCBudW1iZXJzLCBoeXBoZW5zICgtKSwgYW5kIHVuZGVyc2NvcmVzIChfKVxuICAgKlxuICAgKiBAZGVmYXVsdCAtIG5vIG5hbWVcbiAgICovXG4gIHJlYWRvbmx5IGpvYlF1ZXVlTmFtZT86IHN0cmluZ1xuXG4gIC8qKlxuICAgKiBJZiB0aGUgam9iIHF1ZXVlIGlzIGVuYWJsZWQsIGl0IGlzIGFibGUgdG8gYWNjZXB0IGpvYnMuXG4gICAqIE90aGVyd2lzZSwgbmV3IGpvYnMgY2FuJ3QgYmUgYWRkZWQgdG8gdGhlIHF1ZXVlLCBidXQgam9icyBhbHJlYWR5IGluIHRoZSBxdWV1ZSBjYW4gZmluaXNoLlxuICAgKlxuICAgKiBAZGVmYXVsdCB0cnVlXG4gICAqL1xuICByZWFkb25seSBlbmFibGVkPzogYm9vbGVhblxuXG4gIC8qKlxuICAgKiBUaGUgU2NoZWR1bGluZ1BvbGljeSBmb3IgdGhpcyBKb2JRdWV1ZS4gSW5zdHJ1Y3RzIHRoZSBTY2hlZHVsZXIgaG93IHRvIHNjaGVkdWxlIGRpZmZlcmVudCBqb2JzLlxuICAgKlxuICAgKiBAZGVmYXVsdCAtIG5vIHNjaGVkdWxpbmcgcG9saWN5XG4gICAqL1xuICByZWFkb25seSBzY2hlZHVsaW5nUG9saWN5PzogSVNjaGVkdWxpbmdQb2xpY3lcbn1cblxuLyoqXG4gKiBBc3NpZ25zIGFuIG9yZGVyIHRvIGEgQ29tcHV0ZUVudmlyb25tZW50LlxuICogVGhlIEpvYlF1ZXVlIHdpbGwgcHJpb3JpdGl6ZSB0aGUgbG93ZXN0LW9yZGVyIENvbXB1dGVFbnZpcm9ubWVudC5cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBPcmRlcmVkQ29tcHV0ZUVudmlyb25tZW50IHtcbiAgLyoqXG4gICAqIFRoZSBDb21wdXRlRW52aXJvbm1lbnQgdG8gbGluayB0byB0aGlzIEpvYlF1ZXVlXG4gICAqL1xuICByZWFkb25seSBjb21wdXRlRW52aXJvbm1lbnQ6IElDb21wdXRlRW52aXJvbm1lbnQ7XG5cbiAgLyoqXG4gICAqIFRoZSBvcmRlciBhc3NvY2lhdGVkIHdpdGggYGNvbXB1dGVFbnZpcm9ubWVudGBcbiAgICovXG4gIHJlYWRvbmx5IG9yZGVyOiBudW1iZXI7XG59XG5cbi8qKlxuICogSm9iUXVldWVzIGNhbiByZWNlaXZlIEpvYnMsIHdoaWNoIGFyZSByZW1vdmVkIGZyb20gdGhlIHF1ZXVlIHdoZW5cbiAqIHNlbnQgdG8gdGhlIGxpbmtlZCBDb21wdXRlRW52aXJvbm1lbnQocykgdG8gYmUgZXhlY3V0ZWQuXG4gKiBKb2JzIGV4aXQgdGhlIHF1ZXVlIGluIEZJRk8gb3JkZXIgdW5sZXNzIGEgYFNjaGVkdWxpbmdQb2xpY3lgIGlzIGxpbmtlZC5cbiAqL1xuZXhwb3J0IGNsYXNzIEpvYlF1ZXVlIGV4dGVuZHMgUmVzb3VyY2UgaW1wbGVtZW50cyBJSm9iUXVldWUge1xuICAvKipcbiAgICogcmVmZXIgdG8gYW4gZXhpc3RpbmcgSm9iUXVldWUgYnkgaXRzIGFyblxuICAgKi9cbiAgcHVibGljIHN0YXRpYyBmcm9tSm9iUXVldWVBcm4oc2NvcGU6IENvbnN0cnVjdCwgaWQ6IHN0cmluZywgam9iUXVldWVBcm46IHN0cmluZyk6IElKb2JRdWV1ZSB7XG4gICAgY29uc3Qgc3RhY2sgPSBTdGFjay5vZihzY29wZSk7XG4gICAgY2xhc3MgSW1wb3J0IGV4dGVuZHMgUmVzb3VyY2UgaW1wbGVtZW50cyBJSm9iUXVldWUge1xuICAgICAgcHVibGljIHJlYWRvbmx5IGNvbXB1dGVFbnZpcm9ubWVudHMgPSBbXTtcbiAgICAgIHB1YmxpYyByZWFkb25seSBwcmlvcml0eSA9IDE7XG4gICAgICBwdWJsaWMgcmVhZG9ubHkgam9iUXVldWVBcm4gPSBqb2JRdWV1ZUFybjtcbiAgICAgIHB1YmxpYyByZWFkb25seSBqb2JRdWV1ZU5hbWUgPSBzdGFjay5zcGxpdEFybihqb2JRdWV1ZUFybiwgQXJuRm9ybWF0LlNMQVNIX1JFU09VUkNFX05BTUUpLnJlc291cmNlTmFtZSE7XG5cbiAgICAgIHB1YmxpYyBhZGRDb21wdXRlRW52aXJvbm1lbnQoX2NvbXB1dGVFbnZpcm9ubWVudDogSUNvbXB1dGVFbnZpcm9ubWVudCwgX29yZGVyOiBudW1iZXIpOiB2b2lkIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBjYW5ub3QgYWRkIENvbXB1dGVFbnZpcm9ubWVudHMgdG8gaW1wb3J0ZWQgSm9iUXVldWUgJyR7aWR9J2ApO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBuZXcgSW1wb3J0KHNjb3BlLCBpZCk7XG4gIH1cblxuICBwdWJsaWMgcmVhZG9ubHkgY29tcHV0ZUVudmlyb25tZW50czogT3JkZXJlZENvbXB1dGVFbnZpcm9ubWVudFtdXG4gIHB1YmxpYyByZWFkb25seSBwcmlvcml0eTogbnVtYmVyXG4gIHB1YmxpYyByZWFkb25seSBlbmFibGVkPzogYm9vbGVhblxuICBwdWJsaWMgcmVhZG9ubHkgc2NoZWR1bGluZ1BvbGljeT86IElTY2hlZHVsaW5nUG9saWN5XG5cbiAgcHVibGljIHJlYWRvbmx5IGpvYlF1ZXVlQXJuOiBzdHJpbmc7XG4gIHB1YmxpYyByZWFkb25seSBqb2JRdWV1ZU5hbWU6IHN0cmluZztcblxuICBjb25zdHJ1Y3RvcihzY29wZTogQ29uc3RydWN0LCBpZDogc3RyaW5nLCBwcm9wcz86IEpvYlF1ZXVlUHJvcHMpIHtcbiAgICBzdXBlcihzY29wZSwgaWQsIHtcbiAgICAgIHBoeXNpY2FsTmFtZTogcHJvcHM/LmpvYlF1ZXVlTmFtZSxcbiAgICB9KTtcblxuICAgIHRoaXMuY29tcHV0ZUVudmlyb25tZW50cyA9IHByb3BzPy5jb21wdXRlRW52aXJvbm1lbnRzID8/IFtdO1xuICAgIHRoaXMucHJpb3JpdHkgPSBwcm9wcz8ucHJpb3JpdHkgPz8gMTtcbiAgICB0aGlzLmVuYWJsZWQgPSBwcm9wcz8uZW5hYmxlZDtcbiAgICB0aGlzLnNjaGVkdWxpbmdQb2xpY3kgPSBwcm9wcz8uc2NoZWR1bGluZ1BvbGljeTtcblxuICAgIGNvbnN0IHJlc291cmNlID0gbmV3IENmbkpvYlF1ZXVlKHRoaXMsICdSZXNvdXJjZScsIHtcbiAgICAgIGNvbXB1dGVFbnZpcm9ubWVudE9yZGVyOiBMYXp5LmFueSh7XG4gICAgICAgIHByb2R1Y2U6ICgpID0+IHRoaXMuY29tcHV0ZUVudmlyb25tZW50cy5tYXAoKGNlKSA9PiB7XG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGNvbXB1dGVFbnZpcm9ubWVudDogY2UuY29tcHV0ZUVudmlyb25tZW50LmNvbXB1dGVFbnZpcm9ubWVudEFybixcbiAgICAgICAgICAgIG9yZGVyOiBjZS5vcmRlcixcbiAgICAgICAgICB9O1xuICAgICAgICB9KSxcbiAgICAgIH0pLFxuICAgICAgcHJpb3JpdHk6IHRoaXMucHJpb3JpdHksXG4gICAgICBqb2JRdWV1ZU5hbWU6IHByb3BzPy5qb2JRdWV1ZU5hbWUsXG4gICAgICBzdGF0ZTogKHRoaXMuZW5hYmxlZCA/PyB0cnVlKSA/ICdFTkFCTEVEJyA6ICdESVNBQkxFRCcsXG4gICAgICBzY2hlZHVsaW5nUG9saWN5QXJuOiB0aGlzLnNjaGVkdWxpbmdQb2xpY3k/LnNjaGVkdWxpbmdQb2xpY3lBcm4sXG4gICAgfSk7XG5cbiAgICB0aGlzLmpvYlF1ZXVlQXJuID0gdGhpcy5nZXRSZXNvdXJjZUFybkF0dHJpYnV0ZShyZXNvdXJjZS5hdHRySm9iUXVldWVBcm4sIHtcbiAgICAgIHNlcnZpY2U6ICdiYXRjaCcsXG4gICAgICByZXNvdXJjZTogJ2pvYi1xdWV1ZScsXG4gICAgICByZXNvdXJjZU5hbWU6IHRoaXMucGh5c2ljYWxOYW1lLFxuICAgIH0pO1xuICAgIHRoaXMuam9iUXVldWVOYW1lID0gU3RhY2sub2YodGhpcykuc3BsaXRBcm4odGhpcy5qb2JRdWV1ZUFybiwgQXJuRm9ybWF0LlNMQVNIX1JFU09VUkNFX05BTUUpLnJlc291cmNlTmFtZSE7XG5cbiAgICB0aGlzLm5vZGUuYWRkVmFsaWRhdGlvbih7IHZhbGlkYXRlOiAoKSA9PiB2YWxpZGF0ZU9yZGVyZWRDb21wdXRlRW52aXJvbm1lbnRzKHRoaXMuY29tcHV0ZUVudmlyb25tZW50cykgfSk7XG4gIH1cblxuICBhZGRDb21wdXRlRW52aXJvbm1lbnQoY29tcHV0ZUVudmlyb25tZW50OiBJQ29tcHV0ZUVudmlyb25tZW50LCBvcmRlcjogbnVtYmVyKTogdm9pZCB7XG4gICAgdGhpcy5jb21wdXRlRW52aXJvbm1lbnRzLnB1c2goe1xuICAgICAgY29tcHV0ZUVudmlyb25tZW50LFxuICAgICAgb3JkZXIsXG4gICAgfSk7XG4gIH1cbn1cblxuZnVuY3Rpb24gdmFsaWRhdGVPcmRlcmVkQ29tcHV0ZUVudmlyb25tZW50cyhjb21wdXRlRW52aXJvbm1lbnRzOiBPcmRlcmVkQ29tcHV0ZUVudmlyb25tZW50W10pOiBzdHJpbmdbXSB7XG4gIGNvbnN0IHNlZW5PcmRlcnM6IG51bWJlcltdID0gW107XG5cbiAgZm9yIChjb25zdCBjZSBvZiBjb21wdXRlRW52aXJvbm1lbnRzKSB7XG4gICAgaWYgKHNlZW5PcmRlcnMuaW5jbHVkZXMoY2Uub3JkZXIpKSB7XG4gICAgICByZXR1cm4gWydhc3NpZ25zIHRoZSBzYW1lIG9yZGVyIHRvIGRpZmZlcmVudCBDb21wdXRlRW52aXJvbm1lbnRzJ107XG4gICAgfVxuICAgIHNlZW5PcmRlcnMucHVzaChjZS5vcmRlcik7XG4gIH1cblxuICByZXR1cm4gc2Vlbk9yZGVycy5sZW5ndGggPT09IDAgPyBbJ1RoaXMgSm9iUXVldWUgZG9lcyBub3QgbGluayBhbnkgQ29tcHV0ZUVudmlyb25tZW50cyddIDogW107XG59XG4iXX0=