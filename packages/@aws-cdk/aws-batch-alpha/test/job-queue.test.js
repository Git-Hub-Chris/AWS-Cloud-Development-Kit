"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const assertions_1 = require("aws-cdk-lib/assertions");
const aws_cdk_lib_1 = require("aws-cdk-lib");
const ec2 = require("aws-cdk-lib/aws-ec2");
const lib_1 = require("../lib");
test('JobQueue respects computeEnvironments', () => {
    // GIVEN
    const stack = new aws_cdk_lib_1.Stack();
    const vpc = new ec2.Vpc(stack, 'vpc');
    // WHEN
    new lib_1.JobQueue(stack, 'joBBQ', {
        computeEnvironments: [{
                computeEnvironment: new lib_1.ManagedEc2EcsComputeEnvironment(stack, 'CE', {
                    vpc,
                }),
                order: 1,
            }],
        priority: 10,
    });
    // THEN
    assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::Batch::JobQueue', {
        ComputeEnvironmentOrder: [{
                ComputeEnvironment: { 'Fn::GetAtt': ['CE1BFE03A1', 'ComputeEnvironmentArn'] },
                Order: 1,
            }],
        Priority: 10,
        State: 'ENABLED',
    });
});
test('JobQueue respects enabled', () => {
    // GIVEN
    const stack = new aws_cdk_lib_1.Stack();
    const vpc = new ec2.Vpc(stack, 'vpc');
    // WHEN
    new lib_1.JobQueue(stack, 'joBBQ', {
        computeEnvironments: [{
                computeEnvironment: new lib_1.ManagedEc2EcsComputeEnvironment(stack, 'CE', {
                    vpc,
                }),
                order: 1,
            }],
        priority: 10,
        enabled: false,
    });
    // THEN
    assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::Batch::JobQueue', {
        ComputeEnvironmentOrder: [{
                ComputeEnvironment: { 'Fn::GetAtt': ['CE1BFE03A1', 'ComputeEnvironmentArn'] },
                Order: 1,
            }],
        Priority: 10,
        State: 'DISABLED',
    });
});
test('JobQueue respects name', () => {
    // GIVEN
    const stack = new aws_cdk_lib_1.Stack();
    const vpc = new ec2.Vpc(stack, 'vpc');
    // WHEN
    new lib_1.JobQueue(stack, 'joBBQ', {
        computeEnvironments: [{
                computeEnvironment: new lib_1.ManagedEc2EcsComputeEnvironment(stack, 'CE', {
                    vpc,
                }),
                order: 1,
            }],
        priority: 10,
        jobQueueName: 'JoBBQ',
    });
    // THEN
    assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::Batch::JobQueue', {
        ComputeEnvironmentOrder: [{
                ComputeEnvironment: { 'Fn::GetAtt': ['CE1BFE03A1', 'ComputeEnvironmentArn'] },
                Order: 1,
            }],
        Priority: 10,
        JobQueueName: 'JoBBQ',
    });
});
test('JobQueue name is parsed from arn', () => {
    // GIVEN
    const stack = new aws_cdk_lib_1.Stack();
    const vpc = new ec2.Vpc(stack, 'vpc');
    // WHEN
    const queue = new lib_1.JobQueue(stack, 'joBBQ', {
        computeEnvironments: [{
                computeEnvironment: new lib_1.ManagedEc2EcsComputeEnvironment(stack, 'CE', {
                    vpc,
                }),
                order: 1,
            }],
        priority: 10,
        jobQueueName: 'JoBBQ',
    });
    // THEN
    expect(aws_cdk_lib_1.Tokenization.resolve(queue.jobQueueName, {
        scope: stack,
        resolver: new aws_cdk_lib_1.DefaultTokenResolver(new aws_cdk_lib_1.StringConcat()),
    })).toEqual({
        'Fn::Select': [
            1,
            {
                'Fn::Split': [
                    '/',
                    {
                        'Fn::Select': [
                            5,
                            {
                                'Fn::Split': [
                                    ':',
                                    {
                                        'Fn::GetAtt': [
                                            'joBBQ9FD52DAF',
                                            'JobQueueArn',
                                        ],
                                    },
                                ],
                            },
                        ],
                    },
                ],
            },
        ],
    });
});
test('JobQueue respects schedulingPolicy', () => {
    // GIVEN
    const stack = new aws_cdk_lib_1.Stack();
    const vpc = new ec2.Vpc(stack, 'vpc');
    // WHEN
    new lib_1.JobQueue(stack, 'JobQueue', {
        computeEnvironments: [{
                computeEnvironment: new lib_1.ManagedEc2EcsComputeEnvironment(stack, 'CE', {
                    vpc,
                }),
                order: 1,
            }],
        priority: 10,
        schedulingPolicy: new lib_1.FairshareSchedulingPolicy(stack, 'FairsharePolicy'),
    });
    // THEN
    assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::Batch::JobQueue', {
        ComputeEnvironmentOrder: [{
                ComputeEnvironment: { 'Fn::GetAtt': ['CE1BFE03A1', 'ComputeEnvironmentArn'] },
                Order: 1,
            }],
        Priority: 10,
        SchedulingPolicyArn: {
            'Fn::GetAtt': ['FairsharePolicyA0C549BE', 'Arn'],
        },
    });
});
test('JobQueue respects addComputeEnvironment', () => {
    // GIVEN
    const stack = new aws_cdk_lib_1.Stack();
    const vpc = new ec2.Vpc(stack, 'vpc');
    // WHEN
    const queue = new lib_1.JobQueue(stack, 'JobQueue', {
        computeEnvironments: [{
                computeEnvironment: new lib_1.ManagedEc2EcsComputeEnvironment(stack, 'FirstCE', {
                    vpc,
                }),
                order: 1,
            }],
        priority: 10,
        schedulingPolicy: new lib_1.FairshareSchedulingPolicy(stack, 'FairsharePolicy'),
    });
    queue.addComputeEnvironment(new lib_1.ManagedEc2EcsComputeEnvironment(stack, 'SecondCE', {
        vpc,
    }), 2);
    // THEN
    assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::Batch::JobQueue', {
        ComputeEnvironmentOrder: [
            {
                ComputeEnvironment: { 'Fn::GetAtt': ['FirstCEAD3794AD', 'ComputeEnvironmentArn'] },
                Order: 1,
            },
            {
                ComputeEnvironment: { 'Fn::GetAtt': ['SecondCEEBA93938', 'ComputeEnvironmentArn'] },
                Order: 2,
            },
        ],
        Priority: 10,
        SchedulingPolicyArn: {
            'Fn::GetAtt': ['FairsharePolicyA0C549BE', 'Arn'],
        },
    });
});
test('can be imported from ARN', () => {
    // GIVEN
    const stack = new aws_cdk_lib_1.Stack();
    // WHEN
    const queue = lib_1.JobQueue.fromJobQueueArn(stack, 'importedJobQueue', 'arn:aws:batch:us-east-1:123456789012:job-queue/importedJobQueue');
    // THEN
    expect(queue.jobQueueArn).toEqual('arn:aws:batch:us-east-1:123456789012:job-queue/importedJobQueue');
});
test('JobQueue throws when the same order is assigned to multiple ComputeEnvironments', () => {
    // GIVEN
    const stack = new aws_cdk_lib_1.Stack();
    const vpc = new ec2.Vpc(stack, 'vpc');
    // WHEN
    const joBBQ = new lib_1.JobQueue(stack, 'joBBQ', {
        computeEnvironments: [{
                computeEnvironment: new lib_1.ManagedEc2EcsComputeEnvironment(stack, 'FirstCE', {
                    vpc,
                }),
                order: 1,
            }],
        priority: 10,
    });
    joBBQ.addComputeEnvironment(new lib_1.ManagedEc2EcsComputeEnvironment(stack, 'SecondCE', {
        vpc,
    }), 1);
    expect(() => {
        assertions_1.Template.fromStack(stack);
    }).toThrow(/assigns the same order to different ComputeEnvironments/);
});
test('JobQueue throws when there are no linked ComputeEnvironments', () => {
    // GIVEN
    const stack = new aws_cdk_lib_1.Stack();
    // WHEN
    new lib_1.JobQueue(stack, 'joBBQ');
    expect(() => {
        assertions_1.Template.fromStack(stack);
    }).toThrow(/This JobQueue does not link any ComputeEnvironments/);
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiam9iLXF1ZXVlLnRlc3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJqb2ItcXVldWUudGVzdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLHVEQUFrRDtBQUNsRCw2Q0FBc0Y7QUFDdEYsMkNBQTJDO0FBQzNDLGdDQUE4RjtBQUU5RixJQUFJLENBQUMsdUNBQXVDLEVBQUUsR0FBRyxFQUFFO0lBQ2pELFFBQVE7SUFDUixNQUFNLEtBQUssR0FBRyxJQUFJLG1CQUFLLEVBQUUsQ0FBQztJQUMxQixNQUFNLEdBQUcsR0FBRyxJQUFJLEdBQUcsQ0FBQyxHQUFHLENBQUMsS0FBSyxFQUFFLEtBQUssQ0FBQyxDQUFDO0lBRXRDLE9BQU87SUFDUCxJQUFJLGNBQVEsQ0FBQyxLQUFLLEVBQUUsT0FBTyxFQUFFO1FBQzNCLG1CQUFtQixFQUFFLENBQUM7Z0JBQ3BCLGtCQUFrQixFQUFFLElBQUkscUNBQStCLENBQUMsS0FBSyxFQUFFLElBQUksRUFBRTtvQkFDbkUsR0FBRztpQkFDSixDQUFDO2dCQUNGLEtBQUssRUFBRSxDQUFDO2FBQ1QsQ0FBQztRQUNGLFFBQVEsRUFBRSxFQUFFO0tBQ2IsQ0FBQyxDQUFDO0lBRUgsT0FBTztJQUNQLHFCQUFRLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDLHFCQUFxQixDQUFDLHNCQUFzQixFQUFFO1FBQ3RFLHVCQUF1QixFQUFFLENBQUM7Z0JBQ3hCLGtCQUFrQixFQUFFLEVBQUUsWUFBWSxFQUFFLENBQUMsWUFBWSxFQUFFLHVCQUF1QixDQUFDLEVBQUU7Z0JBQzdFLEtBQUssRUFBRSxDQUFDO2FBQ1QsQ0FBQztRQUNGLFFBQVEsRUFBRSxFQUFFO1FBQ1osS0FBSyxFQUFFLFNBQVM7S0FDakIsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUM7QUFFSCxJQUFJLENBQUMsMkJBQTJCLEVBQUUsR0FBRyxFQUFFO0lBQ3JDLFFBQVE7SUFDUixNQUFNLEtBQUssR0FBRyxJQUFJLG1CQUFLLEVBQUUsQ0FBQztJQUMxQixNQUFNLEdBQUcsR0FBRyxJQUFJLEdBQUcsQ0FBQyxHQUFHLENBQUMsS0FBSyxFQUFFLEtBQUssQ0FBQyxDQUFDO0lBRXRDLE9BQU87SUFDUCxJQUFJLGNBQVEsQ0FBQyxLQUFLLEVBQUUsT0FBTyxFQUFFO1FBQzNCLG1CQUFtQixFQUFFLENBQUM7Z0JBQ3BCLGtCQUFrQixFQUFFLElBQUkscUNBQStCLENBQUMsS0FBSyxFQUFFLElBQUksRUFBRTtvQkFDbkUsR0FBRztpQkFDSixDQUFDO2dCQUNGLEtBQUssRUFBRSxDQUFDO2FBQ1QsQ0FBQztRQUNGLFFBQVEsRUFBRSxFQUFFO1FBQ1osT0FBTyxFQUFFLEtBQUs7S0FDZixDQUFDLENBQUM7SUFFSCxPQUFPO0lBQ1AscUJBQVEsQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUMscUJBQXFCLENBQUMsc0JBQXNCLEVBQUU7UUFDdEUsdUJBQXVCLEVBQUUsQ0FBQztnQkFDeEIsa0JBQWtCLEVBQUUsRUFBRSxZQUFZLEVBQUUsQ0FBQyxZQUFZLEVBQUUsdUJBQXVCLENBQUMsRUFBRTtnQkFDN0UsS0FBSyxFQUFFLENBQUM7YUFDVCxDQUFDO1FBQ0YsUUFBUSxFQUFFLEVBQUU7UUFDWixLQUFLLEVBQUUsVUFBVTtLQUNsQixDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQztBQUVILElBQUksQ0FBQyx3QkFBd0IsRUFBRSxHQUFHLEVBQUU7SUFDbEMsUUFBUTtJQUNSLE1BQU0sS0FBSyxHQUFHLElBQUksbUJBQUssRUFBRSxDQUFDO0lBQzFCLE1BQU0sR0FBRyxHQUFHLElBQUksR0FBRyxDQUFDLEdBQUcsQ0FBQyxLQUFLLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFFdEMsT0FBTztJQUNQLElBQUksY0FBUSxDQUFDLEtBQUssRUFBRSxPQUFPLEVBQUU7UUFDM0IsbUJBQW1CLEVBQUUsQ0FBQztnQkFDcEIsa0JBQWtCLEVBQUUsSUFBSSxxQ0FBK0IsQ0FBQyxLQUFLLEVBQUUsSUFBSSxFQUFFO29CQUNuRSxHQUFHO2lCQUNKLENBQUM7Z0JBQ0YsS0FBSyxFQUFFLENBQUM7YUFDVCxDQUFDO1FBQ0YsUUFBUSxFQUFFLEVBQUU7UUFDWixZQUFZLEVBQUUsT0FBTztLQUN0QixDQUFDLENBQUM7SUFFSCxPQUFPO0lBQ1AscUJBQVEsQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUMscUJBQXFCLENBQUMsc0JBQXNCLEVBQUU7UUFDdEUsdUJBQXVCLEVBQUUsQ0FBQztnQkFDeEIsa0JBQWtCLEVBQUUsRUFBRSxZQUFZLEVBQUUsQ0FBQyxZQUFZLEVBQUUsdUJBQXVCLENBQUMsRUFBRTtnQkFDN0UsS0FBSyxFQUFFLENBQUM7YUFDVCxDQUFDO1FBQ0YsUUFBUSxFQUFFLEVBQUU7UUFDWixZQUFZLEVBQUUsT0FBTztLQUN0QixDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQztBQUVILElBQUksQ0FBQyxrQ0FBa0MsRUFBRSxHQUFHLEVBQUU7SUFDNUMsUUFBUTtJQUNSLE1BQU0sS0FBSyxHQUFHLElBQUksbUJBQUssRUFBRSxDQUFDO0lBQzFCLE1BQU0sR0FBRyxHQUFHLElBQUksR0FBRyxDQUFDLEdBQUcsQ0FBQyxLQUFLLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFFdEMsT0FBTztJQUNQLE1BQU0sS0FBSyxHQUFHLElBQUksY0FBUSxDQUFDLEtBQUssRUFBRSxPQUFPLEVBQUU7UUFDekMsbUJBQW1CLEVBQUUsQ0FBQztnQkFDcEIsa0JBQWtCLEVBQUUsSUFBSSxxQ0FBK0IsQ0FBQyxLQUFLLEVBQUUsSUFBSSxFQUFFO29CQUNuRSxHQUFHO2lCQUNKLENBQUM7Z0JBQ0YsS0FBSyxFQUFFLENBQUM7YUFDVCxDQUFDO1FBQ0YsUUFBUSxFQUFFLEVBQUU7UUFDWixZQUFZLEVBQUUsT0FBTztLQUN0QixDQUFDLENBQUM7SUFFSCxPQUFPO0lBQ1AsTUFBTSxDQUFDLDBCQUFZLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxZQUFZLEVBQUU7UUFDOUMsS0FBSyxFQUFFLEtBQUs7UUFDWixRQUFRLEVBQUUsSUFBSSxrQ0FBb0IsQ0FBQyxJQUFJLDBCQUFZLEVBQUUsQ0FBQztLQUN2RCxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUM7UUFDVixZQUFZLEVBQUU7WUFDWixDQUFDO1lBQ0Q7Z0JBQ0UsV0FBVyxFQUFFO29CQUNYLEdBQUc7b0JBQ0g7d0JBQ0UsWUFBWSxFQUFFOzRCQUNaLENBQUM7NEJBQ0Q7Z0NBQ0UsV0FBVyxFQUFFO29DQUNYLEdBQUc7b0NBQ0g7d0NBQ0UsWUFBWSxFQUFFOzRDQUNaLGVBQWU7NENBQ2YsYUFBYTt5Q0FDZDtxQ0FDRjtpQ0FDRjs2QkFDRjt5QkFDRjtxQkFDRjtpQkFDRjthQUNGO1NBQ0Y7S0FDRixDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQztBQUVILElBQUksQ0FBQyxvQ0FBb0MsRUFBRSxHQUFHLEVBQUU7SUFDOUMsUUFBUTtJQUNSLE1BQU0sS0FBSyxHQUFHLElBQUksbUJBQUssRUFBRSxDQUFDO0lBQzFCLE1BQU0sR0FBRyxHQUFHLElBQUksR0FBRyxDQUFDLEdBQUcsQ0FBQyxLQUFLLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFFdEMsT0FBTztJQUNQLElBQUksY0FBUSxDQUFDLEtBQUssRUFBRSxVQUFVLEVBQUU7UUFDOUIsbUJBQW1CLEVBQUUsQ0FBQztnQkFDcEIsa0JBQWtCLEVBQUUsSUFBSSxxQ0FBK0IsQ0FBQyxLQUFLLEVBQUUsSUFBSSxFQUFFO29CQUNuRSxHQUFHO2lCQUNKLENBQUM7Z0JBQ0YsS0FBSyxFQUFFLENBQUM7YUFDVCxDQUFDO1FBQ0YsUUFBUSxFQUFFLEVBQUU7UUFDWixnQkFBZ0IsRUFBRSxJQUFJLCtCQUF5QixDQUFDLEtBQUssRUFBRSxpQkFBaUIsQ0FBQztLQUMxRSxDQUFDLENBQUM7SUFFSCxPQUFPO0lBQ1AscUJBQVEsQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUMscUJBQXFCLENBQUMsc0JBQXNCLEVBQUU7UUFDdEUsdUJBQXVCLEVBQUUsQ0FBQztnQkFDeEIsa0JBQWtCLEVBQUUsRUFBRSxZQUFZLEVBQUUsQ0FBQyxZQUFZLEVBQUUsdUJBQXVCLENBQUMsRUFBRTtnQkFDN0UsS0FBSyxFQUFFLENBQUM7YUFDVCxDQUFDO1FBQ0YsUUFBUSxFQUFFLEVBQUU7UUFDWixtQkFBbUIsRUFBRTtZQUNuQixZQUFZLEVBQUUsQ0FBQyx5QkFBeUIsRUFBRSxLQUFLLENBQUM7U0FDakQ7S0FDRixDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQztBQUVILElBQUksQ0FBQyx5Q0FBeUMsRUFBRSxHQUFHLEVBQUU7SUFDbkQsUUFBUTtJQUNSLE1BQU0sS0FBSyxHQUFHLElBQUksbUJBQUssRUFBRSxDQUFDO0lBQzFCLE1BQU0sR0FBRyxHQUFHLElBQUksR0FBRyxDQUFDLEdBQUcsQ0FBQyxLQUFLLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFFdEMsT0FBTztJQUNQLE1BQU0sS0FBSyxHQUFHLElBQUksY0FBUSxDQUFDLEtBQUssRUFBRSxVQUFVLEVBQUU7UUFDNUMsbUJBQW1CLEVBQUUsQ0FBQztnQkFDcEIsa0JBQWtCLEVBQUUsSUFBSSxxQ0FBK0IsQ0FBQyxLQUFLLEVBQUUsU0FBUyxFQUFFO29CQUN4RSxHQUFHO2lCQUNKLENBQUM7Z0JBQ0YsS0FBSyxFQUFFLENBQUM7YUFDVCxDQUFDO1FBQ0YsUUFBUSxFQUFFLEVBQUU7UUFDWixnQkFBZ0IsRUFBRSxJQUFJLCtCQUF5QixDQUFDLEtBQUssRUFBRSxpQkFBaUIsQ0FBQztLQUMxRSxDQUFDLENBQUM7SUFFSCxLQUFLLENBQUMscUJBQXFCLENBQ3pCLElBQUkscUNBQStCLENBQUMsS0FBSyxFQUFFLFVBQVUsRUFBRTtRQUNyRCxHQUFHO0tBQ0osQ0FBQyxFQUNGLENBQUMsQ0FDRixDQUFDO0lBRUYsT0FBTztJQUNQLHFCQUFRLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDLHFCQUFxQixDQUFDLHNCQUFzQixFQUFFO1FBQ3RFLHVCQUF1QixFQUFFO1lBQ3ZCO2dCQUNFLGtCQUFrQixFQUFFLEVBQUUsWUFBWSxFQUFFLENBQUMsaUJBQWlCLEVBQUUsdUJBQXVCLENBQUMsRUFBRTtnQkFDbEYsS0FBSyxFQUFFLENBQUM7YUFDVDtZQUNEO2dCQUNFLGtCQUFrQixFQUFFLEVBQUUsWUFBWSxFQUFFLENBQUMsa0JBQWtCLEVBQUUsdUJBQXVCLENBQUMsRUFBRTtnQkFDbkYsS0FBSyxFQUFFLENBQUM7YUFDVDtTQUNGO1FBQ0QsUUFBUSxFQUFFLEVBQUU7UUFDWixtQkFBbUIsRUFBRTtZQUNuQixZQUFZLEVBQUUsQ0FBQyx5QkFBeUIsRUFBRSxLQUFLLENBQUM7U0FDakQ7S0FDRixDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQztBQUVILElBQUksQ0FBQywwQkFBMEIsRUFBRSxHQUFHLEVBQUU7SUFDcEMsUUFBUTtJQUNSLE1BQU0sS0FBSyxHQUFHLElBQUksbUJBQUssRUFBRSxDQUFDO0lBRTFCLE9BQU87SUFDUCxNQUFNLEtBQUssR0FBRyxjQUFRLENBQUMsZUFBZSxDQUFDLEtBQUssRUFBRSxrQkFBa0IsRUFDOUQsaUVBQWlFLENBQUMsQ0FBQztJQUVyRSxPQUFPO0lBQ1AsTUFBTSxDQUFDLEtBQUssQ0FBQyxXQUFXLENBQUMsQ0FBQyxPQUFPLENBQUMsaUVBQWlFLENBQUMsQ0FBQztBQUN2RyxDQUFDLENBQUMsQ0FBQztBQUVILElBQUksQ0FBQyxpRkFBaUYsRUFBRSxHQUFHLEVBQUU7SUFDM0YsUUFBUTtJQUNSLE1BQU0sS0FBSyxHQUFHLElBQUksbUJBQUssRUFBRSxDQUFDO0lBQzFCLE1BQU0sR0FBRyxHQUFHLElBQUksR0FBRyxDQUFDLEdBQUcsQ0FBQyxLQUFLLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFFdEMsT0FBTztJQUNQLE1BQU0sS0FBSyxHQUFHLElBQUksY0FBUSxDQUFDLEtBQUssRUFBRSxPQUFPLEVBQUU7UUFDekMsbUJBQW1CLEVBQUUsQ0FBQztnQkFDcEIsa0JBQWtCLEVBQUUsSUFBSSxxQ0FBK0IsQ0FBQyxLQUFLLEVBQUUsU0FBUyxFQUFFO29CQUN4RSxHQUFHO2lCQUNKLENBQUM7Z0JBQ0YsS0FBSyxFQUFFLENBQUM7YUFDVCxDQUFDO1FBQ0YsUUFBUSxFQUFFLEVBQUU7S0FDYixDQUFDLENBQUM7SUFFSCxLQUFLLENBQUMscUJBQXFCLENBQ3pCLElBQUkscUNBQStCLENBQUMsS0FBSyxFQUFFLFVBQVUsRUFBRTtRQUNyRCxHQUFHO0tBQ0osQ0FBQyxFQUNGLENBQUMsQ0FDRixDQUFDO0lBRUYsTUFBTSxDQUFDLEdBQUcsRUFBRTtRQUNWLHFCQUFRLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQzVCLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyx5REFBeUQsQ0FBQyxDQUFDO0FBQ3hFLENBQUMsQ0FBQyxDQUFDO0FBRUgsSUFBSSxDQUFDLDhEQUE4RCxFQUFFLEdBQUcsRUFBRTtJQUN4RSxRQUFRO0lBQ1IsTUFBTSxLQUFLLEdBQUcsSUFBSSxtQkFBSyxFQUFFLENBQUM7SUFFMUIsT0FBTztJQUNQLElBQUksY0FBUSxDQUFDLEtBQUssRUFBRSxPQUFPLENBQUMsQ0FBQztJQUU3QixNQUFNLENBQUMsR0FBRyxFQUFFO1FBQ1YscUJBQVEsQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDNUIsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLHFEQUFxRCxDQUFDLENBQUM7QUFDcEUsQ0FBQyxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBUZW1wbGF0ZSB9IGZyb20gJ2F3cy1jZGstbGliL2Fzc2VydGlvbnMnO1xuaW1wb3J0IHsgRGVmYXVsdFRva2VuUmVzb2x2ZXIsIFN0YWNrLCBTdHJpbmdDb25jYXQsIFRva2VuaXphdGlvbiB9IGZyb20gJ2F3cy1jZGstbGliJztcbmltcG9ydCAqIGFzIGVjMiBmcm9tICdhd3MtY2RrLWxpYi9hd3MtZWMyJztcbmltcG9ydCB7IEZhaXJzaGFyZVNjaGVkdWxpbmdQb2xpY3ksIEpvYlF1ZXVlLCBNYW5hZ2VkRWMyRWNzQ29tcHV0ZUVudmlyb25tZW50IH0gZnJvbSAnLi4vbGliJztcblxudGVzdCgnSm9iUXVldWUgcmVzcGVjdHMgY29tcHV0ZUVudmlyb25tZW50cycsICgpID0+IHtcbiAgLy8gR0lWRU5cbiAgY29uc3Qgc3RhY2sgPSBuZXcgU3RhY2soKTtcbiAgY29uc3QgdnBjID0gbmV3IGVjMi5WcGMoc3RhY2ssICd2cGMnKTtcblxuICAvLyBXSEVOXG4gIG5ldyBKb2JRdWV1ZShzdGFjaywgJ2pvQkJRJywge1xuICAgIGNvbXB1dGVFbnZpcm9ubWVudHM6IFt7XG4gICAgICBjb21wdXRlRW52aXJvbm1lbnQ6IG5ldyBNYW5hZ2VkRWMyRWNzQ29tcHV0ZUVudmlyb25tZW50KHN0YWNrLCAnQ0UnLCB7XG4gICAgICAgIHZwYyxcbiAgICAgIH0pLFxuICAgICAgb3JkZXI6IDEsXG4gICAgfV0sXG4gICAgcHJpb3JpdHk6IDEwLFxuICB9KTtcblxuICAvLyBUSEVOXG4gIFRlbXBsYXRlLmZyb21TdGFjayhzdGFjaykuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6OkJhdGNoOjpKb2JRdWV1ZScsIHtcbiAgICBDb21wdXRlRW52aXJvbm1lbnRPcmRlcjogW3tcbiAgICAgIENvbXB1dGVFbnZpcm9ubWVudDogeyAnRm46OkdldEF0dCc6IFsnQ0UxQkZFMDNBMScsICdDb21wdXRlRW52aXJvbm1lbnRBcm4nXSB9LFxuICAgICAgT3JkZXI6IDEsXG4gICAgfV0sXG4gICAgUHJpb3JpdHk6IDEwLFxuICAgIFN0YXRlOiAnRU5BQkxFRCcsXG4gIH0pO1xufSk7XG5cbnRlc3QoJ0pvYlF1ZXVlIHJlc3BlY3RzIGVuYWJsZWQnLCAoKSA9PiB7XG4gIC8vIEdJVkVOXG4gIGNvbnN0IHN0YWNrID0gbmV3IFN0YWNrKCk7XG4gIGNvbnN0IHZwYyA9IG5ldyBlYzIuVnBjKHN0YWNrLCAndnBjJyk7XG5cbiAgLy8gV0hFTlxuICBuZXcgSm9iUXVldWUoc3RhY2ssICdqb0JCUScsIHtcbiAgICBjb21wdXRlRW52aXJvbm1lbnRzOiBbe1xuICAgICAgY29tcHV0ZUVudmlyb25tZW50OiBuZXcgTWFuYWdlZEVjMkVjc0NvbXB1dGVFbnZpcm9ubWVudChzdGFjaywgJ0NFJywge1xuICAgICAgICB2cGMsXG4gICAgICB9KSxcbiAgICAgIG9yZGVyOiAxLFxuICAgIH1dLFxuICAgIHByaW9yaXR5OiAxMCxcbiAgICBlbmFibGVkOiBmYWxzZSxcbiAgfSk7XG5cbiAgLy8gVEhFTlxuICBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpCYXRjaDo6Sm9iUXVldWUnLCB7XG4gICAgQ29tcHV0ZUVudmlyb25tZW50T3JkZXI6IFt7XG4gICAgICBDb21wdXRlRW52aXJvbm1lbnQ6IHsgJ0ZuOjpHZXRBdHQnOiBbJ0NFMUJGRTAzQTEnLCAnQ29tcHV0ZUVudmlyb25tZW50QXJuJ10gfSxcbiAgICAgIE9yZGVyOiAxLFxuICAgIH1dLFxuICAgIFByaW9yaXR5OiAxMCxcbiAgICBTdGF0ZTogJ0RJU0FCTEVEJyxcbiAgfSk7XG59KTtcblxudGVzdCgnSm9iUXVldWUgcmVzcGVjdHMgbmFtZScsICgpID0+IHtcbiAgLy8gR0lWRU5cbiAgY29uc3Qgc3RhY2sgPSBuZXcgU3RhY2soKTtcbiAgY29uc3QgdnBjID0gbmV3IGVjMi5WcGMoc3RhY2ssICd2cGMnKTtcblxuICAvLyBXSEVOXG4gIG5ldyBKb2JRdWV1ZShzdGFjaywgJ2pvQkJRJywge1xuICAgIGNvbXB1dGVFbnZpcm9ubWVudHM6IFt7XG4gICAgICBjb21wdXRlRW52aXJvbm1lbnQ6IG5ldyBNYW5hZ2VkRWMyRWNzQ29tcHV0ZUVudmlyb25tZW50KHN0YWNrLCAnQ0UnLCB7XG4gICAgICAgIHZwYyxcbiAgICAgIH0pLFxuICAgICAgb3JkZXI6IDEsXG4gICAgfV0sXG4gICAgcHJpb3JpdHk6IDEwLFxuICAgIGpvYlF1ZXVlTmFtZTogJ0pvQkJRJyxcbiAgfSk7XG5cbiAgLy8gVEhFTlxuICBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpCYXRjaDo6Sm9iUXVldWUnLCB7XG4gICAgQ29tcHV0ZUVudmlyb25tZW50T3JkZXI6IFt7XG4gICAgICBDb21wdXRlRW52aXJvbm1lbnQ6IHsgJ0ZuOjpHZXRBdHQnOiBbJ0NFMUJGRTAzQTEnLCAnQ29tcHV0ZUVudmlyb25tZW50QXJuJ10gfSxcbiAgICAgIE9yZGVyOiAxLFxuICAgIH1dLFxuICAgIFByaW9yaXR5OiAxMCxcbiAgICBKb2JRdWV1ZU5hbWU6ICdKb0JCUScsXG4gIH0pO1xufSk7XG5cbnRlc3QoJ0pvYlF1ZXVlIG5hbWUgaXMgcGFyc2VkIGZyb20gYXJuJywgKCkgPT4ge1xuICAvLyBHSVZFTlxuICBjb25zdCBzdGFjayA9IG5ldyBTdGFjaygpO1xuICBjb25zdCB2cGMgPSBuZXcgZWMyLlZwYyhzdGFjaywgJ3ZwYycpO1xuXG4gIC8vIFdIRU5cbiAgY29uc3QgcXVldWUgPSBuZXcgSm9iUXVldWUoc3RhY2ssICdqb0JCUScsIHtcbiAgICBjb21wdXRlRW52aXJvbm1lbnRzOiBbe1xuICAgICAgY29tcHV0ZUVudmlyb25tZW50OiBuZXcgTWFuYWdlZEVjMkVjc0NvbXB1dGVFbnZpcm9ubWVudChzdGFjaywgJ0NFJywge1xuICAgICAgICB2cGMsXG4gICAgICB9KSxcbiAgICAgIG9yZGVyOiAxLFxuICAgIH1dLFxuICAgIHByaW9yaXR5OiAxMCxcbiAgICBqb2JRdWV1ZU5hbWU6ICdKb0JCUScsXG4gIH0pO1xuXG4gIC8vIFRIRU5cbiAgZXhwZWN0KFRva2VuaXphdGlvbi5yZXNvbHZlKHF1ZXVlLmpvYlF1ZXVlTmFtZSwge1xuICAgIHNjb3BlOiBzdGFjayxcbiAgICByZXNvbHZlcjogbmV3IERlZmF1bHRUb2tlblJlc29sdmVyKG5ldyBTdHJpbmdDb25jYXQoKSksXG4gIH0pKS50b0VxdWFsKHtcbiAgICAnRm46OlNlbGVjdCc6IFtcbiAgICAgIDEsXG4gICAgICB7XG4gICAgICAgICdGbjo6U3BsaXQnOiBbXG4gICAgICAgICAgJy8nLFxuICAgICAgICAgIHtcbiAgICAgICAgICAgICdGbjo6U2VsZWN0JzogW1xuICAgICAgICAgICAgICA1LFxuICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgJ0ZuOjpTcGxpdCc6IFtcbiAgICAgICAgICAgICAgICAgICc6JyxcbiAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgJ0ZuOjpHZXRBdHQnOiBbXG4gICAgICAgICAgICAgICAgICAgICAgJ2pvQkJROUZENTJEQUYnLFxuICAgICAgICAgICAgICAgICAgICAgICdKb2JRdWV1ZUFybicsXG4gICAgICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBdLFxuICAgICAgICAgIH0sXG4gICAgICAgIF0sXG4gICAgICB9LFxuICAgIF0sXG4gIH0pO1xufSk7XG5cbnRlc3QoJ0pvYlF1ZXVlIHJlc3BlY3RzIHNjaGVkdWxpbmdQb2xpY3knLCAoKSA9PiB7XG4gIC8vIEdJVkVOXG4gIGNvbnN0IHN0YWNrID0gbmV3IFN0YWNrKCk7XG4gIGNvbnN0IHZwYyA9IG5ldyBlYzIuVnBjKHN0YWNrLCAndnBjJyk7XG5cbiAgLy8gV0hFTlxuICBuZXcgSm9iUXVldWUoc3RhY2ssICdKb2JRdWV1ZScsIHtcbiAgICBjb21wdXRlRW52aXJvbm1lbnRzOiBbe1xuICAgICAgY29tcHV0ZUVudmlyb25tZW50OiBuZXcgTWFuYWdlZEVjMkVjc0NvbXB1dGVFbnZpcm9ubWVudChzdGFjaywgJ0NFJywge1xuICAgICAgICB2cGMsXG4gICAgICB9KSxcbiAgICAgIG9yZGVyOiAxLFxuICAgIH1dLFxuICAgIHByaW9yaXR5OiAxMCxcbiAgICBzY2hlZHVsaW5nUG9saWN5OiBuZXcgRmFpcnNoYXJlU2NoZWR1bGluZ1BvbGljeShzdGFjaywgJ0ZhaXJzaGFyZVBvbGljeScpLFxuICB9KTtcblxuICAvLyBUSEVOXG4gIFRlbXBsYXRlLmZyb21TdGFjayhzdGFjaykuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6OkJhdGNoOjpKb2JRdWV1ZScsIHtcbiAgICBDb21wdXRlRW52aXJvbm1lbnRPcmRlcjogW3tcbiAgICAgIENvbXB1dGVFbnZpcm9ubWVudDogeyAnRm46OkdldEF0dCc6IFsnQ0UxQkZFMDNBMScsICdDb21wdXRlRW52aXJvbm1lbnRBcm4nXSB9LFxuICAgICAgT3JkZXI6IDEsXG4gICAgfV0sXG4gICAgUHJpb3JpdHk6IDEwLFxuICAgIFNjaGVkdWxpbmdQb2xpY3lBcm46IHtcbiAgICAgICdGbjo6R2V0QXR0JzogWydGYWlyc2hhcmVQb2xpY3lBMEM1NDlCRScsICdBcm4nXSxcbiAgICB9LFxuICB9KTtcbn0pO1xuXG50ZXN0KCdKb2JRdWV1ZSByZXNwZWN0cyBhZGRDb21wdXRlRW52aXJvbm1lbnQnLCAoKSA9PiB7XG4gIC8vIEdJVkVOXG4gIGNvbnN0IHN0YWNrID0gbmV3IFN0YWNrKCk7XG4gIGNvbnN0IHZwYyA9IG5ldyBlYzIuVnBjKHN0YWNrLCAndnBjJyk7XG5cbiAgLy8gV0hFTlxuICBjb25zdCBxdWV1ZSA9IG5ldyBKb2JRdWV1ZShzdGFjaywgJ0pvYlF1ZXVlJywge1xuICAgIGNvbXB1dGVFbnZpcm9ubWVudHM6IFt7XG4gICAgICBjb21wdXRlRW52aXJvbm1lbnQ6IG5ldyBNYW5hZ2VkRWMyRWNzQ29tcHV0ZUVudmlyb25tZW50KHN0YWNrLCAnRmlyc3RDRScsIHtcbiAgICAgICAgdnBjLFxuICAgICAgfSksXG4gICAgICBvcmRlcjogMSxcbiAgICB9XSxcbiAgICBwcmlvcml0eTogMTAsXG4gICAgc2NoZWR1bGluZ1BvbGljeTogbmV3IEZhaXJzaGFyZVNjaGVkdWxpbmdQb2xpY3koc3RhY2ssICdGYWlyc2hhcmVQb2xpY3knKSxcbiAgfSk7XG5cbiAgcXVldWUuYWRkQ29tcHV0ZUVudmlyb25tZW50KFxuICAgIG5ldyBNYW5hZ2VkRWMyRWNzQ29tcHV0ZUVudmlyb25tZW50KHN0YWNrLCAnU2Vjb25kQ0UnLCB7XG4gICAgICB2cGMsXG4gICAgfSksXG4gICAgMixcbiAgKTtcblxuICAvLyBUSEVOXG4gIFRlbXBsYXRlLmZyb21TdGFjayhzdGFjaykuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6OkJhdGNoOjpKb2JRdWV1ZScsIHtcbiAgICBDb21wdXRlRW52aXJvbm1lbnRPcmRlcjogW1xuICAgICAge1xuICAgICAgICBDb21wdXRlRW52aXJvbm1lbnQ6IHsgJ0ZuOjpHZXRBdHQnOiBbJ0ZpcnN0Q0VBRDM3OTRBRCcsICdDb21wdXRlRW52aXJvbm1lbnRBcm4nXSB9LFxuICAgICAgICBPcmRlcjogMSxcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIENvbXB1dGVFbnZpcm9ubWVudDogeyAnRm46OkdldEF0dCc6IFsnU2Vjb25kQ0VFQkE5MzkzOCcsICdDb21wdXRlRW52aXJvbm1lbnRBcm4nXSB9LFxuICAgICAgICBPcmRlcjogMixcbiAgICAgIH0sXG4gICAgXSxcbiAgICBQcmlvcml0eTogMTAsXG4gICAgU2NoZWR1bGluZ1BvbGljeUFybjoge1xuICAgICAgJ0ZuOjpHZXRBdHQnOiBbJ0ZhaXJzaGFyZVBvbGljeUEwQzU0OUJFJywgJ0FybiddLFxuICAgIH0sXG4gIH0pO1xufSk7XG5cbnRlc3QoJ2NhbiBiZSBpbXBvcnRlZCBmcm9tIEFSTicsICgpID0+IHtcbiAgLy8gR0lWRU5cbiAgY29uc3Qgc3RhY2sgPSBuZXcgU3RhY2soKTtcblxuICAvLyBXSEVOXG4gIGNvbnN0IHF1ZXVlID0gSm9iUXVldWUuZnJvbUpvYlF1ZXVlQXJuKHN0YWNrLCAnaW1wb3J0ZWRKb2JRdWV1ZScsXG4gICAgJ2Fybjphd3M6YmF0Y2g6dXMtZWFzdC0xOjEyMzQ1Njc4OTAxMjpqb2ItcXVldWUvaW1wb3J0ZWRKb2JRdWV1ZScpO1xuXG4gIC8vIFRIRU5cbiAgZXhwZWN0KHF1ZXVlLmpvYlF1ZXVlQXJuKS50b0VxdWFsKCdhcm46YXdzOmJhdGNoOnVzLWVhc3QtMToxMjM0NTY3ODkwMTI6am9iLXF1ZXVlL2ltcG9ydGVkSm9iUXVldWUnKTtcbn0pO1xuXG50ZXN0KCdKb2JRdWV1ZSB0aHJvd3Mgd2hlbiB0aGUgc2FtZSBvcmRlciBpcyBhc3NpZ25lZCB0byBtdWx0aXBsZSBDb21wdXRlRW52aXJvbm1lbnRzJywgKCkgPT4ge1xuICAvLyBHSVZFTlxuICBjb25zdCBzdGFjayA9IG5ldyBTdGFjaygpO1xuICBjb25zdCB2cGMgPSBuZXcgZWMyLlZwYyhzdGFjaywgJ3ZwYycpO1xuXG4gIC8vIFdIRU5cbiAgY29uc3Qgam9CQlEgPSBuZXcgSm9iUXVldWUoc3RhY2ssICdqb0JCUScsIHtcbiAgICBjb21wdXRlRW52aXJvbm1lbnRzOiBbe1xuICAgICAgY29tcHV0ZUVudmlyb25tZW50OiBuZXcgTWFuYWdlZEVjMkVjc0NvbXB1dGVFbnZpcm9ubWVudChzdGFjaywgJ0ZpcnN0Q0UnLCB7XG4gICAgICAgIHZwYyxcbiAgICAgIH0pLFxuICAgICAgb3JkZXI6IDEsXG4gICAgfV0sXG4gICAgcHJpb3JpdHk6IDEwLFxuICB9KTtcblxuICBqb0JCUS5hZGRDb21wdXRlRW52aXJvbm1lbnQoXG4gICAgbmV3IE1hbmFnZWRFYzJFY3NDb21wdXRlRW52aXJvbm1lbnQoc3RhY2ssICdTZWNvbmRDRScsIHtcbiAgICAgIHZwYyxcbiAgICB9KSxcbiAgICAxLFxuICApO1xuXG4gIGV4cGVjdCgoKSA9PiB7XG4gICAgVGVtcGxhdGUuZnJvbVN0YWNrKHN0YWNrKTtcbiAgfSkudG9UaHJvdygvYXNzaWducyB0aGUgc2FtZSBvcmRlciB0byBkaWZmZXJlbnQgQ29tcHV0ZUVudmlyb25tZW50cy8pO1xufSk7XG5cbnRlc3QoJ0pvYlF1ZXVlIHRocm93cyB3aGVuIHRoZXJlIGFyZSBubyBsaW5rZWQgQ29tcHV0ZUVudmlyb25tZW50cycsICgpID0+IHtcbiAgLy8gR0lWRU5cbiAgY29uc3Qgc3RhY2sgPSBuZXcgU3RhY2soKTtcblxuICAvLyBXSEVOXG4gIG5ldyBKb2JRdWV1ZShzdGFjaywgJ2pvQkJRJyk7XG5cbiAgZXhwZWN0KCgpID0+IHtcbiAgICBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spO1xuICB9KS50b1Rocm93KC9UaGlzIEpvYlF1ZXVlIGRvZXMgbm90IGxpbmsgYW55IENvbXB1dGVFbnZpcm9ubWVudHMvKTtcbn0pO1xuIl19