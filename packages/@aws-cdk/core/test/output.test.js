"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const util_1 = require("./util");
const lib_1 = require("../lib");
let app;
let stack;
beforeEach(() => {
    app = new lib_1.App();
    stack = new lib_1.Stack(app, 'Stack');
});
describe('output', () => {
    test('outputs can be added to the stack', () => {
        const res = new lib_1.CfnResource(stack, 'MyResource', { type: 'R' });
        const ref = res.ref;
        new lib_1.CfnOutput(stack, 'MyOutput', {
            exportName: 'ExportName',
            value: ref,
            description: 'CfnOutput properties',
        });
        expect(util_1.toCloudFormation(stack)).toEqual({
            Resources: { MyResource: { Type: 'R' } },
            Outputs: {
                MyOutput: {
                    Description: 'CfnOutput properties',
                    Export: { Name: 'ExportName' },
                    Value: { Ref: 'MyResource' },
                },
            },
        });
    });
    test('No export is created by default', () => {
        // WHEN
        new lib_1.CfnOutput(stack, 'SomeOutput', { value: 'x' });
        // THEN
        expect(util_1.toCloudFormation(stack)).toEqual({
            Outputs: {
                SomeOutput: {
                    Value: 'x',
                },
            },
        });
    });
    test('importValue can be used to obtain a Fn::ImportValue expression', () => {
        // GIVEN
        const stack2 = new lib_1.Stack(app, 'Stack2');
        // WHEN
        const output = new lib_1.CfnOutput(stack, 'SomeOutput', { value: 'x', exportName: 'asdf' });
        new lib_1.CfnResource(stack2, 'Resource', {
            type: 'Some::Resource',
            properties: {
                input: output.importValue,
            },
        });
        // THEN
        expect(util_1.toCloudFormation(stack2)).toEqual({
            Resources: {
                Resource: {
                    Type: 'Some::Resource',
                    Properties: {
                        input: { 'Fn::ImportValue': 'asdf' },
                    },
                },
            },
        });
    });
    test('importValue used inside the same stack produces an error', () => {
        // WHEN
        const output = new lib_1.CfnOutput(stack, 'SomeOutput', { value: 'x', exportName: 'asdf' });
        new lib_1.CfnResource(stack, 'Resource', {
            type: 'Some::Resource',
            properties: {
                input: output.importValue,
            },
        });
        // THEN
        expect(() => util_1.toCloudFormation(stack)).toThrow(/should only be used in a different Stack/);
    });
    test('error message if importValue is used and Output is not exported', () => {
        // GIVEN
        const stack2 = new lib_1.Stack(app, 'Stack2');
        // WHEN
        const output = new lib_1.CfnOutput(stack, 'SomeOutput', { value: 'x' });
        new lib_1.CfnResource(stack2, 'Resource', {
            type: 'Some::Resource',
            properties: {
                input: output.importValue,
            },
        });
        expect(() => {
            util_1.toCloudFormation(stack2);
        }).toThrow(/Add an exportName to the CfnOutput/);
    });
    test('throw if Output is passed a string list', () => {
        // WHEN
        expect(() => {
            new lib_1.CfnOutput(stack, 'SomeOutput', { value: ['listValue'] });
        }).toThrow(/CloudFormation output was given a string list instead of a string/);
    });
    test('Verify maximum length of export name', () => {
        const output = new lib_1.CfnOutput(stack, 'SomeOutput', { value: 'x', exportName: 'x'.repeat(260) });
        const errors = output.node.validate();
        expect(errors).toEqual([
            expect.stringContaining('Export name cannot exceed 255 characters'),
        ]);
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib3V0cHV0LnRlc3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJvdXRwdXQudGVzdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLGlDQUEwQztBQUMxQyxnQ0FBNEQ7QUFFNUQsSUFBSSxHQUFRLENBQUM7QUFDYixJQUFJLEtBQVksQ0FBQztBQUNqQixVQUFVLENBQUMsR0FBRyxFQUFFO0lBQ2QsR0FBRyxHQUFHLElBQUksU0FBRyxFQUFFLENBQUM7SUFDaEIsS0FBSyxHQUFHLElBQUksV0FBSyxDQUFDLEdBQUcsRUFBRSxPQUFPLENBQUMsQ0FBQztBQUNsQyxDQUFDLENBQUMsQ0FBQztBQUVILFFBQVEsQ0FBQyxRQUFRLEVBQUUsR0FBRyxFQUFFO0lBQ3RCLElBQUksQ0FBQyxtQ0FBbUMsRUFBRSxHQUFHLEVBQUU7UUFDN0MsTUFBTSxHQUFHLEdBQUcsSUFBSSxpQkFBVyxDQUFDLEtBQUssRUFBRSxZQUFZLEVBQUUsRUFBRSxJQUFJLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQztRQUNoRSxNQUFNLEdBQUcsR0FBRyxHQUFHLENBQUMsR0FBRyxDQUFDO1FBRXBCLElBQUksZUFBUyxDQUFDLEtBQUssRUFBRSxVQUFVLEVBQUU7WUFDL0IsVUFBVSxFQUFFLFlBQVk7WUFDeEIsS0FBSyxFQUFFLEdBQUc7WUFDVixXQUFXLEVBQUUsc0JBQXNCO1NBQ3BDLENBQUMsQ0FBQztRQUNILE1BQU0sQ0FBQyx1QkFBZ0IsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQztZQUN0QyxTQUFTLEVBQUUsRUFBRSxVQUFVLEVBQUUsRUFBRSxJQUFJLEVBQUUsR0FBRyxFQUFFLEVBQUU7WUFDeEMsT0FBTyxFQUNSO2dCQUNFLFFBQVEsRUFDVDtvQkFDRSxXQUFXLEVBQUUsc0JBQXNCO29CQUNuQyxNQUFNLEVBQUUsRUFBRSxJQUFJLEVBQUUsWUFBWSxFQUFFO29CQUM5QixLQUFLLEVBQUUsRUFBRSxHQUFHLEVBQUUsWUFBWSxFQUFFO2lCQUM3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QUMsQ0FBQztJQUVILElBQUksQ0FBQyx5Q0FBeUMsRUFBRSxHQUFHLEVBQUU7UUFDbkQsT0FBTztRQUNQLE1BQU0sQ0FBQyxHQUFHLEVBQUU7WUFDVixJQUFJLGVBQVMsQ0FBQyxLQUFLLEVBQUUsWUFBWSxFQUFFLEVBQUUsS0FBSyxFQUFFLENBQUMsV0FBVyxDQUFRLEVBQUUsQ0FBQyxDQUFDO1FBQ3RFLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxtRUFBbUUsQ0FBQyxDQUFDO0lBQ2xGLENBQUMsQ0FBQyxDQUFDO0lBRUgsSUFBSSxDQUFDLHNDQUFzQyxFQUFFLEdBQUcsRUFBRTtRQUNoRCxNQUFNLE1BQU0sR0FBRyxJQUFJLGVBQVMsQ0FBQyxLQUFLLEVBQUUsWUFBWSxFQUFFLEVBQUUsS0FBSyxFQUFFLEdBQUcsRUFBRSxVQUFVLEVBQUUsR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDL0YsTUFBTSxNQUFNLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQztRQUV0QyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsT0FBTyxDQUFDO1lBQ3JCLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQywwQ0FBMEMsQ0FBQztTQUNwRSxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgdG9DbG91ZEZvcm1hdGlvbiB9IGZyb20gJy4vdXRpbCc7XG5pbXBvcnQgeyBBcHAsIENmbk91dHB1dCwgQ2ZuUmVzb3VyY2UsIFN0YWNrIH0gZnJvbSAnLi4vbGliJztcblxubGV0IGFwcDogQXBwO1xubGV0IHN0YWNrOiBTdGFjaztcbmJlZm9yZUVhY2goKCkgPT4ge1xuICBhcHAgPSBuZXcgQXBwKCk7XG4gIHN0YWNrID0gbmV3IFN0YWNrKGFwcCwgJ1N0YWNrJyk7XG59KTtcblxuZGVzY3JpYmUoJ291dHB1dCcsICgpID0+IHtcbiAgdGVzdCgnb3V0cHV0cyBjYW4gYmUgYWRkZWQgdG8gdGhlIHN0YWNrJywgKCkgPT4ge1xuICAgIGNvbnN0IHJlcyA9IG5ldyBDZm5SZXNvdXJjZShzdGFjaywgJ015UmVzb3VyY2UnLCB7IHR5cGU6ICdSJyB9KTtcbiAgICBjb25zdCByZWYgPSByZXMucmVmO1xuXG4gICAgbmV3IENmbk91dHB1dChzdGFjaywgJ015T3V0cHV0Jywge1xuICAgICAgZXhwb3J0TmFtZTogJ0V4cG9ydE5hbWUnLFxuICAgICAgdmFsdWU6IHJlZixcbiAgICAgIGRlc2NyaXB0aW9uOiAnQ2ZuT3V0cHV0IHByb3BlcnRpZXMnLFxuICAgIH0pO1xuICAgIGV4cGVjdCh0b0Nsb3VkRm9ybWF0aW9uKHN0YWNrKSkudG9FcXVhbCh7XG4gICAgICBSZXNvdXJjZXM6IHsgTXlSZXNvdXJjZTogeyBUeXBlOiAnUicgfSB9LFxuICAgICAgT3V0cHV0czpcbiAgICAge1xuICAgICAgIE15T3V0cHV0OlxuICAgICAge1xuICAgICAgICBEZXNjcmlwdGlvbjogJ0Nmbk91dHB1dCBwcm9wZXJ0aWVzJyxcbiAgICAgICAgRXhwb3J0OiB7IE5hbWU6ICdFeHBvcnROYW1lJyB9LFxuICAgICAgICBWYWx1ZTogeyBSZWY6ICdNeVJlc291cmNlJyB9LFxuICAgICAgfSxcbiAgICAgfSxcbiAgICB9KTtcbiAgfSk7XG5cbiAgdGVzdCgnTm8gZXhwb3J0IGlzIGNyZWF0ZWQgYnkgZGVmYXVsdCcsICgpID0+IHtcbiAgICAvLyBXSEVOXG4gICAgbmV3IENmbk91dHB1dChzdGFjaywgJ1NvbWVPdXRwdXQnLCB7IHZhbHVlOiAneCcgfSk7XG5cbiAgICAvLyBUSEVOXG4gICAgZXhwZWN0KHRvQ2xvdWRGb3JtYXRpb24oc3RhY2spKS50b0VxdWFsKHtcbiAgICAgIE91dHB1dHM6IHtcbiAgICAgICAgU29tZU91dHB1dDoge1xuICAgICAgICAgIFZhbHVlOiAneCcsXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0pO1xuICB9KTtcblxuICB0ZXN0KCdpbXBvcnRWYWx1ZSBjYW4gYmUgdXNlZCB0byBvYnRhaW4gYSBGbjo6SW1wb3J0VmFsdWUgZXhwcmVzc2lvbicsICgpID0+IHtcbiAgICAvLyBHSVZFTlxuICAgIGNvbnN0IHN0YWNrMiA9IG5ldyBTdGFjayhhcHAsICdTdGFjazInKTtcblxuICAgIC8vIFdIRU5cbiAgICBjb25zdCBvdXRwdXQgPSBuZXcgQ2ZuT3V0cHV0KHN0YWNrLCAnU29tZU91dHB1dCcsIHsgdmFsdWU6ICd4JywgZXhwb3J0TmFtZTogJ2FzZGYnIH0pO1xuICAgIG5ldyBDZm5SZXNvdXJjZShzdGFjazIsICdSZXNvdXJjZScsIHtcbiAgICAgIHR5cGU6ICdTb21lOjpSZXNvdXJjZScsXG4gICAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgIGlucHV0OiBvdXRwdXQuaW1wb3J0VmFsdWUsXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgLy8gVEhFTlxuICAgIGV4cGVjdCh0b0Nsb3VkRm9ybWF0aW9uKHN0YWNrMikpLnRvRXF1YWwoe1xuICAgICAgUmVzb3VyY2VzOiB7XG4gICAgICAgIFJlc291cmNlOiB7XG4gICAgICAgICAgVHlwZTogJ1NvbWU6OlJlc291cmNlJyxcbiAgICAgICAgICBQcm9wZXJ0aWVzOiB7XG4gICAgICAgICAgICBpbnB1dDogeyAnRm46OkltcG9ydFZhbHVlJzogJ2FzZGYnIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSk7XG4gIH0pO1xuXG4gIHRlc3QoJ2ltcG9ydFZhbHVlIHVzZWQgaW5zaWRlIHRoZSBzYW1lIHN0YWNrIHByb2R1Y2VzIGFuIGVycm9yJywgKCkgPT4ge1xuICAgIC8vIFdIRU5cbiAgICBjb25zdCBvdXRwdXQgPSBuZXcgQ2ZuT3V0cHV0KHN0YWNrLCAnU29tZU91dHB1dCcsIHsgdmFsdWU6ICd4JywgZXhwb3J0TmFtZTogJ2FzZGYnIH0pO1xuICAgIG5ldyBDZm5SZXNvdXJjZShzdGFjaywgJ1Jlc291cmNlJywge1xuICAgICAgdHlwZTogJ1NvbWU6OlJlc291cmNlJyxcbiAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgaW5wdXQ6IG91dHB1dC5pbXBvcnRWYWx1ZSxcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICAvLyBUSEVOXG4gICAgZXhwZWN0KCgpID0+IHRvQ2xvdWRGb3JtYXRpb24oc3RhY2spKS50b1Rocm93KC9zaG91bGQgb25seSBiZSB1c2VkIGluIGEgZGlmZmVyZW50IFN0YWNrLyk7XG4gIH0pO1xuXG4gIHRlc3QoJ2Vycm9yIG1lc3NhZ2UgaWYgaW1wb3J0VmFsdWUgaXMgdXNlZCBhbmQgT3V0cHV0IGlzIG5vdCBleHBvcnRlZCcsICgpID0+IHtcbiAgICAvLyBHSVZFTlxuICAgIGNvbnN0IHN0YWNrMiA9IG5ldyBTdGFjayhhcHAsICdTdGFjazInKTtcblxuICAgIC8vIFdIRU5cbiAgICBjb25zdCBvdXRwdXQgPSBuZXcgQ2ZuT3V0cHV0KHN0YWNrLCAnU29tZU91dHB1dCcsIHsgdmFsdWU6ICd4JyB9KTtcbiAgICBuZXcgQ2ZuUmVzb3VyY2Uoc3RhY2syLCAnUmVzb3VyY2UnLCB7XG4gICAgICB0eXBlOiAnU29tZTo6UmVzb3VyY2UnLFxuICAgICAgcHJvcGVydGllczoge1xuICAgICAgICBpbnB1dDogb3V0cHV0LmltcG9ydFZhbHVlLFxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIGV4cGVjdCgoKSA9PiB7XG4gICAgICB0b0Nsb3VkRm9ybWF0aW9uKHN0YWNrMik7XG4gICAgfSkudG9UaHJvdygvQWRkIGFuIGV4cG9ydE5hbWUgdG8gdGhlIENmbk91dHB1dC8pO1xuICB9KTtcblxuICB0ZXN0KCd0aHJvdyBpZiBPdXRwdXQgaXMgcGFzc2VkIGEgc3RyaW5nIGxpc3QnLCAoKSA9PiB7XG4gICAgLy8gV0hFTlxuICAgIGV4cGVjdCgoKSA9PiB7XG4gICAgICBuZXcgQ2ZuT3V0cHV0KHN0YWNrLCAnU29tZU91dHB1dCcsIHsgdmFsdWU6IFsnbGlzdFZhbHVlJ10gYXMgYW55IH0pO1xuICAgIH0pLnRvVGhyb3coL0Nsb3VkRm9ybWF0aW9uIG91dHB1dCB3YXMgZ2l2ZW4gYSBzdHJpbmcgbGlzdCBpbnN0ZWFkIG9mIGEgc3RyaW5nLyk7XG4gIH0pO1xuXG4gIHRlc3QoJ1ZlcmlmeSBtYXhpbXVtIGxlbmd0aCBvZiBleHBvcnQgbmFtZScsICgpID0+IHtcbiAgICBjb25zdCBvdXRwdXQgPSBuZXcgQ2ZuT3V0cHV0KHN0YWNrLCAnU29tZU91dHB1dCcsIHsgdmFsdWU6ICd4JywgZXhwb3J0TmFtZTogJ3gnLnJlcGVhdCgyNjApIH0pO1xuICAgIGNvbnN0IGVycm9ycyA9IG91dHB1dC5ub2RlLnZhbGlkYXRlKCk7XG5cbiAgICBleHBlY3QoZXJyb3JzKS50b0VxdWFsKFtcbiAgICAgIGV4cGVjdC5zdHJpbmdDb250YWluaW5nKCdFeHBvcnQgbmFtZSBjYW5ub3QgZXhjZWVkIDI1NSBjaGFyYWN0ZXJzJyksXG4gICAgXSk7XG4gIH0pO1xufSk7XG4iXX0=