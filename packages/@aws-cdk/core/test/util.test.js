"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const lib_1 = require("../lib");
const util_1 = require("../lib/util");
describe('util', () => {
    test('capitalizeResourceProperties capitalizes all keys of an object (recursively) from camelCase to PascalCase', () => {
        const c = new lib_1.Stack();
        expect(util_1.capitalizePropertyNames(c, undefined)).toEqual(undefined);
        expect(util_1.capitalizePropertyNames(c, 12)).toEqual(12);
        expect(util_1.capitalizePropertyNames(c, 'hello')).toEqual('hello');
        expect(util_1.capitalizePropertyNames(c, ['hello', 88])).toEqual(['hello', 88]);
        expect(util_1.capitalizePropertyNames(c, { Hello: 'world', hey: 'dude' })).toEqual({ Hello: 'world', Hey: 'dude' });
        expect(util_1.capitalizePropertyNames(c, [1, 2, { three: 3 }])).toEqual([1, 2, { Three: 3 }]);
        expect(util_1.capitalizePropertyNames(c, { Hello: 'world', recursive: { foo: 123, there: { another: ['hello', { world: 123 }] } } })).toEqual({ Hello: 'world', Recursive: { Foo: 123, There: { Another: ['hello', { World: 123 }] } } });
        // make sure tokens are resolved and result is also capitalized
        expect(util_1.capitalizePropertyNames(c, { hello: { resolve: () => ({ foo: 'bar' }) }, world: new SomeToken() })).toEqual({ Hello: { Foo: 'bar' }, World: 100 });
    });
    describe('ignoreEmpty', () => {
        test('[]', () => {
            const stack = new lib_1.Stack();
            expect(stack.resolve(util_1.ignoreEmpty([]))).toEqual(undefined);
        });
        test('{}', () => {
            const stack = new lib_1.Stack();
            expect(stack.resolve(util_1.ignoreEmpty({}))).toEqual(undefined);
        });
        test('undefined/null', () => {
            const stack = new lib_1.Stack();
            expect(stack.resolve(util_1.ignoreEmpty(undefined))).toEqual(undefined);
            expect(stack.resolve(util_1.ignoreEmpty(null))).toEqual(null);
        });
        test('primitives', () => {
            const stack = new lib_1.Stack();
            expect(stack.resolve(util_1.ignoreEmpty(12))).toEqual(12);
            expect(stack.resolve(util_1.ignoreEmpty('12'))).toEqual('12');
        });
        test('non-empty arrays/objects', () => {
            const stack = new lib_1.Stack();
            expect(stack.resolve(util_1.ignoreEmpty([1, 2, 3, undefined]))).toEqual([1, 2, 3]); // undefined array values is cleaned up by "resolve"
            expect(stack.resolve(util_1.ignoreEmpty({ o: 1, b: 2, j: 3 }))).toEqual({ o: 1, b: 2, j: 3 });
        });
        test('resolve first', () => {
            const stack = new lib_1.Stack();
            expect(stack.resolve(util_1.ignoreEmpty({ xoo: { resolve: () => 123 } }))).toEqual({ xoo: 123 });
            expect(stack.resolve(util_1.ignoreEmpty({ xoo: { resolve: () => undefined } }))).toEqual(undefined);
            expect(stack.resolve(util_1.ignoreEmpty({ xoo: { resolve: () => [] } }))).toEqual({ xoo: [] });
            expect(stack.resolve(util_1.ignoreEmpty({ xoo: { resolve: () => [undefined, undefined] } }))).toEqual({ xoo: [] });
        });
    });
    describe('filterUnderined', () => {
        test('is null-safe (aka treats null and undefined the same)', () => {
            expect(util_1.filterUndefined({ 'a null': null, 'a not null': true })).toEqual({ 'a not null': true });
        });
        test('removes undefined, but leaves the rest', () => {
            expect(util_1.filterUndefined({ 'an undefined': undefined, 'yes': true })).toEqual({ yes: true });
        });
    });
    test('pathToTopLevelStack returns the array of stacks that lead to a stack', () => {
        const a = new lib_1.Stack(undefined, 'a');
        const aa = new Nested(a, 'aa');
        const aaa = new Nested(aa, 'aaa');
        expect(path(aaa)).toEqual(['a', 'aa', 'aaa']);
        expect(path(aa)).toEqual(['a', 'aa']);
        expect(path(a)).toEqual(['a']);
        function path(s) {
            return util_1.pathToTopLevelStack(s).map(x => x.node.id);
        }
    });
    test('findCommonStack returns the lowest common stack between two stacks or undefined', () => {
        const a = new lib_1.Stack(undefined, 'a');
        const aa = new Nested(a, 'aa');
        const ab = new Nested(a, 'ab');
        const aaa = new Nested(aa, 'aaa');
        const aab = new Nested(aa, 'aab');
        const aba = new Nested(ab, 'aba');
        const b = new lib_1.Stack(undefined, 'b');
        const ba = new Nested(b, 'ba');
        const baa = new Nested(ba, 'baa');
        expect(lca(a, b)).toEqual(undefined);
        expect(lca(aa, ab)).toEqual('a');
        expect(lca(ab, aa)).toEqual('a');
        expect(lca(aa, aba)).toEqual('a');
        expect(lca(aba, aa)).toEqual('a');
        expect(lca(ab, aba)).toEqual('ab');
        expect(lca(aba, ab)).toEqual('ab');
        expect(lca(aba, aba)).toEqual('aba');
        expect(lca(aa, aa)).toEqual('aa');
        expect(lca(a, aaa)).toEqual('a');
        expect(lca(aaa, aab)).toEqual('aa');
        expect(lca(aaa, b)).toEqual(undefined);
        expect(lca(aaa, ba)).toEqual(undefined);
        expect(lca(baa, ba)).toEqual('ba');
        function lca(s1, s2) {
            const res = util_1.findLastCommonElement(util_1.pathToTopLevelStack(s1), util_1.pathToTopLevelStack(s2));
            if (!res) {
                return undefined;
            }
            return res.node.id;
        }
    });
});
class SomeToken {
    constructor() {
        this.foo = 60;
        this.goo = 40;
    }
    resolve() {
        return this.foo + this.goo;
    }
}
class Nested extends lib_1.Stack {
    constructor(scope, id) {
        const resource = new lib_1.CfnResource(scope, `${id}+NestedStackResource`, { type: 'AWS::CloudFormation::Stack' });
        super(scope, id);
        this.nestedStackResource = resource;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbC50ZXN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsidXRpbC50ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQ0EsZ0NBQTRDO0FBQzVDLHNDQUFnSTtBQUVoSSxRQUFRLENBQUMsTUFBTSxFQUFFLEdBQUcsRUFBRTtJQUNwQixJQUFJLENBQUMsMkdBQTJHLEVBQUUsR0FBRyxFQUFFO1FBQ3JILE1BQU0sQ0FBQyxHQUFHLElBQUksV0FBSyxFQUFFLENBQUM7UUFFdEIsTUFBTSxDQUFDLDhCQUF1QixDQUFDLENBQUMsRUFBRSxTQUFTLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUNqRSxNQUFNLENBQUMsOEJBQXVCLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQ25ELE1BQU0sQ0FBQyw4QkFBdUIsQ0FBQyxDQUFDLEVBQUUsT0FBTyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDN0QsTUFBTSxDQUFDLDhCQUF1QixDQUFDLENBQUMsRUFBRSxDQUFDLE9BQU8sRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsT0FBTyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDekUsTUFBTSxDQUFDLDhCQUF1QixDQUFDLENBQUMsRUFDOUIsRUFBRSxLQUFLLEVBQUUsT0FBTyxFQUFFLEdBQUcsRUFBRSxNQUFNLEVBQUUsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUN6QyxFQUFFLEtBQUssRUFBRSxPQUFPLEVBQUUsR0FBRyxFQUFFLE1BQU0sRUFBRSxDQUFDLENBQUM7UUFDbkMsTUFBTSxDQUFDLDhCQUF1QixDQUFDLENBQUMsRUFDOUIsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsS0FBSyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FDOUIs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QUFFLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFFbEMsTUFBTSxDQUFDLEdBQUcsSUFBSSxXQUFLLENBQUMsU0FBUyxFQUFFLEdBQUcsQ0FBQyxDQUFDO1FBQ3BDLE1BQU0sRUFBRSxHQUFHLElBQUksTUFBTSxDQUFDLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQztRQUMvQixNQUFNLEdBQUcsR0FBRyxJQUFJLE1BQU0sQ0FBQyxFQUFFLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFFbEMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDckMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDakMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDakMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxFQUFFLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDbEMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDbEMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxFQUFFLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDbkMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDbkMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDckMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDbEMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDakMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDcEMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDdkMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDeEMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7UUFFbkMsU0FBUyxHQUFHLENBQUMsRUFBUyxFQUFFLEVBQVM7WUFDL0IsTUFBTSxHQUFHLEdBQUcsNEJBQXFCLENBQUMsMEJBQW1CLENBQUMsRUFBRSxDQUFDLEVBQUUsMEJBQW1CLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztZQUNwRixJQUFJLENBQUMsR0FBRyxFQUFFO2dCQUFFLE9BQU8sU0FBUyxDQUFDO2FBQUU7WUFDL0IsT0FBTyxHQUFHLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQztRQUNyQixDQUFDO0lBQ0gsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQztBQUVILE1BQU0sU0FBUztJQUFmO1FBQ1MsUUFBRyxHQUFHLEVBQUUsQ0FBQztRQUNULFFBQUcsR0FBRyxFQUFFLENBQUM7SUFJbEIsQ0FBQztJQUhRLE9BQU87UUFDWixPQUFPLElBQUksQ0FBQyxHQUFHLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQztLQUM1QjtDQUNGO0FBRUQsTUFBTSxNQUFPLFNBQVEsV0FBSztJQUV4QixZQUFZLEtBQWdCLEVBQUUsRUFBVTtRQUN0QyxNQUFNLFFBQVEsR0FBRyxJQUFJLGlCQUFXLENBQUMsS0FBSyxFQUFFLEdBQUcsRUFBRSxzQkFBc0IsRUFBRSxFQUFFLElBQUksRUFBRSw0QkFBNEIsRUFBRSxDQUFDLENBQUM7UUFDN0csS0FBSyxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUMsQ0FBQztRQUNqQixJQUFJLENBQUMsbUJBQW1CLEdBQUcsUUFBUSxDQUFDO0tBQ3JDO0NBQ0YiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb25zdHJ1Y3QgfSBmcm9tICdjb25zdHJ1Y3RzJztcbmltcG9ydCB7IENmblJlc291cmNlLCBTdGFjayB9IGZyb20gJy4uL2xpYic7XG5pbXBvcnQgeyBjYXBpdGFsaXplUHJvcGVydHlOYW1lcywgZmlsdGVyVW5kZWZpbmVkLCBmaW5kTGFzdENvbW1vbkVsZW1lbnQsIGlnbm9yZUVtcHR5LCBwYXRoVG9Ub3BMZXZlbFN0YWNrIH0gZnJvbSAnLi4vbGliL3V0aWwnO1xuXG5kZXNjcmliZSgndXRpbCcsICgpID0+IHtcbiAgdGVzdCgnY2FwaXRhbGl6ZVJlc291cmNlUHJvcGVydGllcyBjYXBpdGFsaXplcyBhbGwga2V5cyBvZiBhbiBvYmplY3QgKHJlY3Vyc2l2ZWx5KSBmcm9tIGNhbWVsQ2FzZSB0byBQYXNjYWxDYXNlJywgKCkgPT4ge1xuICAgIGNvbnN0IGMgPSBuZXcgU3RhY2soKTtcblxuICAgIGV4cGVjdChjYXBpdGFsaXplUHJvcGVydHlOYW1lcyhjLCB1bmRlZmluZWQpKS50b0VxdWFsKHVuZGVmaW5lZCk7XG4gICAgZXhwZWN0KGNhcGl0YWxpemVQcm9wZXJ0eU5hbWVzKGMsIDEyKSkudG9FcXVhbCgxMik7XG4gICAgZXhwZWN0KGNhcGl0YWxpemVQcm9wZXJ0eU5hbWVzKGMsICdoZWxsbycpKS50b0VxdWFsKCdoZWxsbycpO1xuICAgIGV4cGVjdChjYXBpdGFsaXplUHJvcGVydHlOYW1lcyhjLCBbJ2hlbGxvJywgODhdKSkudG9FcXVhbChbJ2hlbGxvJywgODhdKTtcbiAgICBleHBlY3QoY2FwaXRhbGl6ZVByb3BlcnR5TmFtZXMoYyxcbiAgICAgIHsgSGVsbG86ICd3b3JsZCcsIGhleTogJ2R1ZGUnIH0pKS50b0VxdWFsKFxuICAgICAgeyBIZWxsbzogJ3dvcmxkJywgSGV5OiAnZHVkZScgfSk7XG4gICAgZXhwZWN0KGNhcGl0YWxpemVQcm9wZXJ0eU5hbWVzKGMsXG4gICAgICBbMSwgMiwgeyB0aHJlZTogMyB9XSkpLnRvRXF1YWwoXG4gICAgICBbMSwgMiwgeyBUaHJlZTogMyB9XSk7XG4gICAgZXhwZWN0KGNhcGl0YWxpemVQcm9wZXJ0eU5hbWVzKGMsXG4gICAgICB7IEhlbGxvOiAnd29ybGQnLCByZWN1cnNpdmU6IHsgZm9vOiAxMjMsIHRoZXJlOiB7IGFub3RoZXI6IFsnaGVsbG8nLCB7IHdvcmxkOiAxMjMgfV0gfSB9IH0pKS50b0VxdWFsKFxuICAgICAgeyBIZWxsbzogJ3dvcmxkJywgUmVjdXJzaXZlOiB7IEZvbzogMTIzLCBUaGVyZTogeyBBbm90aGVyOiBbJ2hlbGxvJywgeyBXb3JsZDogMTIzIH1dIH0gfSB9KTtcblxuICAgIC8vIG1ha2Ugc3VyZSB0b2tlbnMgYXJlIHJlc29sdmVkIGFuZCByZXN1bHQgaXMgYWxzbyBjYXBpdGFsaXplZFxuICAgIGV4cGVjdChjYXBpdGFsaXplUHJvcGVydHlOYW1lcyhjLFxuICAgICAgeyBoZWxsbzogeyByZXNvbHZlOiAoKSA9PiAoeyBmb286ICdiYXInIH0pIH0sIHdvcmxkOiBuZXcgU29tZVRva2VuKCkgfSkpLnRvRXF1YWwoXG4gICAgICB7IEhlbGxvOiB7IEZvbzogJ2JhcicgfSwgV29ybGQ6IDEwMCB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2lnbm9yZUVtcHR5JywgKCkgPT4ge1xuICAgIHRlc3QoJ1tdJywgKCkgPT4ge1xuICAgICAgY29uc3Qgc3RhY2sgPSBuZXcgU3RhY2soKTtcbiAgICAgIGV4cGVjdChzdGFjay5yZXNvbHZlKGlnbm9yZUVtcHR5KFtdKSkpLnRvRXF1YWwodW5kZWZpbmVkKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3t9JywgKCkgPT4ge1xuICAgICAgY29uc3Qgc3RhY2sgPSBuZXcgU3RhY2soKTtcbiAgICAgIGV4cGVjdChzdGFjay5yZXNvbHZlKGlnbm9yZUVtcHR5KHt9KSkpLnRvRXF1YWwodW5kZWZpbmVkKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3VuZGVmaW5lZC9udWxsJywgKCkgPT4ge1xuICAgICAgY29uc3Qgc3RhY2sgPSBuZXcgU3RhY2soKTtcbiAgICAgIGV4cGVjdChzdGFjay5yZXNvbHZlKGlnbm9yZUVtcHR5KHVuZGVmaW5lZCkpKS50b0VxdWFsKHVuZGVmaW5lZCk7XG4gICAgICBleHBlY3Qoc3RhY2sucmVzb2x2ZShpZ25vcmVFbXB0eShudWxsKSkpLnRvRXF1YWwobnVsbCk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdwcmltaXRpdmVzJywgKCkgPT4ge1xuICAgICAgY29uc3Qgc3RhY2sgPSBuZXcgU3RhY2soKTtcbiAgICAgIGV4cGVjdChzdGFjay5yZXNvbHZlKGlnbm9yZUVtcHR5KDEyKSkpLnRvRXF1YWwoMTIpO1xuICAgICAgZXhwZWN0KHN0YWNrLnJlc29sdmUoaWdub3JlRW1wdHkoJzEyJykpKS50b0VxdWFsKCcxMicpO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnbm9uLWVtcHR5IGFycmF5cy9vYmplY3RzJywgKCkgPT4ge1xuICAgICAgY29uc3Qgc3RhY2sgPSBuZXcgU3RhY2soKTtcbiAgICAgIGV4cGVjdChzdGFjay5yZXNvbHZlKGlnbm9yZUVtcHR5KFsxLCAyLCAzLCB1bmRlZmluZWRdKSkpLnRvRXF1YWwoWzEsIDIsIDNdKTsgLy8gdW5kZWZpbmVkIGFycmF5IHZhbHVlcyBpcyBjbGVhbmVkIHVwIGJ5IFwicmVzb2x2ZVwiXG4gICAgICBleHBlY3Qoc3RhY2sucmVzb2x2ZShpZ25vcmVFbXB0eSh7IG86IDEsIGI6IDIsIGo6IDMgfSkpKS50b0VxdWFsKHsgbzogMSwgYjogMiwgajogMyB9KTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Jlc29sdmUgZmlyc3QnLCAoKSA9PiB7XG4gICAgICBjb25zdCBzdGFjayA9IG5ldyBTdGFjaygpO1xuICAgICAgZXhwZWN0KHN0YWNrLnJlc29sdmUoaWdub3JlRW1wdHkoeyB4b286IHsgcmVzb2x2ZTogKCkgPT4gMTIzIH0gfSkpKS50b0VxdWFsKHsgeG9vOiAxMjMgfSk7XG4gICAgICBleHBlY3Qoc3RhY2sucmVzb2x2ZShpZ25vcmVFbXB0eSh7IHhvbzogeyByZXNvbHZlOiAoKSA9PiB1bmRlZmluZWQgfSB9KSkpLnRvRXF1YWwodW5kZWZpbmVkKTtcbiAgICAgIGV4cGVjdChzdGFjay5yZXNvbHZlKGlnbm9yZUVtcHR5KHsgeG9vOiB7IHJlc29sdmU6ICgpID0+IFtdIH0gfSkpKS50b0VxdWFsKHsgeG9vOiBbXSB9KTtcbiAgICAgIGV4cGVjdChzdGFjay5yZXNvbHZlKGlnbm9yZUVtcHR5KHsgeG9vOiB7IHJlc29sdmU6ICgpID0+IFt1bmRlZmluZWQsIHVuZGVmaW5lZF0gfSB9KSkpLnRvRXF1YWwoeyB4b286IFtdIH0pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZmlsdGVyVW5kZXJpbmVkJywgKCkgPT4ge1xuICAgIHRlc3QoJ2lzIG51bGwtc2FmZSAoYWthIHRyZWF0cyBudWxsIGFuZCB1bmRlZmluZWQgdGhlIHNhbWUpJywgKCkgPT4ge1xuICAgICAgZXhwZWN0KGZpbHRlclVuZGVmaW5lZCh7ICdhIG51bGwnOiBudWxsLCAnYSBub3QgbnVsbCc6IHRydWUgfSkpLnRvRXF1YWwoeyAnYSBub3QgbnVsbCc6IHRydWUgfSk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdyZW1vdmVzIHVuZGVmaW5lZCwgYnV0IGxlYXZlcyB0aGUgcmVzdCcsICgpID0+IHtcbiAgICAgIGV4cGVjdChmaWx0ZXJVbmRlZmluZWQoeyAnYW4gdW5kZWZpbmVkJzogdW5kZWZpbmVkLCAneWVzJzogdHJ1ZSB9KSkudG9FcXVhbCh7IHllczogdHJ1ZSB9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgdGVzdCgncGF0aFRvVG9wTGV2ZWxTdGFjayByZXR1cm5zIHRoZSBhcnJheSBvZiBzdGFja3MgdGhhdCBsZWFkIHRvIGEgc3RhY2snLCAoKSA9PiB7XG4gICAgY29uc3QgYSA9IG5ldyBTdGFjayh1bmRlZmluZWQsICdhJyk7XG4gICAgY29uc3QgYWEgPSBuZXcgTmVzdGVkKGEsICdhYScpO1xuICAgIGNvbnN0IGFhYSA9IG5ldyBOZXN0ZWQoYWEsICdhYWEnKTtcblxuICAgIGV4cGVjdChwYXRoKGFhYSkpLnRvRXF1YWwoWydhJywgJ2FhJywgJ2FhYSddKTtcbiAgICBleHBlY3QocGF0aChhYSkpLnRvRXF1YWwoWydhJywgJ2FhJ10pO1xuICAgIGV4cGVjdChwYXRoKGEpKS50b0VxdWFsKFsnYSddKTtcbiAgICBmdW5jdGlvbiBwYXRoKHM6IFN0YWNrKSB7XG4gICAgICByZXR1cm4gcGF0aFRvVG9wTGV2ZWxTdGFjayhzKS5tYXAoeCA9PiB4Lm5vZGUuaWQpO1xuICAgIH1cbiAgfSk7XG5cbiAgdGVzdCgnZmluZENvbW1vblN0YWNrIHJldHVybnMgdGhlIGxvd2VzdCBjb21tb24gc3RhY2sgYmV0d2VlbiB0d28gc3RhY2tzIG9yIHVuZGVmaW5lZCcsICgpID0+IHtcbiAgICBjb25zdCBhID0gbmV3IFN0YWNrKHVuZGVmaW5lZCwgJ2EnKTtcbiAgICBjb25zdCBhYSA9IG5ldyBOZXN0ZWQoYSwgJ2FhJyk7XG4gICAgY29uc3QgYWIgPSBuZXcgTmVzdGVkKGEsICdhYicpO1xuICAgIGNvbnN0IGFhYSA9IG5ldyBOZXN0ZWQoYWEsICdhYWEnKTtcbiAgICBjb25zdCBhYWIgPSBuZXcgTmVzdGVkKGFhLCAnYWFiJyk7XG4gICAgY29uc3QgYWJhID0gbmV3IE5lc3RlZChhYiwgJ2FiYScpO1xuXG4gICAgY29uc3QgYiA9IG5ldyBTdGFjayh1bmRlZmluZWQsICdiJyk7XG4gICAgY29uc3QgYmEgPSBuZXcgTmVzdGVkKGIsICdiYScpO1xuICAgIGNvbnN0IGJhYSA9IG5ldyBOZXN0ZWQoYmEsICdiYWEnKTtcblxuICAgIGV4cGVjdChsY2EoYSwgYikpLnRvRXF1YWwodW5kZWZpbmVkKTtcbiAgICBleHBlY3QobGNhKGFhLCBhYikpLnRvRXF1YWwoJ2EnKTtcbiAgICBleHBlY3QobGNhKGFiLCBhYSkpLnRvRXF1YWwoJ2EnKTtcbiAgICBleHBlY3QobGNhKGFhLCBhYmEpKS50b0VxdWFsKCdhJyk7XG4gICAgZXhwZWN0KGxjYShhYmEsIGFhKSkudG9FcXVhbCgnYScpO1xuICAgIGV4cGVjdChsY2EoYWIsIGFiYSkpLnRvRXF1YWwoJ2FiJyk7XG4gICAgZXhwZWN0KGxjYShhYmEsIGFiKSkudG9FcXVhbCgnYWInKTtcbiAgICBleHBlY3QobGNhKGFiYSwgYWJhKSkudG9FcXVhbCgnYWJhJyk7XG4gICAgZXhwZWN0KGxjYShhYSwgYWEpKS50b0VxdWFsKCdhYScpO1xuICAgIGV4cGVjdChsY2EoYSwgYWFhKSkudG9FcXVhbCgnYScpO1xuICAgIGV4cGVjdChsY2EoYWFhLCBhYWIpKS50b0VxdWFsKCdhYScpO1xuICAgIGV4cGVjdChsY2EoYWFhLCBiKSkudG9FcXVhbCh1bmRlZmluZWQpO1xuICAgIGV4cGVjdChsY2EoYWFhLCBiYSkpLnRvRXF1YWwodW5kZWZpbmVkKTtcbiAgICBleHBlY3QobGNhKGJhYSwgYmEpKS50b0VxdWFsKCdiYScpO1xuXG4gICAgZnVuY3Rpb24gbGNhKHMxOiBTdGFjaywgczI6IFN0YWNrKSB7XG4gICAgICBjb25zdCByZXMgPSBmaW5kTGFzdENvbW1vbkVsZW1lbnQocGF0aFRvVG9wTGV2ZWxTdGFjayhzMSksIHBhdGhUb1RvcExldmVsU3RhY2soczIpKTtcbiAgICAgIGlmICghcmVzKSB7IHJldHVybiB1bmRlZmluZWQ7IH1cbiAgICAgIHJldHVybiByZXMubm9kZS5pZDtcbiAgICB9XG4gIH0pO1xufSk7XG5cbmNsYXNzIFNvbWVUb2tlbiB7XG4gIHB1YmxpYyBmb28gPSA2MDtcbiAgcHVibGljIGdvbyA9IDQwO1xuICBwdWJsaWMgcmVzb2x2ZSgpIHtcbiAgICByZXR1cm4gdGhpcy5mb28gKyB0aGlzLmdvbztcbiAgfVxufVxuXG5jbGFzcyBOZXN0ZWQgZXh0ZW5kcyBTdGFjayB7XG4gIHB1YmxpYyByZWFkb25seSBuZXN0ZWRTdGFja1Jlc291cmNlPzogQ2ZuUmVzb3VyY2U7XG4gIGNvbnN0cnVjdG9yKHNjb3BlOiBDb25zdHJ1Y3QsIGlkOiBzdHJpbmcpIHtcbiAgICBjb25zdCByZXNvdXJjZSA9IG5ldyBDZm5SZXNvdXJjZShzY29wZSwgYCR7aWR9K05lc3RlZFN0YWNrUmVzb3VyY2VgLCB7IHR5cGU6ICdBV1M6OkNsb3VkRm9ybWF0aW9uOjpTdGFjaycgfSk7XG4gICAgc3VwZXIoc2NvcGUsIGlkKTtcbiAgICB0aGlzLm5lc3RlZFN0YWNrUmVzb3VyY2UgPSByZXNvdXJjZTtcbiAgfVxufVxuIl19