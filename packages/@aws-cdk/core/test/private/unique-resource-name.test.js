"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const helpers_internal_1 = require("../../lib/helpers-internal");
const unique_resource_name_1 = require("../../lib/private/unique-resource-name");
const pathHash = (path) => {
    return helpers_internal_1.md5hash(path.join('/')).slice(0, 8).toUpperCase();
};
describe('makeUniqueResourceName tests', () => {
    test('unique resource name is just resource name when the resource is top level, short enough, has no nonalphanumeric characters', () => {
        const uniqueResourceName = unique_resource_name_1.makeUniqueResourceName(['toplevelresource'], {});
        expect(uniqueResourceName).toEqual('toplevelresource');
    });
    test('unique resource name is shortened with a hash added when resource is top level and resource name is too long', () => {
        const tooLongName = ['anamethatisslightlylongerthan256charactersthatisalsoatoplevelresourcesothereisonlyonevalueinthisarrayandapparentlybrevityisnotthestrongpointofthepersonwhonamedthisresourcewhichIbettheywillcometoregretlaterbutitiswhatitisanywhodlethisfunctionshouldshortenthis'];
        const uniqueResourceName = unique_resource_name_1.makeUniqueResourceName(tooLongName, {});
        const expectedName = `anamethatisslightlylongerthan256charactersthatisalsoatoplevelresourcesothereisonlyonevalueinthisarrayandapparentlybrevityisngpointofthepersonwhonamedthisresourcewhichIbettheywillcometoregretlaterbutitiswhatitisanywhodlethisfunctionshouldshortenthis${pathHash(tooLongName)}`;
        expect(uniqueResourceName).toEqual(expectedName);
        expect(uniqueResourceName.length).toEqual(256);
    });
    test('unique resource name removes special characters when resource is top level', () => {
        const componentsPath = ['I-love-special-characters-¯\\\_(ツ)_/¯-for-real-though'];
        const expectedName = 'Ilovespecialcharactersforrealthough';
        expect(unique_resource_name_1.makeUniqueResourceName(componentsPath, {})).toEqual(expectedName);
    });
    test('unique resource name shortens from the middle and adds a hash when maxLength is defined, resource is top level, and resource name is longer than max', () => {
        const componentsPath = ['ThisIsStillLongerThanTheAllowedLength'];
        const expectedName = `ThisIsLength${pathHash(componentsPath)}`;
        expect(unique_resource_name_1.makeUniqueResourceName(componentsPath, { maxLength: 20 })).toEqual(expectedName);
    });
    test('unique resource name shortens from the middle and adds a hash when maxLength is defined, resource is top level, resource name is longer than max, and separator is provided', () => {
        const componentsPath = ['ThisIsStillLongerThanTheAllowedLength'];
        const expectedName = `ThisIsength-${pathHash(componentsPath)}`;
        expect(unique_resource_name_1.makeUniqueResourceName(componentsPath, { maxLength: 20, separator: '-' })).toEqual(expectedName);
    });
    test('unique resource name removes special characters and makes no other changes when resouce is top level and too long with special characters but proper length without', () => {
        const tooLongName = ['a-name-that-is-slightly-longer-than-256-characters-that-is-also-a-top-level-resource-so-there-is-only-one-value-in-this-array-and-apparently-brevity-is-not-the-strong-point-of-the-person-who-named-this-resource-which-I-bet-they-will-come-to-regret-later-but-it-is-what-it-is'];
        const expectedName = 'anamethatisslightlylongerthan256charactersthatisalsoatoplevelresourcesothereisonlyonevalueinthisarrayandapparentlybrevityisnotthestrongpointofthepersonwhonamedthisresourcewhichIbettheywillcometoregretlaterbutitiswhatitis';
        expect(unique_resource_name_1.makeUniqueResourceName(tooLongName, {})).toEqual(expectedName);
    });
    test('unique resource name leaves in allowed special characters and adds no hash when resource is top level and resouce name is short enougn', () => {
        const componentsPath = ['¯\\\_(ツ)_/¯-shruggie-gets-to-stay-¯\\\_(ツ)_/¯'];
        const expectedName = '¯\_(ツ)_/¯shruggiegetstostay¯\_(ツ)_/¯';
        expect(unique_resource_name_1.makeUniqueResourceName(componentsPath, { allowedSpecialCharacters: '¯\\\_(ツ)/', maxLength: 200 })).toEqual(expectedName);
    });
    test('unique resource name leaves in allowed special characters and adds no hash or separators when resource is top level and resouce name is short enougn', () => {
        const componentsPath = ['¯\\\_(ツ)_/¯-shruggie-gets-to-stay-¯\\\_(ツ)_/¯'];
        const expectedName = '¯\_(ツ)_/¯shruggiegetstostay¯\_(ツ)_/¯';
        expect(unique_resource_name_1.makeUniqueResourceName(componentsPath, { allowedSpecialCharacters: '¯\\\_(ツ)/', maxLength: 200, separator: '-' })).toEqual(expectedName);
    });
    test('unique resource name is shortened with a hash and separator added when resource is top level, resource name is too long, and separator is provided', () => {
        const tooLongName = ['anamethatisslightlylongerthan256charactersthatisalsoatoplevelresourcesothereisonlyonevalueinthisarrayandapparentlybrevityisnotthestrongpointofthepersonwhonamedthisresourcewhichIbettheywillcometoregretlaterbutitiswhatitisanywhodlethisfunctionshouldshortenthis'];
        const uniqueResourceName = unique_resource_name_1.makeUniqueResourceName(tooLongName, { separator: '~' });
        const expectedName = `anamethatisslightlylongerthan256charactersthatisalsoatoplevelresourcesothereisonlyonevalueinthisarrayandapparentlybrevityisnpointofthepersonwhonamedthisresourcewhichIbettheywillcometoregretlaterbutitiswhatitisanywhodlethisfunctionshouldshortenthis~${pathHash(tooLongName)}`;
        expect(uniqueResourceName).toEqual(expectedName);
        expect(uniqueResourceName.length).toEqual(256);
    });
    test('unique resource name removes special characters when they are included in the components names', () => {
        const componentsPath = ['I', 'love', 'special', 'characters', '¯\\\_(ツ)_/¯', 'for', 'real', 'though'];
        const expectedName = `Ilovespecialcharactersforrealthough${pathHash(componentsPath)}`;
        expect(unique_resource_name_1.makeUniqueResourceName(componentsPath, {})).toEqual(expectedName);
    });
    test('unique resource name removes special characters that are not allow listed and leaves the allowed ones', () => {
        const componentsPath = ['I-love-special-characters-', '¯\\\_(ツ)_/¯', '-for-real-though-'];
        const expectedName = `I-love-special-characters--for-real-though-${pathHash(componentsPath)}`;
        expect(unique_resource_name_1.makeUniqueResourceName(componentsPath, { allowedSpecialCharacters: '-' })).toEqual(expectedName);
    });
    test('unique resource name adds in separator and adds hash when separator is provided and name is not too long', () => {
        const componentsPath = ['This', 'unique', 'resource', 'name', 'needs', 'a', 'separator'];
        const expectedName = `This.*.unique.*.resource.*.name.*.needs.*.a.*.separator.*.${pathHash(componentsPath)}`;
        expect(unique_resource_name_1.makeUniqueResourceName(componentsPath, { separator: '.*.' })).toEqual(expectedName);
    });
    test('unique resource name adds in separator, adds hash, and shortens name when separator is provided and name too long', () => {
        const componentsPath = ['This', 'unique', 'resource', 'name', 'is', 'longer', 'than', 'allowed'];
        const expectedName = `This/unique/resourcelonger/than/allowed/${pathHash(componentsPath)}`;
        expect(unique_resource_name_1.makeUniqueResourceName(componentsPath, { maxLength: 48, separator: '/' })).toEqual(expectedName);
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidW5pcXVlLXJlc291cmNlLW5hbWUudGVzdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInVuaXF1ZS1yZXNvdXJjZS1uYW1lLnRlc3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxpRUFBcUQ7QUFDckQsaUZBQWdGO0FBRWhGLE1BQU0sUUFBUSxHQUFHLENBQUMsSUFBYyxFQUFVLEVBQUU7SUFDMUMsT0FBTywwQkFBTyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO0FBQzNELENBQUMsQ0FBQztBQUVGLFFBQVEsQ0FBQyw4QkFBOEIsRUFBRSxHQUFHLEVBQUU7SUFDNUMsSUFBSSxDQUFDLDRIQUE0SCxFQUFFLEdBQUcsRUFBRTtRQUN0SSxNQUFNLGtCQUFrQixHQUFHLDZDQUFzQixDQUFDLENBQUMsa0JBQWtCLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQztRQUM1RSxNQUFNLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxPQUFPLENBQUMsa0JBQWtCLENBQUMsQ0FBQztJQUN6RCxDQUFDLENBQUMsQ0FBQztJQUVILElBQUksQ0FBQyw4R0FBOEcsRUFBRSxHQUFHLEVBQUU7UUFDeEgsTUFBTSxXQUFXLEdBQUcsQ0FBQyxvUUFBb1EsQ0FBQyxDQUFDO1FBQzNSLE1BQU0sa0JBQWtCLEdBQUcsNkNBQXNCLENBQUMsV0FBVyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBRW5FLE1BQU0sWUFBWSxHQUFHLDJQQUEyUCxRQUFRLENBQUMsV0FBVyxDQUFDLEVBQUUsQ0FBQztRQUN4UyxNQUFNLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxPQUFPLENBQUMsWUFBWSxDQUFDLENBQUM7UUFDakQsTUFBTSxDQUFDLGtCQUFrQixDQUFDLE1BQU0sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUNqRCxDQUFDLENBQUMsQ0FB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QUFjLEVBQUUsRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFFLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxZQUFZLENBQUMsQ0FBQztJQUM3RixDQUFDLENBQUMsQ0FBQztJQUVILElBQUksQ0FBQyxtSEFBbUgsRUFBRSxHQUFHLEVBQUU7UUFDN0gsTUFBTSxjQUFjLEdBQUcsQ0FBQyxNQUFNLEVBQUUsUUFBUSxFQUFFLFVBQVUsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRSxNQUFNLEVBQUUsU0FBUyxDQUFDLENBQUM7UUFDakcsTUFBTSxZQUFZLEdBQUcsMkNBQTJDLFFBQVEsQ0FBQyxjQUFjLENBQUMsRUFBRSxDQUFDO1FBRTNGLE1BQU0sQ0FBQyw2Q0FBc0IsQ0FBQyxjQUFjLEVBQUUsRUFBRSxTQUFTLEVBQUUsRUFBRSxFQUFFLFNBQVMsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLFlBQVksQ0FBQyxDQUFDO0lBQzFHLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBtZDVoYXNoIH0gZnJvbSAnLi4vLi4vbGliL2hlbHBlcnMtaW50ZXJuYWwnO1xuaW1wb3J0IHsgbWFrZVVuaXF1ZVJlc291cmNlTmFtZSB9IGZyb20gJy4uLy4uL2xpYi9wcml2YXRlL3VuaXF1ZS1yZXNvdXJjZS1uYW1lJztcblxuY29uc3QgcGF0aEhhc2ggPSAocGF0aDogc3RyaW5nW10pOiBzdHJpbmcgPT4ge1xuICByZXR1cm4gbWQ1aGFzaChwYXRoLmpvaW4oJy8nKSkuc2xpY2UoMCwgOCkudG9VcHBlckNhc2UoKTtcbn07XG5cbmRlc2NyaWJlKCdtYWtlVW5pcXVlUmVzb3VyY2VOYW1lIHRlc3RzJywgKCkgPT4ge1xuICB0ZXN0KCd1bmlxdWUgcmVzb3VyY2UgbmFtZSBpcyBqdXN0IHJlc291cmNlIG5hbWUgd2hlbiB0aGUgcmVzb3VyY2UgaXMgdG9wIGxldmVsLCBzaG9ydCBlbm91Z2gsIGhhcyBubyBub25hbHBoYW51bWVyaWMgY2hhcmFjdGVycycsICgpID0+IHtcbiAgICBjb25zdCB1bmlxdWVSZXNvdXJjZU5hbWUgPSBtYWtlVW5pcXVlUmVzb3VyY2VOYW1lKFsndG9wbGV2ZWxyZXNvdXJjZSddLCB7fSk7XG4gICAgZXhwZWN0KHVuaXF1ZVJlc291cmNlTmFtZSkudG9FcXVhbCgndG9wbGV2ZWxyZXNvdXJjZScpO1xuICB9KTtcblxuICB0ZXN0KCd1bmlxdWUgcmVzb3VyY2UgbmFtZSBpcyBzaG9ydGVuZWQgd2l0aCBhIGhhc2ggYWRkZWQgd2hlbiByZXNvdXJjZSBpcyB0b3AgbGV2ZWwgYW5kIHJlc291cmNlIG5hbWUgaXMgdG9vIGxvbmcnLCAoKSA9PiB7XG4gICAgY29uc3QgdG9vTG9uZ05hbWUgPSBbJ2FuYW1ldGhhdGlzc2xpZ2h0bHlsb25nZXJ0aGFuMjU2Y2hhcmFjdGVyc3RoYXRpc2Fsc29hdG9wbGV2ZWxyZXNvdXJjZXNvdGhlcmVpc29ubHlvbmV2YWx1ZWludGhpc2FycmF5YW5kYXBwYXJlbnRseWJyZXZpdHlpc25vdHRoZXN0cm9uZ3BvaW50b2Z0aGVwZXJzb253aG9uYW1lZHRoaXNyZXNvdXJjZXdoaWNoSWJldHRoZXl3aWxsY29tZXRvcmVncmV0bGF0ZXJidXRpdGlzd2hhdGl0aXNhbnl3aG9kbGV0aGlzZnVuY3Rpb25zaG91bGRzaG9ydGVudGhpcyddO1xuICAgIGNvbnN0IHVuaXF1ZVJlc291cmNlTmFtZSA9IG1ha2VVbmlxdWVSZXNvdXJjZU5hbWUodG9vTG9uZ05hbWUsIHt9KTtcblxuICAgIGNvbnN0IGV4cGVjdGVkTmFtZSA9IGBhbmFtZXRoYXRpc3NsaWdodGx5bG9uZ2VydGhhbjI1NmNoYXJhY3RlcnN0aGF0aXNhbHNvYXRvcGxldmVscmVzb3VyY2Vzb3RoZXJlaXNvbmx5b25ldmFsdWVpbnRoaXNhcnJheWFuZGFwcGFyZW50bHlicmV2aXR5aXNuZ3BvaW50b2Z0aGVwZXJzb253aG9uYW1lZHRoaXNyZXNvdXJjZXdoaWNoSWJldHRoZXl3aWxsY29tZXRvcmVncmV0bGF0ZXJidXRpdGlzd2hhdGl0aXNhbnl3aG9kbGV0aGlzZnVuY3Rpb25zaG91bGRzaG9ydGVudGhpcyR7cGF0aEhhc2godG9vTG9uZ05hbWUpfWA7XG4gICAgZXhwZWN0KHVuaXF1ZVJlc291cmNlTmFtZSkudG9FcXVhbChleHBlY3RlZE5hbWUpO1xuICAgIGV4cGVjdCh1bmlxdWVSZXNvdXJjZU5hbWUubGVuZ3RoKS50b0VxdWFsKDI1Nik7XG4gIH0pO1xuXG4gIHRlc3QoJ3VuaXF1ZSByZXNvdXJjZSBuYW1lIHJlbW92ZXMgc3BlY2lhbCBjaGFyYWN0ZXJzIHdoZW4gcmVzb3VyY2UgaXMgdG9wIGxldmVsJywgKCkgPT4ge1xuICAgIGNvbnN0IGNvbXBvbmVudHNQYXRoID0gWydJLWxvdmUtc3BlY2lhbC1jaGFyYWN0ZXJzLcKvXFxcXFxcXyjjg4QpXy/Cry1mb3ItcmVhbC10aG91Z2gnXTtcbiAgICBjb25zdCBleHBlY3RlZE5hbWUgPSAnSWxvdmVzcGVjaWFsY2hhcmFjdGVyc2ZvcnJlYWx0aG91Z2gnO1xuXG4gICAgZXhwZWN0KG1ha2VVbmlxdWVSZXNvdXJjZU5hbWUoY29tcG9uZW50c1BhdGgsIHt9KSkudG9FcXVhbChleHBlY3RlZE5hbWUpO1xuICB9KTtcblxuICB0ZXN0KCd1bmlxdWUgcmVzb3VyY2UgbmFtZSBzaG9ydGVucyBmcm9tIHRoZSBtaWRkbGUgYW5kIGFkZHMgYSBoYXNoIHdoZW4gbWF4TGVuZ3RoIGlzIGRlZmluZWQsIHJlc291cmNlIGlzIHRvcCBsZXZlbCwgYW5kIHJlc291cmNlIG5hbWUgaXMgbG9uZ2VyIHRoYW4gbWF4JywgKCkgPT4ge1xuICAgIGNvbnN0IGNvbXBvbmVudHNQYXRoID0gWydUaGlzSXNTdGlsbExvbmdlclRoYW5UaGVBbGxvd2VkTGVuZ3RoJ107XG4gICAgY29uc3QgZXhwZWN0ZWROYW1lID0gYFRoaXNJc0xlbmd0aCR7cGF0aEhhc2goY29tcG9uZW50c1BhdGgpfWA7XG5cbiAgICBleHBlY3QobWFrZVVuaXF1ZVJlc291cmNlTmFtZShjb21wb25lbnRzUGF0aCwgeyBtYXhMZW5ndGg6IDIwIH0pKS50b0VxdWFsKGV4cGVjdGVkTmFtZSk7XG4gIH0pO1xuXG4gIHRlc3QoJ3VuaXF1ZSByZXNvdXJjZSBuYW1lIHNob3J0ZW5zIGZyb20gdGhlIG1pZGRsZSBhbmQgYWRkcyBhIGhhc2ggd2hlbiBtYXhMZW5ndGggaXMgZGVmaW5lZCwgcmVzb3VyY2UgaXMgdG9wIGxldmVsLCByZXNvdXJjZSBuYW1lIGlzIGxvbmdlciB0aGFuIG1heCwgYW5kIHNlcGFyYXRvciBpcyBwcm92aWRlZCcsICgpID0+IHtcbiAgICBjb25zdCBjb21wb25lbnRzUGF0aCA9IFsnVGhpc0lzU3RpbGxMb25nZXJUaGFuVGhlQWxsb3dlZExlbmd0aCddO1xuICAgIGNvbnN0IGV4cGVjdGVkTmFtZSA9IGBUaGlzSXNlbmd0aC0ke3BhdGhIYXNoKGNvbXBvbmVudHNQYXRoKX1gO1xuXG4gICAgZXhwZWN0KG1ha2VVbmlxdWVSZXNvdXJjZU5hbWUoY29tcG9uZW50c1BhdGgsIHsgbWF4TGVuZ3RoOiAyMCwgc2VwYXJhdG9yOiAnLScgfSkpLnRvRXF1YWwoZXhwZWN0ZWROYW1lKTtcbiAgfSk7XG5cbiAgdGVzdCgndW5pcXVlIHJlc291cmNlIG5hbWUgcmVtb3ZlcyBzcGVjaWFsIGNoYXJhY3RlcnMgYW5kIG1ha2VzIG5vIG90aGVyIGNoYW5nZXMgd2hlbiByZXNvdWNlIGlzIHRvcCBsZXZlbCBhbmQgdG9vIGxvbmcgd2l0aCBzcGVjaWFsIGNoYXJhY3RlcnMgYnV0IHByb3BlciBsZW5ndGggd2l0aG91dCcsICgpID0+IHtcbiAgICBjb25zdCB0b29Mb25nTmFtZSA9IFsnYS1uYW1lLXRoYXQtaXMtc2xpZ2h0bHktbG9uZ2VyLXRoYW4tMjU2LWNoYXJhY3RlcnMtdGhhdC1pcy1hbHNvLWEtdG9wLWxldmVsLXJlc291cmNlLXNvLXRoZXJlLWlzLW9ubHktb25lLXZhbHVlLWluLXRoaXMtYXJyYXktYW5kLWFwcGFyZW50bHktYnJldml0eS1pcy1ub3QtdGhlLXN0cm9uZy1wb2ludC1vZi10aGUtcGVyc29uLXdoby1uYW1lZC10aGlzLXJlc291cmNlLXdoaWNoLUktYmV0LXRoZXktd2lsbC1jb21lLXRvLXJlZ3JldC1sYXRlci1idXQtaXQtaXMtd2hhdC1pdC1pcyddO1xuICAgIGNvbnN0IGV4cGVjdGVkTmFtZSA9ICdhbmFtZXRoYXRpc3NsaWdodGx5bG9uZ2VydGhhbjI1NmNoYXJhY3RlcnN0aGF0aXNhbHNvYXRvcGxldmVscmVzb3VyY2Vzb3RoZXJlaXNvbmx5b25ldmFsdWVpbnRoaXNhcnJheWFuZGFwcGFyZW50bHlicmV2aXR5aXNub3R0aGVzdHJvbmdwb2ludG9mdGhlcGVyc29ud2hvbmFtZWR0aGlzcmVzb3VyY2V3aGljaEliZXR0aGV5d2lsbGNvbWV0b3JlZ3JldGxhdGVyYnV0aXRpc3doYXRpdGlzJztcblxuICAgIGV4cGVjdChtYWtlVW5pcXVlUmVzb3VyY2VOYW1lKHRvb0xvbmdOYW1lLCB7fSkpLnRvRXF1YWwoZXhwZWN0ZWROYW1lKTtcbiAgfSk7XG5cbiAgdGVzdCgndW5pcXVlIHJlc291cmNlIG5hbWUgbGVhdmVzIGluIGFsbG93ZWQgc3BlY2lhbCBjaGFyYWN0ZXJzIGFuZCBhZGRzIG5vIGhhc2ggd2hlbiByZXNvdXJjZSBpcyB0b3AgbGV2ZWwgYW5kIHJlc291Y2UgbmFtZSBpcyBzaG9ydCBlbm91Z24nLCAoKSA9PiB7XG4gICAgY29uc3QgY29tcG9uZW50c1BhdGggPSBbJ8KvXFxcXFxcXyjjg4QpXy/Cry1zaHJ1Z2dpZS1nZXRzLXRvLXN0YXktwq9cXFxcXFxfKOODhClfL8KvJ107XG4gICAgY29uc3QgZXhwZWN0ZWROYW1lID0gJ8KvXFxfKOODhClfL8Kvc2hydWdnaWVnZXRzdG9zdGF5wq9cXF8o44OEKV8vwq8nO1xuXG4gICAgZXhwZWN0KG1ha2VVbmlxdWVSZXNvdXJjZU5hbWUoY29tcG9uZW50c1BhdGgsIHsgYWxsb3dlZFNwZWNpYWxDaGFyYWN0ZXJzOiAnwq9cXFxcXFxfKOODhCkvJywgbWF4TGVuZ3RoOiAyMDAgfSkpLnRvRXF1YWwoZXhwZWN0ZWROYW1lKTtcbiAgfSk7XG5cbiAgdGVzdCgndW5pcXVlIHJlc291cmNlIG5hbWUgbGVhdmVzIGluIGFsbG93ZWQgc3BlY2lhbCBjaGFyYWN0ZXJzIGFuZCBhZGRzIG5vIGhhc2ggb3Igc2VwYXJhdG9ycyB3aGVuIHJlc291cmNlIGlzIHRvcCBsZXZlbCBhbmQgcmVzb3VjZSBuYW1lIGlzIHNob3J0IGVub3VnbicsICgpID0+IHtcbiAgICBjb25zdCBjb21wb25lbnRzUGF0aCA9IFsnwq9cXFxcXFxfKOODhClfL8KvLXNocnVnZ2llLWdldHMtdG8tc3RheS3Cr1xcXFxcXF8o44OEKV8vwq8nXTtcbiAgICBjb25zdCBleHBlY3RlZE5hbWUgPSAnwq9cXF8o44OEKV8vwq9zaHJ1Z2dpZWdldHN0b3N0YXnCr1xcXyjjg4QpXy/Cryc7XG5cbiAgICBleHBlY3QobWFrZVVuaXF1ZVJlc291cmNlTmFtZShjb21wb25lbnRzUGF0aCwgeyBhbGxvd2VkU3BlY2lhbENoYXJhY3RlcnM6ICfCr1xcXFxcXF8o44OEKS8nLCBtYXhMZW5ndGg6IDIwMCwgc2VwYXJhdG9yOiAnLScgfSkpLnRvRXF1YWwoZXhwZWN0ZWROYW1lKTtcbiAgfSk7XG5cbiAgdGVzdCgndW5pcXVlIHJlc291cmNlIG5hbWUgaXMgc2hvcnRlbmVkIHdpdGggYSBoYXNoIGFuZCBzZXBhcmF0b3IgYWRkZWQgd2hlbiByZXNvdXJjZSBpcyB0b3AgbGV2ZWwsIHJlc291cmNlIG5hbWUgaXMgdG9vIGxvbmcsIGFuZCBzZXBhcmF0b3IgaXMgcHJvdmlkZWQnLCAoKSA9PiB7XG4gICAgY29uc3QgdG9vTG9uZ05hbWUgPSBbJ2FuYW1ldGhhdGlzc2xpZ2h0bHlsb25nZXJ0aGFuMjU2Y2hhcmFjdGVyc3RoYXRpc2Fsc29hdG9wbGV2ZWxyZXNvdXJjZXNvdGhlcmVpc29ubHlvbmV2YWx1ZWludGhpc2FycmF5YW5kYXBwYXJlbnRseWJyZXZpdHlpc25vdHRoZXN0cm9uZ3BvaW50b2Z0aGVwZXJzb253aG9uYW1lZHRoaXNyZXNvdXJjZXdoaWNoSWJldHRoZXl3aWxsY29tZXRvcmVncmV0bGF0ZXJidXRpdGlzd2hhdGl0aXNhbnl3aG9kbGV0aGlzZnVuY3Rpb25zaG91bGRzaG9ydGVudGhpcyddO1xuICAgIGNvbnN0IHVuaXF1ZVJlc291cmNlTmFtZSA9IG1ha2VVbmlxdWVSZXNvdXJjZU5hbWUodG9vTG9uZ05hbWUsIHsgc2VwYXJhdG9yOiAnficgfSk7XG5cbiAgICBjb25zdCBleHBlY3RlZE5hbWUgPSBgYW5hbWV0aGF0aXNzbGlnaHRseWxvbmdlcnRoYW4yNTZjaGFyYWN0ZXJzdGhhdGlzYWxzb2F0b3BsZXZlbHJlc291cmNlc290aGVyZWlzb25seW9uZXZhbHVlaW50aGlzYXJyYXlhbmRhcHBhcmVudGx5YnJldml0eWlzbnBvaW50b2Z0aGVwZXJzb253aG9uYW1lZHRoaXNyZXNvdXJjZXdoaWNoSWJldHRoZXl3aWxsY29tZXRvcmVncmV0bGF0ZXJidXRpdGlzd2hhdGl0aXNhbnl3aG9kbGV0aGlzZnVuY3Rpb25zaG91bGRzaG9ydGVudGhpc34ke3BhdGhIYXNoKHRvb0xvbmdOYW1lKX1gO1xuICAgIGV4cGVjdCh1bmlxdWVSZXNvdXJjZU5hbWUpLnRvRXF1YWwoZXhwZWN0ZWROYW1lKTtcbiAgICBleHBlY3QodW5pcXVlUmVzb3VyY2VOYW1lLmxlbmd0aCkudG9FcXVhbCgyNTYpO1xuICB9KTtcblxuICB0ZXN0KCd1bmlxdWUgcmVzb3VyY2UgbmFtZSByZW1vdmVzIHNwZWNpYWwgY2hhcmFjdGVycyB3aGVuIHRoZXkgYXJlIGluY2x1ZGVkIGluIHRoZSBjb21wb25lbnRzIG5hbWVzJywgKCkgPT4ge1xuICAgIGNvbnN0IGNvbXBvbmVudHNQYXRoID0gWydJJywgJ2xvdmUnLCAnc3BlY2lhbCcsICdjaGFyYWN0ZXJzJywgJ8KvXFxcXFxcXyjjg4QpXy/CrycsICdmb3InLCAncmVhbCcsICd0aG91Z2gnXTtcbiAgICBjb25zdCBleHBlY3RlZE5hbWUgPSBgSWxvdmVzcGVjaWFsY2hhcmFjdGVyc2ZvcnJlYWx0aG91Z2gke3BhdGhIYXNoKGNvbXBvbmVudHNQYXRoKX1gO1xuXG4gICAgZXhwZWN0KG1ha2VVbmlxdWVSZXNvdXJjZU5hbWUoY29tcG9uZW50c1BhdGgsIHt9KSkudG9FcXVhbChleHBlY3RlZE5hbWUpO1xuICB9KTtcblxuICB0ZXN0KCd1bmlxdWUgcmVzb3VyY2UgbmFtZSByZW1vdmVzIHNwZWNpYWwgY2hhcmFjdGVycyB0aGF0IGFyZSBub3QgYWxsb3cgbGlzdGVkIGFuZCBsZWF2ZXMgdGhlIGFsbG93ZWQgb25lcycsICgpID0+IHtcbiAgICBjb25zdCBjb21wb25lbnRzUGF0aCA9IFsnSS1sb3ZlLXNwZWNpYWwtY2hhcmFjdGVycy0nLCAnwq9cXFxcXFxfKOODhClfL8KvJywgJy1mb3ItcmVhbC10aG91Z2gtJ107XG4gICAgY29uc3QgZXhwZWN0ZWROYW1lID0gYEktbG92ZS1zcGVjaWFsLWNoYXJhY3RlcnMtLWZvci1yZWFsLXRob3VnaC0ke3BhdGhIYXNoKGNvbXBvbmVudHNQYXRoKX1gO1xuXG4gICAgZXhwZWN0KG1ha2VVbmlxdWVSZXNvdXJjZU5hbWUoY29tcG9uZW50c1BhdGgsIHsgYWxsb3dlZFNwZWNpYWxDaGFyYWN0ZXJzOiAnLScgfSkpLnRvRXF1YWwoZXhwZWN0ZWROYW1lKTtcbiAgfSk7XG5cbiAgdGVzdCgndW5pcXVlIHJlc291cmNlIG5hbWUgYWRkcyBpbiBzZXBhcmF0b3IgYW5kIGFkZHMgaGFzaCB3aGVuIHNlcGFyYXRvciBpcyBwcm92aWRlZCBhbmQgbmFtZSBpcyBub3QgdG9vIGxvbmcnLCAoKSA9PiB7XG4gICAgY29uc3QgY29tcG9uZW50c1BhdGggPSBbJ1RoaXMnLCAndW5pcXVlJywgJ3Jlc291cmNlJywgJ25hbWUnLCAnbmVlZHMnLCAnYScsICdzZXBhcmF0b3InXTtcbiAgICBjb25zdCBleHBlY3RlZE5hbWUgPSBgVGhpcy4qLnVuaXF1ZS4qLnJlc291cmNlLioubmFtZS4qLm5lZWRzLiouYS4qLnNlcGFyYXRvci4qLiR7cGF0aEhhc2goY29tcG9uZW50c1BhdGgpfWA7XG5cbiAgICBleHBlY3QobWFrZVVuaXF1ZVJlc291cmNlTmFtZShjb21wb25lbnRzUGF0aCwgeyBzZXBhcmF0b3I6ICcuKi4nIH0pKS50b0VxdWFsKGV4cGVjdGVkTmFtZSk7XG4gIH0pO1xuXG4gIHRlc3QoJ3VuaXF1ZSByZXNvdXJjZSBuYW1lIGFkZHMgaW4gc2VwYXJhdG9yLCBhZGRzIGhhc2gsIGFuZCBzaG9ydGVucyBuYW1lIHdoZW4gc2VwYXJhdG9yIGlzIHByb3ZpZGVkIGFuZCBuYW1lIHRvbyBsb25nJywgKCkgPT4ge1xuICAgIGNvbnN0IGNvbXBvbmVudHNQYXRoID0gWydUaGlzJywgJ3VuaXF1ZScsICdyZXNvdXJjZScsICduYW1lJywgJ2lzJywgJ2xvbmdlcicsICd0aGFuJywgJ2FsbG93ZWQnXTtcbiAgICBjb25zdCBleHBlY3RlZE5hbWUgPSBgVGhpcy91bmlxdWUvcmVzb3VyY2Vsb25nZXIvdGhhbi9hbGxvd2VkLyR7cGF0aEhhc2goY29tcG9uZW50c1BhdGgpfWA7XG5cbiAgICBleHBlY3QobWFrZVVuaXF1ZVJlc291cmNlTmFtZShjb21wb25lbnRzUGF0aCwgeyBtYXhMZW5ndGg6IDQ4LCBzZXBhcmF0b3I6ICcvJyB9KSkudG9FcXVhbChleHBlY3RlZE5hbWUpO1xuICB9KTtcbn0pOyJdfQ==