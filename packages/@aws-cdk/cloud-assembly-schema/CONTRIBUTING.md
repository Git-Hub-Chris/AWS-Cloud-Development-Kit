## Cloud Assembly Schema

Making changes to this module should only happen when you introduce new cloud assembly capabilities.

> For example: supporting the `--target` option when building docker containers.

If you decided these changes are necessary, simply go ahead and make the necessary modifications to 
the interfaces that describe the schema. Our tests and validation mechanisms will ensure you make those 
changes correctly.

### Schema Generation

The schema can be generated by running `yarn update-schema`. It reads the [`manifest.ts`](./lib/manifest.ts) file and writes
an updated json schema to [`cloud-assembly.schema.json`](./schema/cloud-assembly.schema.json)

Note that it is not generated as part of the build, this is to ensure developers will be intentional when making 
changes to the schema. If changes to the code are perfomed, without generating a new schema, the tests will fail:

```console
$ cdk-test
FAIL test/schema.test.js (5.902s)
  ✓ manifest save (7ms)
  ✕ cloud-assembly.json.schema is correct (5304ms)
  ✓ manifest load (4ms)
  ✓ manifest load fails for invalid nested property (5ms)
  ✓ manifest load fails for invalid artifact type (1ms)
  ✓ stack-tags are deserialized properly (1ms)
  ✓ can access random metadata (1ms)

  ● cloud-assembly.json.schema is correct

    Whoops, Looks like the schema has changed. Did you forget to run 'yarn update-schema'?
```

### Schema Validation

Being a **stable** `jsii` module, it undergoes strict API compatibility checks with the help
of [`jsii-diff`](https://github.com/aws/jsii/tree/master/packages/jsii-diff). 
This means that performing breaking changes, such as:

- Adding a required property. (same as changing from *optional* to *required*)
- Changing the type of the property.

Will be rejected.

In addition, the interfaces defined here are programatically exposed to users, via the [`manifest`](../cx-api/lib/cloud-assembly.ts#L42)
property of the `CloudAssembly` class. This means that the following are also considered breaking changes:

- Changing a property from *required* to *optional*.
- Removing an optional property.
- Removing a required property.
