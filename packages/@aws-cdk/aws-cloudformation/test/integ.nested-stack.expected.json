{
  "Stack": {
    "Resources": {
      "SubscriberQueueC193DC66": {
        "Type": "AWS::SQS::Queue"
      },
      "SubscriberQueuePolicy25A0799E": {
        "Type": "AWS::SQS::QueuePolicy",
        "Properties": {
          "PolicyDocument": {
            "Statement": [
              {
                "Action": "sqs:SendMessage",
                "Condition": {
                  "ArnEquals": {
                    "aws:SourceArn": {
                      "Fn::GetAtt": [
                        "NestedStack1NestedStackNestedStack1NestedStackResource7E64AD52",
                        "Outputs.nestedstackstestNestedStack1topic02C2D1254Ref"
                      ]
                    }
                  }
                },
                "Effect": "Allow",
                "Principal": {
                  "Service": "sns.amazonaws.com"
                },
                "Resource": {
                  "Fn::GetAtt": [
                    "SubscriberQueueC193DC66",
                    "Arn"
                  ]
                }
              },
              {
                "Action": "sqs:SendMessage",
                "Condition": {
                  "ArnEquals": {
                    "aws:SourceArn": {
                      "Fn::GetAtt": [
                        "NestedStack1NestedStackNestedStack1NestedStackResource7E64AD52",
                        "Outputs.nestedstackstestNestedStack1topic1474E5389Ref"
                      ]
                    }
                  }
                },
                "Effect": "Allow",
                "Principal": {
                  "Service": "sns.amazonaws.com"
                },
                "Resource": {
                  "Fn::GetAtt": [
                    "SubscriberQueueC193DC66",
                    "Arn"
                  ]
                }
              },
              {
                "Action": "sqs:SendMessage",
                "Condition": {
                  "ArnEquals": {
                    "aws:SourceArn": {
                      "Fn::GetAtt": [
                        "NestedStack1NestedStackNestedStack1NestedStackResource7E64AD52",
                        "Outputs.nestedstackstestNestedStack1topic22C710DC4Ref"
                      ]
                    }
                  }
                },
                "Effect": "Allow",
                "Principal": {
                  "Service": "sns.amazonaws.com"
                },
                "Resource": {
                  "Fn::GetAtt": [
                    "SubscriberQueueC193DC66",
                    "Arn"
                  ]
                }
              }
            ],
            "Version": "2012-10-17"
          },
          "Queues": [
            {
              "Ref": "SubscriberQueueC193DC66"
            }
          ]
        }
      },
      "SubscriberQueuenestedstackstestNestedStack1topic089C5EB1396F65087": {
        "Type": "AWS::SNS::Subscription",
        "Properties": {
          "Protocol": "sqs",
          "TopicArn": {
            "Fn::GetAtt": [
              "NestedStack1NestedStackNestedStack1NestedStackResource7E64AD52",
              "Outputs.nestedstackstestNestedStack1topic02C2D1254Ref"
            ]
          },
          "Endpoint": {
            "Fn::GetAtt": [
              "SubscriberQueueC193DC66",
              "Arn"
            ]
          }
        }
      },
      "SubscriberQueuenestedstackstestNestedStack1topic1150E1A929A2C267E": {
        "Type": "AWS::SNS::Subscription",
        "Properties": {
          "Protocol": "sqs",
          "TopicArn": {
            "Fn::GetAtt": [
              "NestedStack1NestedStackNestedStack1NestedStackResource7E64AD52",
              "Outputs.nestedstackstestNestedStack1topic1474E5389Ref"
            ]
          },
          "Endpoint": {
            "Fn::GetAtt": [
              "SubscriberQueueC193DC66",
              "Arn"
            ]
          }
        }
      },
      "SubscriberQueuenestedstackstestNestedStack1topic209B8719858511914": {
        "Type": "AWS::SNS::Subscription",
        "Properties": {
          "Protocol": "sqs",
          "TopicArn": {
            "Fn::GetAtt": [
              "NestedStack1NestedStackNestedStack1NestedStackResource7E64AD52",
              "Outputs.nestedstackstestNestedStack1topic22C710DC4Ref"
            ]
          },
          "Endpoint": {
            "Fn::GetAtt": [
              "SubscriberQueueC193DC66",
              "Arn"
            ]
          }
        }
      },
      "NestedStack1NestedStackNestedStack1NestedStackResource7E64AD52": {
        "Type": "AWS::CloudFormation::Stack",
        "Properties": {
          "TemplateURL": {
            "Fn::Join": [
              "",
              [
                "https://s3.",
                {
                  "Ref": "AWS::Region"
                },
                ".",
                {
                  "Ref": "AWS::URLSuffix"
                },
                "/",
                {
                  "Ref": "AssetParametersf3f09ec34d59b03270346926dc9298b8300df69c65edc0522507830dd4a97f8eS3Bucket3945C047"
                },
                "/",
                {
                  "Fn::Select": [
                    0,
                    {
                      "Fn::Split": [
                        "||",
                        {
                          "Ref": "AssetParametersf3f09ec34d59b03270346926dc9298b8300df69c65edc0522507830dd4a97f8eS3VersionKey2EE8C10A"
                        }
                      ]
                    }
                  ]
                },
                {
                  "Fn::Select": [
                    1,
                    {
                      "Fn::Split": [
                        "||",
                        {
                          "Ref": "AssetParametersf3f09ec34d59b03270346926dc9298b8300df69c65edc0522507830dd4a97f8eS3VersionKey2EE8C10A"
                        }
                      ]
                    }
                  ]
                }
              ]
            ]
          },
          "Parameters": {
            "TopicNamePrefix": "Prefix1",
            "referencetonestedstackstestSubscriberQueue39409787Ref": {
              "Ref": "SubscriberQueueC193DC66"
            }
          }
        }
      },
      "NestedStack2NestedStackNestedStack2NestedStackResourceFDF82E43": {
        "Type": "AWS::CloudFormation::Stack",
        "Properties": {
          "TemplateURL": {
            "Fn::Join": [
              "",
              [
                "https://s3.",
                {
                  "Ref": "AWS::Region"
                },
                ".",
                {
                  "Ref": "AWS::URLSuffix"
                },
                "/",
                {
                  "Ref": "AssetParameters45243d26c80391394a05adecbb0afd6fff947bca4fe2e1b0b5f3e905d5ae904aS3Bucket107FF573"
                },
                "/",
                {
                  "Fn::Select": [
                    0,
                    {
                      "Fn::Split": [
                        "||",
                        {
                          "Ref": "AssetParameters45243d26c80391394a05adecbb0afd6fff947bca4fe2e1b0b5f3e905d5ae904aS3VersionKeyC63A1F96"
                        }
                      ]
                    }
                  ]
                },
                {
                  "Fn::Select": [
                    1,
                    {
                      "Fn::Split": [
                        "||",
                        {
                          "Ref": "AssetParameters45243d26c80391394a05adecbb0afd6fff947bca4fe2e1b0b5f3e905d5ae904aS3VersionKeyC63A1F96"
                        }
                      ]
                    }
                  ]
                }
              ]
            ]
          },
          "Parameters": {
            "TopicNamePrefix": "Prefix2"
          }
        }
      }
    },
    "Parameters": {
      "AssetParametersf3f09ec34d59b03270346926dc9298b8300df69c65edc0522507830dd4a97f8eS3Bucket3945C047": {
        "Type": "String",
        "Description": "S3 bucket for asset \"f3f09ec34d59b03270346926dc9298b8300df69c65edc0522507830dd4a97f8e\""
      },
      "AssetParametersf3f09ec34d59b03270346926dc9298b8300df69c65edc0522507830dd4a97f8eS3VersionKey2EE8C10A": {
        "Type": "String",
        "Description": "S3 key for asset version \"f3f09ec34d59b03270346926dc9298b8300df69c65edc0522507830dd4a97f8e\""
      },
      "AssetParametersf3f09ec34d59b03270346926dc9298b8300df69c65edc0522507830dd4a97f8eArtifactHash246B99B7": {
        "Type": "String",
        "Description": "Artifact hash for asset \"f3f09ec34d59b03270346926dc9298b8300df69c65edc0522507830dd4a97f8e\""
      },
      "AssetParameters45243d26c80391394a05adecbb0afd6fff947bca4fe2e1b0b5f3e905d5ae904aS3Bucket107FF573": {
        "Type": "String",
        "Description": "S3 bucket for asset \"45243d26c80391394a05adecbb0afd6fff947bca4fe2e1b0b5f3e905d5ae904a\""
      },
      "AssetParameters45243d26c80391394a05adecbb0afd6fff947bca4fe2e1b0b5f3e905d5ae904aS3VersionKeyC63A1F96": {
        "Type": "String",
        "Description": "S3 key for asset version \"45243d26c80391394a05adecbb0afd6fff947bca4fe2e1b0b5f3e905d5ae904a\""
      },
      "AssetParameters45243d26c80391394a05adecbb0afd6fff947bca4fe2e1b0b5f3e905d5ae904aArtifactHashC28F299E": {
        "Type": "String",
        "Description": "Artifact hash for asset \"45243d26c80391394a05adecbb0afd6fff947bca4fe2e1b0b5f3e905d5ae904a\""
      }
    }
  },
  "NestedStacks": {
    "nested-stacks-test": [
      {
        "NestedStack1NestedStackNestedStack1NestedStackResource7E64AD52": {
          "Template": {
            "Metadata": {
              "aws:cdk:path": "nestedstackstestNestedStack1C289F6D5"
            },
            "Parameters": {
              "TopicNamePrefix": {
                "Type": "String"
              },
              "referencetonestedstackstestSubscriberQueue39409787Ref": {
                "Type": "String"
              }
            },
            "Resources": {
              "topic096865AFD": {
                "Type": "AWS::SNS::Topic",
                "Properties": {
                  "DisplayName": {
                    "Fn::Join": [
                      "",
                      [
                        {
                          "Ref": "TopicNamePrefix"
                        },
                        "-0"
                      ]
                    ]
                  }
                }
              },
              "topic119487C5C": {
                "Type": "AWS::SNS::Topic",
                "Properties": {
                  "DisplayName": {
                    "Fn::Join": [
                      "",
                      [
                        {
                          "Ref": "TopicNamePrefix"
                        },
                        "-1"
                      ]
                    ]
                  }
                }
              },
              "topic2EE13C5A5": {
                "Type": "AWS::SNS::Topic",
                "Properties": {
                  "DisplayName": {
                    "Fn::Join": [
                      "",
                      [
                        {
                          "Ref": "TopicNamePrefix"
                        },
                        "-2"
                      ]
                    ]
                  }
                }
              },
              "fnServiceRole5D180AFD": {
                "Type": "AWS::IAM::Role",
                "Properties": {
                  "AssumeRolePolicyDocument": {
                    "Statement": [
                      {
                        "Action": "sts:AssumeRole",
                        "Effect": "Allow",
                        "Principal": {
                          "Service": "lambda.amazonaws.com"
                        }
                      }
                    ],
                    "Version": "2012-10-17"
                  },
                  "ManagedPolicyArns": [
                    {
                      "Fn::Join": [
                        "",
                        [
                          "arn:",
                          {
                            "Ref": "AWS::Partition"
                          },
                          ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
                        ]
                      ]
                    }
                  ]
                }
              },
              "fn5FF616E3": {
                "Type": "AWS::Lambda::Function",
                "Properties": {
                  "Code": {
                    "ZipFile": "console.error(\"hi\")"
                  },
                  "Handler": "index.handler",
                  "Role": {
                    "Fn::GetAtt": [
                      "fnServiceRole5D180AFD",
                      "Arn"
                    ]
                  },
                  "Runtime": "nodejs10.x",
                  "Environment": {
                    "Variables": {
                      "TOPIC_ARN": "",
                      "QUEUE_URL": {
                        "Ref": "referencetonestedstackstestSubscriberQueue39409787Ref"
                      }
                    }
                  }
                },
                "DependsOn": [
                  "fnServiceRole5D180AFD"
                ]
              }
            },
            "Outputs": {
              "nestedstackstestNestedStack1topic02C2D1254Ref": {
                "Value": {
                  "Ref": "topic096865AFD"
                }
              },
              "nestedstackstestNestedStack1topic1474E5389Ref": {
                "Value": {
                  "Ref": "topic119487C5C"
                }
              },
              "nestedstackstestNestedStack1topic22C710DC4Ref": {
                "Value": {
                  "Ref": "topic2EE13C5A5"
                }
              }
            }
          }
        }
      },
      {
        "NestedStack2NestedStackNestedStack2NestedStackResourceFDF82E43": {
          "Template": {
            "Metadata": {
              "aws:cdk:path": "nestedstackstestNestedStack209C5218A"
            },
            "Parameters": {
              "TopicNamePrefix": {
                "Type": "String"
              }
            },
            "Resources": {
              "topic096865AFD": {
                "Type": "AWS::SNS::Topic",
                "Properties": {
                  "DisplayName": {
                    "Fn::Join": [
                      "",
                      [
                        {
                          "Ref": "TopicNamePrefix"
                        },
                        "-0"
                      ]
                    ]
                  }
                }
              },
              "topic119487C5C": {
                "Type": "AWS::SNS::Topic",
                "Properties": {
                  "DisplayName": {
                    "Fn::Join": [
                      "",
                      [
                        {
                          "Ref": "TopicNamePrefix"
                        },
                        "-1"
                      ]
                    ]
                  }
                }
              }
            }
          }
        }
      }
    ]
  }
}