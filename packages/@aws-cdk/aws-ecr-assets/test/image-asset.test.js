"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const fs = require("fs");
const path = require("path");
const cdk_build_tools_1 = require("@aws-cdk/cdk-build-tools");
const cxschema = require("@aws-cdk/cloud-assembly-schema");
const core_1 = require("@aws-cdk/core");
const cxapi = require("@aws-cdk/cx-api");
const lib_1 = require("../lib");
const DEMO_IMAGE_ASSET_HASH = '0a3355be12051c9984bf2b0b2bba4e6ea535968e5b6e7396449701732fe5ed14';
describe('image asset', () => {
    test('fails if the directory does not exist', () => {
        const stack = new core_1.Stack();
        // THEN
        expect(() => {
            new lib_1.DockerImageAsset(stack, 'MyAsset', {
                directory: `/does/not/exist/${Math.floor(Math.random() * 9999)}`,
            });
        }).toThrow(/Cannot find image directory at/);
    });
    test('fails if the directory does not contain a Dockerfile', () => {
        const stack = new core_1.Stack();
        // THEN
        expect(() => {
            new lib_1.DockerImageAsset(stack, 'Asset', {
                directory: __dirname,
            });
        }).toThrow(/Cannot find file at/);
    });
    test('fails if the file does not exist', () => {
        const stack = new core_1.Stack();
        // THEN
        expect(() => {
            new lib_1.DockerImageAsset(stack, 'Asset', {
                directory: __dirname,
                file: 'doesnt-exist',
            });
        }).toThrow(/Cannot find file at/);
    });
    test('docker directory is staged if asset staging is enabled', () => {
        const app = new core_1.App();
        const stack = new core_1.Stack(app);
        const image = new lib_1.DockerImageAsset(stack, 'MyAsset', {
            directory: path.join(__dirname, 'demo-image'),
        });
        const session = app.synth();
        expect(fs.existsSync(path.join(session.directory, `asset.${image.assetHash}`, 'Dockerfile'))).toBe(true);
        expect(fs.existsSync(path.join(session.directory, `asset.${image.assetHash}`, 'index.py'))).toBe(true);
    });
    (0, cdk_build_tools_1.describeDeprecated)('docker ignore option', () => {
        // The 'ignoreMode' property is both deprecated and not deprecated in DockerImageAssetProps interface.
        // The interface through a complex set of inheritance chain has a 'ignoreMode' prop that is deprecated
        // and another 'ignoreMode' prop that is not deprecated.
        // Using a 'describeDeprecated' block here since there's no way to work around this craziness.
        // When the deprecated property is removed source code, this block can be dropped.
        test('docker directory is staged without files specified in .dockerignore', () => {
            const app = new core_1.App();
            testDockerDirectoryIsStagedWithoutFilesSpecifiedInDockerignore(app);
        });
        test('docker directory is staged without files specified in .dockerignore with IgnoreMode.GLOB', () => {
            const app = new core_1.App();
            testDockerDirectoryIsStagedWithoutFilesSpecifiedInDockerignore(app, core_1.IgnoreMode.GLOB);
        });
    });
    test('docker directory is staged with allow-listed files specified in .dockerignore', () => {
        const app = new core_1.App();
        const stack = new core_1.Stack(app);
        const image = new lib_1.DockerImageAsset(stack, 'MyAsset', {
            directory: path.join(__dirname, 'allow-listed-image'),
        });
        const session = app.synth();
        // Only the files exempted above should be included.
        expect(fs.existsSync(path.join(session.directory, `asset.${image.assetHash}`, '.dockerignore'))).toBe(true);
        expect(fs.existsSync(path.join(session.directory, `asset.${image.assetHash}`, 'Dockerfile'))).toBe(true);
        expect(fs.existsSync(path.join(session.directory, `asset.${image.assetHash}`, 'index.py'))).toBe(true);
        expect(fs.existsSync(path.join(session.directory, `asset.${image.assetHash}`, 'foobar.txt'))).toBe(true);
        expect(fs.existsSync(path.join(session.directory, `asset.${image.assetHash}`, 'subdirectory'))).toBe(true);
        expect(fs.existsSync(path.join(session.directory, `asset.${image.assetHash}`, 'subdirectory', 'baz.txt'))).toBe(true);
        expect(!fs.existsSync(path.join(session.directory, `asset.${image.assetHash}`, 'node_modules'))).toBe(true);
        expect(!fs.existsSync(path.join(session.directory, `asset.${image.assetHash}`, 'node_modules', 'one'))).toBe(true);
        expect(!fs.existsSync(path.join(session.directory, `asset.${image.assetHash}`, 'node_modules', 'some_dep'))).toBe(true);
        expect(!fs.existsSync(path.join(session.directory, `asset.${image.assetHash}`, 'node_modules', 'some_dep', 'file'))).toBe(true);
    });
    test('docker directory is staged without files specified in exclude option', () => {
        const app = new core_1.App();
        testDockerDirectoryIsStagedWithoutFilesSpecifiedInExcludeOption(app);
    });
    test('docker directory is staged without files specified in exclude option with IgnoreMode.GLOB', () => {
        const app = new core_1.App();
        testDockerDirectoryIsStagedWithoutFilesSpecifiedInExcludeOption(app, core_1.IgnoreMode.GLOB);
    });
    test('fails if using tokens in build args keys or values', () => {
        // GIVEN
        const stack = new core_1.Stack();
        const token = core_1.Lazy.string({ produce: () => 'foo' });
        const expected = /Cannot use tokens in keys or values of "buildArgs" since they are needed before deployment/;
        // THEN
        expect(() => new lib_1.DockerImageAsset(stack, 'MyAsset1', {
            directory: path.join(__dirname, 'demo-image'),
            buildArgs: { [token]: 'value' },
        })).toThrow(expected);
        expect(() => new lib_1.DockerImageAsset(stack, 'MyAsset2', {
            directory: path.join(__dirname, 'demo-image'),
            buildArgs: { key: token },
        })).toThrow(expected);
    });
    (0, cdk_build_tools_1.testDeprecated)('fails if using token as repositoryName', () => {
        // GIVEN
        const stack = new core_1.Stack();
        const token = core_1.Lazy.string({ produce: () => 'foo' });
        // THEN
        expect(() => new lib_1.DockerImageAsset(stack, 'MyAsset1', {
            directory: path.join(__dirname, 'demo-image'),
            repositoryName: token,
        })).toThrow(/Cannot use Token as value of 'repositoryName'/);
    });
    test('docker build options are included in the asset id', () => {
        // GIVEN
        const app = new core_1.App();
        const stack = new core_1.Stack(app);
        const directory = path.join(__dirname, 'demo-image-custom-docker-file');
        const asset1 = new lib_1.DockerImageAsset(stack, 'Asset1', { directory });
        const asset2 = new lib_1.DockerImageAsset(stack, 'Asset2', { directory, file: 'Dockerfile.Custom' });
        const asset3 = new lib_1.DockerImageAsset(stack, 'Asset3', { directory, target: 'NonDefaultTarget' });
        const asset4 = new lib_1.DockerImageAsset(stack, 'Asset4', { directory, buildArgs: { opt1: '123', opt2: 'boom' } });
        const asset5 = new lib_1.DockerImageAsset(stack, 'Asset5', { directory, file: 'Dockerfile.Custom', target: 'NonDefaultTarget' });
        const asset6 = new lib_1.DockerImageAsset(stack, 'Asset6', { directory, extraHash: 'random-extra' });
        const asset7 = new lib_1.DockerImageAsset(stack, 'Asset7', { directory, outputs: ['123'] });
        const asset8 = new lib_1.DockerImageAsset(stack, 'Asset8', { directory, buildSecrets: { mySecret: core_1.DockerBuildSecret.fromSrc('abc.txt') } });
        const asset9 = new lib_1.DockerImageAsset(stack, 'Asset9', { directory, buildSecrets: { mySecret: core_1.DockerBuildSecret.fromEnvironment('NODE_ENV') } });
        expect(asset1.assetHash).toEqual('13248c55633f3b198a628bb2ea4663cb5226f8b2801051bd0c725950266fd590');
        expect(asset2.assetHash).toEqual('36bf205fb9adc5e45ba1c8d534158a0aed96d190eff433af1d90f3b94f96e751');
        expect(asset3.assetHash).toEqual('4c85bd70e73117b7129c2defbe6dc40a8a3872329f4ddca18d75afa671b38276');
        expect(asset4.assetHash).toEqual('8a91219a7bb0f58b3282dd84acbf4c03c49c765be54ffb7b125be6a50b6c5645');
        expect(asset5.assetHash).toEqual('c02bfba13b2e7e1ff5c778a76e10296b9e8d17f7f8252d097f4170ae04ce0eb4');
        expect(asset6.assetHash).toEqual('3528d6838647a5e9011b0f35aec514d03ad11af05a94653cdcf4dacdbb070a06');
        expect(asset7.assetHash).toEqual('ced0a3076efe217f9cbdff0943e543f36ecf77f70b9a6fe28b8633deb728a462');
        expect(asset8.assetHash).toEqual('ffc2718e616141d18c8f4623d13cdfd68cb8f010ca5db31c916c8b5f10c162be');
        expect(asset9.assetHash).toEqual('d1cc03a8409c94a7975c6464f1900a2cdf5cc6f86922fb14a6aeac4515c5785b');
    });
    (0, cdk_build_tools_1.testDeprecated)('repositoryName is included in the asset id', () => {
        const stack = new core_1.Stack();
        const directory = path.join(__dirname, 'demo-image-custom-docker-file');
        const asset1 = new lib_1.DockerImageAsset(stack, 'Asset1', { directory });
        const asset2 = new lib_1.DockerImageAsset(stack, 'Asset2', { directory, repositoryName: 'foo' });
        expect(asset1.assetHash).toEqual('13248c55633f3b198a628bb2ea4663cb5226f8b2801051bd0c725950266fd590');
        expect(asset2.assetHash).toEqual('b78978ca702a8eccd37804ce31d76cd83a695b557dbf95aeb109332ee8b1fd32');
    });
    describe('imageTag is correct for different stack synthesizers', () => {
        const stack1 = new core_1.Stack();
        const stack2 = new core_1.Stack(undefined, undefined, {
            synthesizer: new core_1.DefaultStackSynthesizer({
                dockerTagPrefix: 'banana',
            }),
        });
        const directory = path.join(__dirname, 'demo-image-custom-docker-file');
        const asset1 = new lib_1.DockerImageAsset(stack1, 'Asset1', { directory });
        const asset2 = new lib_1.DockerImageAsset(stack2, 'Asset2', { directory });
        test('stack with default synthesizer', () => {
            expect(asset1.assetHash).toEqual('13248c55633f3b198a628bb2ea4663cb5226f8b2801051bd0c725950266fd590');
            expect(asset1.imageTag).toEqual('13248c55633f3b198a628bb2ea4663cb5226f8b2801051bd0c725950266fd590');
        });
        test('stack with overwritten synthesizer', () => {
            expect(asset2.assetHash).toEqual('13248c55633f3b198a628bb2ea4663cb5226f8b2801051bd0c725950266fd590');
            expect(asset2.imageTag).toEqual('banana13248c55633f3b198a628bb2ea4663cb5226f8b2801051bd0c725950266fd590');
        });
    });
});
function testDockerDirectoryIsStagedWithoutFilesSpecifiedInDockerignore(app, ignoreMode) {
    const stack = new core_1.Stack(app);
    const image = new lib_1.DockerImageAsset(stack, 'MyAsset', {
        ignoreMode,
        directory: path.join(__dirname, 'dockerignore-image'),
    });
    const session = app.synth();
    // .dockerignore itself should be included in output to be processed during docker build
    expect(fs.existsSync(path.join(session.directory, `asset.${image.assetHash}`, '.dockerignore'))).toBe(true);
    expect(fs.existsSync(path.join(session.directory, `asset.${image.assetHash}`, 'Dockerfile'))).toBe(true);
    expect(fs.existsSync(path.join(session.directory, `asset.${image.assetHash}`, 'index.py'))).toBe(true);
    expect(!fs.existsSync(path.join(session.directory, `asset.${image.assetHash}`, 'foobar.txt'))).toBe(true);
    expect(fs.existsSync(path.join(session.directory, `asset.${image.assetHash}`, 'subdirectory'))).toBe(true);
    expect(fs.existsSync(path.join(session.directory, `asset.${image.assetHash}`, 'subdirectory', 'baz.txt'))).toBe(true);
}
function testDockerDirectoryIsStagedWithoutFilesSpecifiedInExcludeOption(app, ignoreMode) {
    const stack = new core_1.Stack(app);
    const image = new lib_1.DockerImageAsset(stack, 'MyAsset', {
        directory: path.join(__dirname, 'dockerignore-image'),
        exclude: ['subdirectory'],
        ignoreMode,
    });
    const session = app.synth();
    expect(fs.existsSync(path.join(session.directory, `asset.${image.assetHash}`, '.dockerignore'))).toBe(true);
    expect(fs.existsSync(path.join(session.directory, `asset.${image.assetHash}`, 'Dockerfile'))).toBe(true);
    expect(fs.existsSync(path.join(session.directory, `asset.${image.assetHash}`, 'index.py'))).toBe(true);
    expect(!fs.existsSync(path.join(session.directory, `asset.${image.assetHash}`, 'foobar.txt'))).toBe(true);
    expect(!fs.existsSync(path.join(session.directory, `asset.${image.assetHash}`, 'subdirectory'))).toBe(true);
    expect(!fs.existsSync(path.join(session.directory, `asset.${image.assetHash}`, 'subdirectory', 'baz.txt'))).toBe(true);
}
test('nested assemblies share assets: legacy synth edition', () => {
    // GIVEN
    const app = new core_1.App();
    const stack1 = new core_1.Stack(new core_1.Stage(app, 'Stage1'), 'Stack', { synthesizer: new core_1.LegacyStackSynthesizer() });
    const stack2 = new core_1.Stack(new core_1.Stage(app, 'Stage2'), 'Stack', { synthesizer: new core_1.LegacyStackSynthesizer() });
    // WHEN
    new lib_1.DockerImageAsset(stack1, 'Image', { directory: path.join(__dirname, 'demo-image') });
    new lib_1.DockerImageAsset(stack2, 'Image', { directory: path.join(__dirname, 'demo-image') });
    // THEN
    const assembly = app.synth();
    // Read the assets from the stack metadata
    for (const stageName of ['Stage1', 'Stage2']) {
        const stackArtifact = assembly.getNestedAssembly(`assembly-${stageName}`).artifacts.filter(isStackArtifact)[0];
        const assetMeta = stackArtifact.findMetadataByType(cxschema.ArtifactMetadataEntryType.ASSET);
        expect(assetMeta[0]).toEqual(expect.objectContaining({
            data: expect.objectContaining({
                path: `../asset.${DEMO_IMAGE_ASSET_HASH}`,
            }),
        }));
    }
});
test('nested assemblies share assets: default synth edition', () => {
    // GIVEN
    const app = new core_1.App();
    const stack1 = new core_1.Stack(new core_1.Stage(app, 'Stage1'), 'Stack', { synthesizer: new core_1.DefaultStackSynthesizer() });
    const stack2 = new core_1.Stack(new core_1.Stage(app, 'Stage2'), 'Stack', { synthesizer: new core_1.DefaultStackSynthesizer() });
    // WHEN
    new lib_1.DockerImageAsset(stack1, 'Image', { directory: path.join(__dirname, 'demo-image') });
    new lib_1.DockerImageAsset(stack2, 'Image', { directory: path.join(__dirname, 'demo-image') });
    // THEN
    const assembly = app.synth();
    // Read the asset manifests to verify the file paths
    for (const stageName of ['Stage1', 'Stage2']) {
        const manifestArtifact = assembly.getNestedAssembly(`assembly-${stageName}`).artifacts.filter(cxapi.AssetManifestArtifact.isAssetManifestArtifact)[0];
        const manifest = JSON.parse(fs.readFileSync(manifestArtifact.file, { encoding: 'utf-8' }));
        expect(manifest.dockerImages[DEMO_IMAGE_ASSET_HASH].source).toEqual({
            directory: `../asset.${DEMO_IMAGE_ASSET_HASH}`,
        });
    }
});
function isStackArtifact(x) {
    return x instanceof cxapi.CloudFormationStackArtifact;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW1hZ2UtYXNzZXQudGVzdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImltYWdlLWFzc2V0LnRlc3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSx5QkFBeUI7QUFDekIsNkJBQTZCO0FBQzdCLDhEQUE4RTtBQUM5RSwyREFBMkQ7QUFDM0Qsd0NBQXdJO0FBQ3hJLHlDQUF5QztBQUN6QyxnQ0FBMEM7QUFFMUMsTUFBTSxxQkFBcUIsR0FBRyxrRUFBa0UsQ0FBQztBQUVqRyxRQUFRLENBQUMsYUFBYSxFQUFFLEdBQUcsRUFBRTtJQUMzQixJQUFJLENBQUMsdUNBQXVDLEVBQUUsR0FBRyxFQUFFO1FBQ2pELE1BQU0sS0FBSyxHQUFHLElBQUksWUFBSyxFQUFFLENBQUM7UUFDMUIsT0FBTztRQUNQLE1BQU0sQ0FBQyxHQUFHLEVBQUU7WUFDVixJQUFJLHNCQUFnQixDQUFDLEtBQUssRUFBRSxTQUFTLEVBQUU7Z0JBQ3JDLFNBQVMsRUFBRSxtQkFBbUIsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLEdBQUcsSUFBSSxDQUFDLEVBQUU7YUFDakUsQ0FBQyxDQUFDO1FBQ0wsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLGdDQUFnQyxDQUFDLENBQUM7SUFFL0MsQ0FBQyxDQUFDLENBQUM7SUFFSCxJQUFJLENBQUMsc0RBQXNELEVBQUUsR0FBRyxFQUFFO1FBQ2hFLE1BQU0sS0FBSyxHQUFHLElBQUksWUFBSyxFQUFFLENBQUM7UUFDMUIsT0FBTztRQUNQLE1BQU0sQ0FBQyxHQUFHLEVBQUU7WUFDVixJQUFJLHNCQUFnQixDQUFDLEtBQUssRUFBRSxPQUFPLEVBQUU7Z0JBQ25DLFNBQVMsRUFBRSxTQUFTO2FBQ3JCLENBQUMsQ0FBQztRQUNMLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO0lBRXBDLENBQUMsQ0FBQyxDQUFDO0lBRUgsSUFBSSxDQUFDLGtDQUFrQyxFQUFFLEdBQUcsRUFB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QyxVQUFVLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsU0FBUyxFQUFFLFNBQVMsS0FBSyxDQUFDLFNBQVMsRUFBRSxFQUFFLFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDekcsTUFBTSxDQUFDLEVBQUUsQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsU0FBUyxFQUFFLFNBQVMsS0FBSyxDQUFDLFNBQVMsRUFBRSxFQUFFLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDdkcsTUFBTSxDQUFDLEVBQUUsQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsU0FBUyxFQUFFLFNBQVMsS0FBSyxDQUFDLFNBQVMsRUFBRSxFQUFFLFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDekcsTUFBTSxDQUFDLEVBQUUsQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsU0FBUyxFQUFFLFNBQVMsS0FBSyxDQUFDLFNBQVMsRUFBRSxFQUFFLGNBQWMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDM0csTUFBTSxDQUFDLEVBQUUsQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsU0FBUyxFQUFFLFNBQVMsS0FBSyxDQUFDLFNBQVMsRUFBRSxFQUFFLGNBQWMsRUFBRSxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3RILE1BQU0sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsU0FBUyxFQUFFLFNBQVMsS0FBSyxDQUFDLFNBQVMsRUFBRSxFQUFFLGNBQWMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDNUcsTUFBTSxDQUFDLENBQUMsRUFBRSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxTQUFTLEVBQUUsU0FBUyxLQUFLLENBQUMsU0FBUyxFQUFFLEVBQUUsY0FBYyxFQUFFLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDbkgsTUFBTSxDQUFDLENBQUMsRUFBRSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxTQUFTLEVBQUUsU0FBUyxLQUFLLENBQUMsU0FBUyxFQUFFLEVBQUUsY0FBYyxFQUFFLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDeEgsTUFBTSxDQUFDLENBQUMsRUFBRSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxTQUFTLEVBQUUsU0FBUyxLQUFLLENBQUMsU0FBUyxFQUFFLEVBQUUsY0FBYyxFQUFFLFVBQVUsRUFBRSxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ2xJLENBQUMsQ0FBQyxDQUFDO0lBRUgsSUFBSSxDQUFDLHNFQUFzRSxFQUFFLEdBQUcsRUFBRTtRQUNoRixNQUFNLEdBQUcsR0FBRyxJQUFJLFVBQUcsRUFBRSxDQUFDO1FBQ3RCLCtEQUErRCxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQ3ZFLENBQUMsQ0FBQyxDQUFDO0lBRUgsSUFBSSxDQUFDLDJGQUEyRixFQUFFLEdBQUcsRUFBRTtRQUNyRyxNQUFNLEdBQUcsR0FBRyxJQUFJLFVBQUcsRUFBRSxDQUFDO1FBQ3RCLCtEQUErRCxDQUFDLEdBQUcsRUFBRSxpQkFBVSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ3hGLENBQUMsQ0FBQyxDQUFDO0lBRUgsSUFBSSxDQUFDLG9EQUFvRCxFQUFFLEdBQUcsRUFBRTtRQUM5RCxRQUFRO1FBQ1IsTUFBTSxLQUFLLEdBQUcsSUFBSSxZQUFLLEVBQUUsQ0FBQztRQUMxQixNQUFNLEtBQUssR0FBRyxXQUFJLENBQUMsTUFBTSxDQUFDLEVBQUUsT0FBTyxFQUFFLEdBQUcsRUFBRSxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUM7UUFDcEQsTUFBTSxRQUFRLEdBQUcsNEZBQTRGLENBQUM7UUFFOUcsT0FBTztRQUNQLE1BQU0sQ0FBQyxHQUFHLEVBQUUsQ0FBQyxJQUFJLHNCQUFnQixDQUFDLEtBQUssRUFBRSxVQUFVLEVBQUU7WUFDbkQsU0FBUyxFQUFFLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLFlBQVksQ0FBQztZQUM3QyxTQUFTLEVBQUUsRUFBRSxDQUFDLEtBQUssQ0FBQyxFQUFFLE9BQU8sRUFBRTtTQUNoQyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUM7UUFFdEIsTUFBTSxDQUFDLEdBQUcsRUFBRSxDQUFDLElBQUksc0JBQWdCLENBQUMsS0FBSyxFQUFFLFVBQVUsRUFBRTtZQUNuRCxTQUFTLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsWUFBWSxDQUFDO1lBQzdDLFNBQVMsRUFBRSxFQUFFLEdBQUcsRUFBRSxLQUFLLEVBQUU7U0FDMUIsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDO0lBQ3hCLENBQUMsQ0FBQyxDQUFDO0lBRUgsSUFBQSxnQ0FBYyxFQUFDLHdDQUF3QyxFQUFFLEdBQUcsRUFBRTtRQUM1RCxRQUFRO1FBQ1IsTUFBTSxLQUFLLEdBQUcsSUFBSSxZQUFLLEVBQUUsQ0FBQztRQUMxQixNQUFNLEtBQUssR0FBRyxXQUFJLENBQUMsTUFBTSxDQUFDLEVBQUUsT0FBTyxFQUFFLEdBQUcsRUFBRSxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUM7UUFFcEQsT0FBTztRQUNQLE1BQU0sQ0FBQyxHQUFHLEVBQUUsQ0FBQyxJQUFJLHNCQUFnQixDQUFDLEtBQUssRUFBRSxVQUFVLEVBQUU7WUFDbkQsU0FBUyxFQUFFLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLFlBQVksQ0FBQztZQUM3QyxjQUFjLEVBQUUsS0FBSztTQUN0QixDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsK0NBQStDLENBQUMsQ0FBQztJQUMvRCxDQUFDLENBQUMsQ0FBQztJQUVILElBQUksQ0FBQyxtREFBbUQsRUFBRSxHQUFHLEVBQUU7UUFDN0QsUUFBUTtRQUNSLE1BQU0sR0FBRyxHQUFHLElBQUksVUFBRyxFQUFFLENBQUM7UUFDdEIsTUFBTSxLQUFLLEdBQUcsSUFBSSxZQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDN0IsTUFBTSxTQUFTLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsK0JBQStCLENBQUMsQ0FBQztRQUV4RSxNQUFNLE1BQU0sR0FBRyxJQUFJLHNCQUFnQixDQUFDLEtBQUssRUFBRSxRQUFRLEVBQUUsRUFBRSxTQUFTLEVBQUUsQ0FBQyxDQUFDO1FBQ3BFLE1BQU0sTUFBTSxHQUFHLElBQUksc0JBQWdCLENBQUMsS0FBSyxFQUFFLFFBQVEsRUFBRSxFQUFFLFNBQVMsRUFBRSxJQUFJLEVBQUUsbUJBQW1CLEVBQUUsQ0FBQyxDQUFDO1FBQy9GLE1BQU0sTUFBTSxHQUFHLElBQUksc0JBQWdCLENBQUMsS0FBSyxFQUFFLFFBQVEsRUFBRSxFQUFFLFNBQVMsRUFBRSxNQUFNLEVBQUUsa0JBQWtCLEVBQUUsQ0FBQyxDQUFDO1FBQ2hHLE1BQU0sTUFBTSxHQUFHLElBQUksc0JBQWdCLENBQUMsS0FBSyxFQUFFLFFBQVEsRUFBRSxFQUFFLFNBQVMsRUFBRSxTQUFTLEVBQUUsRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxNQUFNLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFDOUcsTUFBTSxNQUFNLEdBQUcsSUFBSSxzQkFBZ0IsQ0FBQyxLQUFLLEVBQUUsUUFBUSxFQUFFLEVBQUUsU0FBUyxFQUFFLElBQUksRUFBRSxtQkFBbUIsRUFBRSxNQUFNLEVBQUUsa0JBQWtCLEVBQUUsQ0FBQyxDQUFDO1FBQzNILE1BQU0sTUFBTSxHQUFHLElBQUksc0JBQWdCLENBQUMsS0FBSyxFQUFFLFFBQVEsRUFBRSxFQUFFLFNBQVMsRUFBRSxTQUFTLEVBQUUsY0FBYyxFQUFFLENBQUMsQ0FBQztRQUMvRixNQUFNLE1BQU0sR0FBRyxJQUFJLHNCQUFnQixDQUFDLEtBQUssRUFBRSxRQUFRLEVBQUUsRUFBRSxTQUFTLEVBQUUsT0FBTyxFQUFFLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQ3RGLE1BQU0sTUFBTSxHQUFHLElBQUksc0JBQWdCLENBQUMsS0FBSyxFQUFFLFFBQVEsRUFBRSxFQUFFLFNBQVMsRUFBRSxZQUFZLEVBQUUsRUFBRSxRQUFRLEVBQUUsd0JBQWlCLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBQ3RJLE1BQU0sTUFBTSxHQUFHLElBQUksc0JBQWdCLENBQUMsS0FBSyxFQUFFLFFBQVEsRUFBRSxFQUFFLFNBQVMsRUFBRSxZQUFZLEVBQUUsRUFBRSxRQUFRLEVBQUUsd0JBQWlCLENBQUMsZUFBZSxDQUFDLFVBQVUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBRS9JLE1BQU0sQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUMsT0FBTyxDQUFDLGtFQUFrRSxDQUFDLENBQUM7UUFDckcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQyxPQUFPLENBQUMsa0VBQWtFLENBQUMsQ0FBQztRQUNyRyxNQUFNLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxrRUFBa0UsQ0FBQyxDQUFDO1FBQ3JHLE1BQU0sQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUMsT0FBTyxDQUFDLGtFQUFrRSxDQUFDLENBQUM7UUFDckcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQyxPQUFPLENBQUMsa0VBQWtFLENBQUMsQ0FBQztRQUNyRyxNQUFNLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxrRUFBa0UsQ0FBQyxDQUFDO1FBQ3JHLE1BQU0sQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUMsT0FBTyxDQUFDLGtFQUFrRSxDQUFDLENBQUM7UUFDckcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQyxPQUFPLENBQUMsa0VBQWtFLENBQUMsQ0FBQztRQUNyRyxNQUFNLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxrRUFBa0UsQ0FBQyxDQUFDO0lBRXZHLENBQUMsQ0FBQyxDQUFDO0lBRUgsSUFBQSxnQ0FBYyxFQUFDLDRDQUE0QyxFQUFFLEdBQUcsRUFBRTtRQUNoRSxNQUFNLEtBQUssR0FBRyxJQUFJLFlBQUssRUFBRSxDQUFDO1FBQzFCLE1BQU0sU0FBUyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLCtCQUErQixDQUFDLENBQUM7UUFFeEUsTUFBTSxNQUFNLEdBQUcsSUFBSSxzQkFBZ0IsQ0FBQyxLQUFLLEVBQUUsUUFBUSxFQUFFLEVBQUUsU0FBUyxFQUFFLENBQUMsQ0FBQztRQUNwRSxNQUFNLE1BQU0sR0FBRyxJQUFJLHNCQUFnQixDQUFDLEtBQUssRUFBRSxRQUFRLEVBQUUsRUFBRSxTQUFTLEVBQUUsY0FBYyxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUM7UUFFM0YsTUFBTSxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQyxPQUFPLENBQUMsa0VBQWtFLENBQUMsQ0FBQztRQUNyRyxNQUFNLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxrRUFBa0UsQ0FBQyxDQUFDO0lBQ3ZHLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLHNEQUFzRCxFQUFFLEdBQUcsRUFBRTtRQUNwRSxNQUFNLE1BQU0sR0FBRyxJQUFJLFlBQUssRUFBRSxDQUFDO1FBQzNCLE1BQU0sTUFBTSxHQUFHLElBQUksWUFBSyxDQUFDLFNBQVMsRUFBRSxTQUFTLEVBQUU7WUFDN0MsV0FBVyxFQUFFLElBQUksOEJBQXVCLENBQUM7Z0JBQ3ZDLGVBQWUsRUFBRSxRQUFRO2FBQzFCLENBQUM7U0FDSCxDQUFDLENBQUM7UUFFSCxNQUFNLFNBQVMsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRSwrQkFBK0IsQ0FBQyxDQUFDO1FBRXhFLE1BQU0sTUFBTSxHQUFHLElBQUksc0JBQWdCLENBQUMsTUFBTSxFQUFFLFFBQVEsRUFBRSxFQUFFLFNBQVMsRUFBRSxDQUFDLENBQUM7UUFDckUsTUFBTSxNQUFNLEdBQUcsSUFBSSxzQkFBZ0IsQ0FBQyxNQUFNLEVBQUUsUUFBUSxFQUFFLEVBQUUsU0FBUyxFQUFFLENBQUMsQ0FBQztRQUVyRSxJQUFJLENBQUMsZ0NBQWdDLEVBQUUsR0FBRyxFQUFFO1lBQzFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUMsT0FBTyxDQUFDLGtFQUFrRSxDQUFDLENBQUM7WUFDckcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQyxPQUFPLENBQUMsa0VBQWtFLENBQUMsQ0FBQztRQUN0RyxDQUFDLENBQUMsQ0FBQztRQUVILElBQUksQ0FBQyxvQ0FBb0MsRUFBRSxHQUFHLEVBQUU7WUFDOUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQyxPQUFPLENBQUMsa0VBQWtFLENBQUMsQ0FBQztZQUNyRyxNQUFNLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDLE9BQU8sQ0FBQyx3RUFBd0UsQ0FBQyxDQUFDO1FBQzVHLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQztBQUVILFNBQVMsOERBQThELENBQUMsR0FBUSxFQUFFLFVBQXVCO0lBQ3ZHLE1BQU0sS0FBSyxHQUFHLElBQUksWUFBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQzdCLE1BQU0sS0FBSyxHQUFHLElBQUksc0JBQWdCLENBQUMsS0FBSyxFQUFFLFNBQVMsRUFBRTtRQUNuRCxVQUFVO1FBQ1YsU0FBUyxFQUFFLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLG9CQUFvQixDQUFDO0tBQ3RELENBQUMsQ0FBQztJQUVILE1BQU0sT0FBTyxHQUFHLEdBQUcsQ0FBQyxLQUFLLEVBQUUsQ0FBQztJQUU1Qix3RkFBd0Y7SUFDeEYsTUFBTSxDQUFDLEVBQUUsQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsU0FBUyxFQUFFLFNBQVMsS0FBSyxDQUFDLFNBQVMsRUFBRSxFQUFFLGVBQWUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDNUcsTUFBTSxDQUFDLEVBQUUsQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsU0FBUyxFQUFFLFNBQVMsS0FBSyxDQUFDLFNBQVMsRUFBRSxFQUFFLFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDekcsTUFBTSxDQUFDLEVBQUUsQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsU0FBUyxFQUFFLFNBQVMsS0FBSyxDQUFDLFNBQVMsRUFBRSxFQUFFLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDdkcsTUFBTSxDQUFDLENBQUMsRUFBRSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxTQUFTLEVBQUUsU0FBUyxLQUFLLENBQUMsU0FBUyxFQUFFLEVBQUUsWUFBWSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUMxRyxNQUFNLENBQUMsRUFBRSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxTQUFTLEVBQUUsU0FBUyxLQUFLLENBQUMsU0FBUyxFQUFFLEVBQUUsY0FBYyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUMzRyxNQUFNLENBQUMsRUFBRSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxTQUFTLEVBQUUsU0FBUyxLQUFLLENBQUMsU0FBUyxFQUFFLEVBQUUsY0FBYyxFQUFFLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7QUFDeEgsQ0FBQztBQUVELFNBQVMsK0RBQStELENBQUMsR0FBUSxFQUFFLFVBQXVCO0lBQ3hHLE1BQU0sS0FBSyxHQUFHLElBQUksWUFBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQzdCLE1BQU0sS0FBSyxHQUFHLElBQUksc0JBQWdCLENBQUMsS0FBSyxFQUFFLFNBQVMsRUFBRTtRQUNuRCxTQUFTLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsb0JBQW9CLENBQUM7UUFDckQsT0FBTyxFQUFFLENBQUMsY0FBYyxDQUFDO1FBQ3pCLFVBQVU7S0FDWCxDQUFDLENBQUM7SUFFSCxNQUFNLE9BQU8sR0FBRyxHQUFHLENBQUMsS0FBSyxFQUFFLENBQUM7SUFFNUIsTUFBTSxDQUFDLEVBQUUsQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsU0FBUyxFQUFFLFNBQVMsS0FBSyxDQUFDLFNBQVMsRUFBRSxFQUFFLGVBQWUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDNUcsTUFBTSxDQUFDLEVBQUUsQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsU0FBUyxFQUFFLFNBQVMsS0FBSyxDQUFDLFNBQVMsRUFBRSxFQUFFLFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDekcsTUFBTSxDQUFDLEVBQUUsQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsU0FBUyxFQUFFLFNBQVMsS0FBSyxDQUFDLFNBQVMsRUFBRSxFQUFFLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDdkcsTUFBTSxDQUFDLENBQUMsRUFBRSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxTQUFTLEVBQUUsU0FBUyxLQUFLLENBQUMsU0FBUyxFQUFFLEVBQUUsWUFBWSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUMxRyxNQUFNLENBQUMsQ0FBQyxFQUFFLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLFNBQVMsRUFBRSxTQUFTLEtBQUssQ0FBQyxTQUFTLEVBQUUsRUFBRSxjQUFjLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQzVHLE1BQU0sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsU0FBUyxFQUFFLFNBQVMsS0FBSyxDQUFDLFNBQVMsRUFBRSxFQUFFLGNBQWMsRUFBRSxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO0FBQ3pILENBQUM7QUFFRCxJQUFJLENBQUMsc0RBQXNELEVBQUUsR0FBRyxFQUFFO0lBQ2hFLFFBQVE7SUFDUixNQUFNLEdBQUcsR0FBRyxJQUFJLFVBQUcsRUFBRSxDQUFDO0lBQ3RCLE1BQU0sTUFBTSxHQUFHLElBQUksWUFBSyxDQUFDLElBQUksWUFBSyxDQUFDLEdBQUcsRUFBRSxRQUFRLENBQUMsRUFBRSxPQUFPLEVBQUUsRUFBRSxXQUFXLEVBQUUsSUFBSSw2QkFBc0IsRUFBRSxFQUFFLENBQUMsQ0FBQztJQUMzRyxNQUFNLE1BQU0sR0FBRyxJQUFJLFlBQUssQ0FBQyxJQUFJLFlBQUssQ0FBQyxHQUFHLEVBQUUsUUFBUSxDQUFDLEVBQUUsT0FBTyxFQUFFLEVBQUUsV0FBVyxFQUFFLElBQUksNkJBQXNCLEVBQUUsRUFBRSxDQUFDLENBQUM7SUFFM0csT0FBTztJQUNQLElBQUksc0JBQWdCLENBQUMsTUFBTSxFQUFFLE9BQU8sRUFBRSxFQUFFLFNBQVMsRUFBRSxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRSxZQUFZLENBQUMsRUFBRSxDQUFDLENBQUM7SUFDekYsSUFBSSxzQkFBZ0IsQ0FBQyxNQUFNLEVBQUUsT0FBTyxFQUFFLEVBQUUsU0FBUyxFQUFFLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLFlBQVksQ0FBQyxFQUFFLENBQUMsQ0FBQztJQUV6RixPQUFPO0lBQ1AsTUFBTSxRQUFRLEdBQUcsR0FBRyxDQUFDLEtBQUssRUFBRSxDQUFDO0lBRTdCLDBDQUEwQztJQUMxQyxLQUFLLE1BQU0sU0FBUyxJQUFJLENBQUMsUUFBUSxFQUFFLFFBQVEsQ0FBQyxFQUFFO1FBQzVDLE1BQU0sYUFBYSxHQUFHLFFBQVEsQ0FBQyxpQkFBaUIsQ0FBQyxZQUFZLFNBQVMsRUFBRSxDQUFDLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxlQUFlLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUMvRyxNQUFNLFNBQVMsR0FBRyxhQUFhLENBQUMsa0JBQWtCLENBQUMsUUFBUSxDQUFDLHlCQUF5QixDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQzdGLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQzFCLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQztZQUN0QixJQUFJLEVBQUUsTUFBTSxDQUFDLGdCQUFnQixDQUFDO2dCQUM1QixJQUFJLEVBQUUsWUFBWSxxQkFBcUIsRUFBRTthQUMxQyxDQUFDO1NBQ0gsQ0FBQyxDQUNILENBQUM7S0FDSDtBQUNILENBQUMsQ0FBQyxDQUFDO0FBRUgsSUFBSSxDQUFDLHVEQUF1RCxFQUFFLEdBQUcsRUFBRTtJQUNqRSxRQUFRO0lBQ1IsTUFBTSxHQUFHLEdBQUcsSUFBSSxVQUFHLEVBQUUsQ0FBQztJQUN0QixNQUFNLE1BQU0sR0FBRyxJQUFJLFlBQUssQ0FBQyxJQUFJLFlBQUssQ0FBQyxHQUFHLEVBQUUsUUFBUSxDQUFDLEVBQUUsT0FBTyxFQUFFLEVBQUUsV0FBVyxFQUFFLElBQUksOEJBQXVCLEVBQUUsRUFBRSxDQUFDLENBQUM7SUFDNUcsTUFBTSxNQUFNLEdBQUcsSUFBSSxZQUFLLENBQUMsSUFBSSxZQUFLLENBQUMsR0FBRyxFQUFFLFFBQVEsQ0FBQyxFQUFFLE9BQU8sRUFBRSxFQUFFLFdBQVcsRUFBRSxJQUFJLDhCQUF1QixFQUFFLEVBQUUsQ0FBQyxDQUFDO0lBRTVHLE9BQU87SUFDUCxJQUFJLHNCQUFnQixDQUFDLE1BQU0sRUFBRSxPQUFPLEVBQUUsRUFBRSxTQUFTLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsWUFBWSxDQUFDLEVBQUUsQ0FBQyxDQUFDO0lBQ3pGLElBQUksc0JBQWdCLENBQUMsTUFBTSxFQUFFLE9BQU8sRUFBRSxFQUFFLFNBQVMsRUFBRSxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRSxZQUFZLENBQUMsRUFBRSxDQUFDLENBQUM7SUFFekYsT0FBTztJQUNQLE1BQU0sUUFBUSxHQUFHLEdBQUcsQ0FBQyxLQUFLLEVBQUUsQ0FBQztJQUU3QixvREFBb0Q7SUFDcEQsS0FBSyxNQUFNLFNBQVMsSUFBSSxDQUFDLFFBQVEsRUFBRSxRQUFRLENBQUMsRUFBRTtRQUM1QyxNQUFNLGdCQUFnQixHQUFHLFFBQVEsQ0FBQyxpQkFBaUIsQ0FBQyxZQUFZLFNBQVMsRUFBRSxDQUFDLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMscUJBQXFCLENBQUMsdUJBQXVCLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUN0SixNQUFNLFFBQVEsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxZQUFZLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxFQUFFLEVBQUUsUUFBUSxFQUFFLE9BQU8sRUFBRSxDQUFDLENBQUMsQ0FBQztRQUUzRixNQUFNLENBQUMsUUFBUSxDQUFDLFlBQVksQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLE9BQU8sQ0FBQztZQUNsRSxTQUFTLEVBQUUsWUFBWSxxQkFBcUIsRUFBRTtTQUMvQyxDQUFDLENBQUM7S0FDSjtBQUNILENBQUMsQ0FBQyxDQUFDO0FBRUgsU0FBUyxlQUFlLENBQUMsQ0FBTTtJQUM3QixPQUFPLENBQUMsWUFBWSxLQUFLLENBQUMsMkJBQTJCLENBQUM7QUFDeEQsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIGZzIGZyb20gJ2ZzJztcbmltcG9ydCAqIGFzIHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgeyBkZXNjcmliZURlcHJlY2F0ZWQsIHRlc3REZXByZWNhdGVkIH0gZnJvbSAnQGF3cy1jZGsvY2RrLWJ1aWxkLXRvb2xzJztcbmltcG9ydCAqIGFzIGN4c2NoZW1hIGZyb20gJ0Bhd3MtY2RrL2Nsb3VkLWFzc2VtYmx5LXNjaGVtYSc7XG5pbXBvcnQgeyBBcHAsIERlZmF1bHRTdGFja1N5bnRoZXNpemVyLCBEb2NrZXJCdWlsZFNlY3JldCwgSWdub3JlTW9kZSwgTGF6eSwgTGVnYWN5U3RhY2tTeW50aGVzaXplciwgU3RhY2ssIFN0YWdlIH0gZnJvbSAnQGF3cy1jZGsvY29yZSc7XG5pbXBvcnQgKiBhcyBjeGFwaSBmcm9tICdAYXdzLWNkay9jeC1hcGknO1xuaW1wb3J0IHsgRG9ja2VySW1hZ2VBc3NldCB9IGZyb20gJy4uL2xpYic7XG5cbmNvbnN0IERFTU9fSU1BR0VfQVNTRVRfSEFTSCA9ICcwYTMzNTViZTEyMDUxYzk5ODRiZjJiMGIyYmJhNGU2ZWE1MzU5NjhlNWI2ZTczOTY0NDk3MDE3MzJmZTVlZDE0JztcblxuZGVzY3JpYmUoJ2ltYWdlIGFzc2V0JywgKCkgPT4ge1xuICB0ZXN0KCdmYWlscyBpZiB0aGUgZGlyZWN0b3J5IGRvZXMgbm90IGV4aXN0JywgKCkgPT4ge1xuICAgIGNvbnN0IHN0YWNrID0gbmV3IFN0YWNrKCk7XG4gICAgLy8gVEhFTlxuICAgIGV4cGVjdCgoKSA9PiB7XG4gICAgICBuZXcgRG9ja2VySW1hZ2VBc3NldChzdGFjaywgJ015QXNzZXQnLCB7XG4gICAgICAgIGRpcmVjdG9yeTogYC9kb2VzL25vdC9leGlzdC8ke01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDk5OTkpfWAsXG4gICAgICB9KTtcbiAgICB9KS50b1Rocm93KC9DYW5ub3QgZmluZCBpbWFnZSBkaXJlY3RvcnkgYXQvKTtcblxuICB9KTtcblxuICB0ZXN0KCdmYWlscyBpZiB0aGUgZGlyZWN0b3J5IGRvZXMgbm90IGNvbnRhaW4gYSBEb2NrZXJmaWxlJywgKCkgPT4ge1xuICAgIGNvbnN0IHN0YWNrID0gbmV3IFN0YWNrKCk7XG4gICAgLy8gVEhFTlxuICAgIGV4cGVjdCgoKSA9PiB7XG4gICAgICBuZXcgRG9ja2VySW1hZ2VBc3NldChzdGFjaywgJ0Fzc2V0Jywge1xuICAgICAgICBkaXJlY3Rvcnk6IF9fZGlybmFtZSxcbiAgICAgIH0pO1xuICAgIH0pLnRvVGhyb3coL0Nhbm5vdCBmaW5kIGZpbGUgYXQvKTtcblxuICB9KTtcblxuICB0ZXN0KCdmYWlscyBpZiB0aGUgZmlsZSBkb2VzIG5vdCBleGlzdCcsICgpID0+IHtcbiAgICBjb25zdCBzdGFjayA9IG5ldyBTdGFjaygpO1xuICAgIC8vIFRIRU5cbiAgICBleHBlY3QoKCkgPT4ge1xuICAgICAgbmV3IERvY2tlckltYWdlQXNzZXQoc3RhY2ssICdBc3NldCcsIHtcbiAgICAgICAgZGlyZWN0b3J5OiBfX2Rpcm5hbWUsXG4gICAgICAgIGZpbGU6ICdkb2VzbnQtZXhpc3QnLFxuICAgICAgfSk7XG4gICAgfSkudG9UaHJvdygvQ2Fubm90IGZpbmQgZmlsZSBhdC8pO1xuXG4gIH0pO1xuXG4gIHRlc3QoJ2RvY2tlciBkaXJlY3RvcnkgaXMgc3RhZ2VkIGlmIGFzc2V0IHN0YWdpbmcgaXMgZW5hYmxlZCcsICgpID0+IHtcbiAgICBjb25zdCBhcHAgPSBuZXcgQXBwKCk7XG4gICAgY29uc3Qgc3RhY2sgPSBuZXcgU3RhY2soYXBwKTtcbiAgICBjb25zdCBpbWFnZSA9IG5ldyBEb2NrZXJJbWFnZUFzc2V0KHN0YWNrLCAnTXlBc3NldCcsIHtcbiAgICAgIGRpcmVjdG9yeTogcGF0aC5qb2luKF9fZGlybmFtZSwgJ2RlbW8taW1hZ2UnKSxcbiAgICB9KTtcblxuICAgIGNvbnN0IHNlc3Npb24gPSBhcHAuc3ludGgoKTtcblxuICAgIGV4cGVjdChmcy5leGlzdHNTeW5jKHBhdGguam9pbihzZXNzaW9uLmRpcmVjdG9yeSwgYGFzc2V0LiR7aW1hZ2UuYXNzZXRIYXNofWAsICdEb2NrZXJmaWxlJykpKS50b0JlKHRydWUpO1xuICAgIGV4cGVjdChmcy5leGlzdHNTeW5jKHBhdGguam9pbihzZXNzaW9uLmRpcmVjdG9yeSwgYGFzc2V0LiR7aW1hZ2UuYXNzZXRIYXNofWAsICdpbmRleC5weScpKSkudG9CZSh0cnVlKTtcblxuICB9KTtcblxuICBkZXNjcmliZURlcHJlY2F0ZWQoJ2RvY2tlciBpZ25vcmUgb3B0aW9uJywgKCkgPT4ge1xuICAgIC8vIFRoZSAnaWdub3JlTW9kZScgcHJvcGVydHkgaXMgYm90aCBkZXByZWNhdGVkIGFuZCBub3QgZGVwcmVjYXRlZCBpbiBEb2NrZXJJbWFnZUFzc2V0UHJvcHMgaW50ZXJmYWNlLlxuICAgIC8vIFRoZSBpbnRlcmZhY2UgdGhyb3VnaCBhIGNvbXBsZXggc2V0IG9mIGluaGVyaXRhbmNlIGNoYWluIGhhcyBhICdpZ25vcmVNb2RlJyBwcm9wIHRoYXQgaXMgZGVwcmVjYXRlZFxuICAgIC8vIGFuZCBhbm90aGVyICdpZ25vcmVNb2RlJyBwcm9wIHRoYXQgaXMgbm90IGRlcHJlY2F0ZWQuXG4gICAgLy8gVXNpbmcgYSAnZGVzY3JpYmVEZXByZWNhdGVkJyBibG9jayBoZXJlIHNpbmNlIHRoZXJlJ3Mgbm8gd2F5IHRvIHdvcmsgYXJvdW5kIHRoaXMgY3JhemluZXNzLlxuICAgIC8vIFdoZW4gdGhlIGRlcHJlY2F0ZWQgcHJvcGVydHkgaXMgcmVtb3ZlZCBzb3VyY2UgY29kZSwgdGhpcyBibG9jayBjYW4gYmUgZHJvcHBlZC5cblxuICAgIHRlc3QoJ2RvY2tlciBkaXJlY3RvcnkgaXMgc3RhZ2VkIHdpdGhvdXQgZmlsZXMgc3BlY2lmaWVkIGluIC5kb2NrZXJpZ25vcmUnLCAoKSA9PiB7XG4gICAgICBjb25zdCBhcHAgPSBuZXcgQXBwKCk7XG4gICAgICB0ZXN0RG9ja2VyRGlyZWN0b3J5SXNTdGFnZWRXaXRob3V0RmlsZXNTcGVjaWZpZWRJbkRvY2tlcmlnbm9yZShhcHApO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnZG9ja2VyIGRpcmVjdG9yeSBpcyBzdGFnZWQgd2l0aG91dCBmaWxlcyBzcGVjaWZpZWQgaW4gLmRvY2tlcmlnbm9yZSB3aXRoIElnbm9yZU1vZGUuR0xPQicsICgpID0+IHtcbiAgICAgIGNvbnN0IGFwcCA9IG5ldyBBcHAoKTtcbiAgICAgIHRlc3REb2NrZXJEaXJlY3RvcnlJc1N0YWdlZFdpdGhvdXRGaWxlc1NwZWNpZmllZEluRG9ja2VyaWdub3JlKGFwcCwgSWdub3JlTW9kZS5HTE9CKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgdGVzdCgnZG9ja2VyIGRpcmVjdG9yeSBpcyBzdGFnZWQgd2l0aCBhbGxvdy1saXN0ZWQgZmlsZXMgc3BlY2lmaWVkIGluIC5kb2NrZXJpZ25vcmUnLCAoKSA9PiB7XG4gICAgY29uc3QgYXBwID0gbmV3IEFwcCgpO1xuICAgIGNvbnN0IHN0YWNrID0gbmV3IFN0YWNrKGFwcCk7XG4gICAgY29uc3QgaW1hZ2UgPSBuZXcgRG9ja2VySW1hZ2VBc3NldChzdGFjaywgJ015QXNzZXQnLCB7XG4gICAgICBkaXJlY3Rvcnk6IHBhdGguam9pbihfX2Rpcm5hbWUsICdhbGxvdy1saXN0ZWQtaW1hZ2UnKSxcbiAgICB9KTtcblxuICAgIGNvbnN0IHNlc3Npb24gPSBhcHAuc3ludGgoKTtcblxuICAgIC8vIE9ubHkgdGhlIGZpbGVzIGV4ZW1wdGVkIGFib3ZlIHNob3VsZCBiZSBpbmNsdWRlZC5cbiAgICBleHBlY3QoZnMuZXhpc3RzU3luYyhwYXRoLmpvaW4oc2Vzc2lvbi5kaXJlY3RvcnksIGBhc3NldC4ke2ltYWdlLmFzc2V0SGFzaH1gLCAnLmRvY2tlcmlnbm9yZScpKSkudG9CZSh0cnVlKTtcbiAgICBleHBlY3QoZnMuZXhpc3RzU3luYyhwYXRoLmpvaW4oc2Vzc2lvbi5kaXJlY3RvcnksIGBhc3NldC4ke2ltYWdlLmFzc2V0SGFzaH1gLCAnRG9ja2VyZmlsZScpKSkudG9CZSh0cnVlKTtcbiAgICBleHBlY3QoZnMuZXhpc3RzU3luYyhwYXRoLmpvaW4oc2Vzc2lvbi5kaXJlY3RvcnksIGBhc3NldC4ke2ltYWdlLmFzc2V0SGFzaH1gLCAnaW5kZXgucHknKSkpLnRvQmUodHJ1ZSk7XG4gICAgZXhwZWN0KGZzLmV4aXN0c1N5bmMocGF0aC5qb2luKHNlc3Npb24uZGlyZWN0b3J5LCBgYXNzZXQuJHtpbWFnZS5hc3NldEhhc2h9YCwgJ2Zvb2Jhci50eHQnKSkpLnRvQmUodHJ1ZSk7XG4gICAgZXhwZWN0KGZzLmV4aXN0c1N5bmMocGF0aC5qb2luKHNlc3Npb24uZGlyZWN0b3J5LCBgYXNzZXQuJHtpbWFnZS5hc3NldEhhc2h9YCwgJ3N1YmRpcmVjdG9yeScpKSkudG9CZSh0cnVlKTtcbiAgICBleHBlY3QoZnMuZXhpc3RzU3luYyhwYXRoLmpvaW4oc2Vzc2lvbi5kaXJlY3RvcnksIGBhc3NldC4ke2ltYWdlLmFzc2V0SGFzaH1gLCAnc3ViZGlyZWN0b3J5JywgJ2Jhei50eHQnKSkpLnRvQmUodHJ1ZSk7XG4gICAgZXhwZWN0KCFmcy5leGlzdHNTeW5jKHBhdGguam9pbihzZXNzaW9uLmRpcmVjdG9yeSwgYGFzc2V0LiR7aW1hZ2UuYXNzZXRIYXNofWAsICdub2RlX21vZHVsZXMnKSkpLnRvQmUodHJ1ZSk7XG4gICAgZXhwZWN0KCFmcy5leGlzdHNTeW5jKHBhdGguam9pbihzZXNzaW9uLmRpcmVjdG9yeSwgYGFzc2V0LiR7aW1hZ2UuYXNzZXRIYXNofWAsICdub2RlX21vZHVsZXMnLCAnb25lJykpKS50b0JlKHRydWUpO1xuICAgIGV4cGVjdCghZnMuZXhpc3RzU3luYyhwYXRoLmpvaW4oc2Vzc2lvbi5kaXJlY3RvcnksIGBhc3NldC4ke2ltYWdlLmFzc2V0SGFzaH1gLCAnbm9kZV9tb2R1bGVzJywgJ3NvbWVfZGVwJykpKS50b0JlKHRydWUpO1xuICAgIGV4cGVjdCghZnMuZXhpc3RzU3luYyhwYXRoLmpvaW4oc2Vzc2lvbi5kaXJlY3RvcnksIGBhc3NldC4ke2ltYWdlLmFzc2V0SGFzaH1gLCAnbm9kZV9tb2R1bGVzJywgJ3NvbWVfZGVwJywgJ2ZpbGUnKSkpLnRvQmUodHJ1ZSk7XG4gIH0pO1xuXG4gIHRlc3QoJ2RvY2tlciBkaXJlY3RvcnkgaXMgc3RhZ2VkIHdpdGhvdXQgZmlsZXMgc3BlY2lmaWVkIGluIGV4Y2x1ZGUgb3B0aW9uJywgKCkgPT4ge1xuICAgIGNvbnN0IGFwcCA9IG5ldyBBcHAoKTtcbiAgICB0ZXN0RG9ja2VyRGlyZWN0b3J5SXNTdGFnZWRXaXRob3V0RmlsZXNTcGVjaWZpZWRJbkV4Y2x1ZGVPcHRpb24oYXBwKTtcbiAgfSk7XG5cbiAgdGVzdCgnZG9ja2VyIGRpcmVjdG9yeSBpcyBzdGFnZWQgd2l0aG91dCBmaWxlcyBzcGVjaWZpZWQgaW4gZXhjbHVkZSBvcHRpb24gd2l0aCBJZ25vcmVNb2RlLkdMT0InLCAoKSA9PiB7XG4gICAgY29uc3QgYXBwID0gbmV3IEFwcCgpO1xuICAgIHRlc3REb2NrZXJEaXJlY3RvcnlJc1N0YWdlZFdpdGhvdXRGaWxlc1NwZWNpZmllZEluRXhjbHVkZU9wdGlvbihhcHAsIElnbm9yZU1vZGUuR0xPQik7XG4gIH0pO1xuXG4gIHRlc3QoJ2ZhaWxzIGlmIHVzaW5nIHRva2VucyBpbiBidWlsZCBhcmdzIGtleXMgb3IgdmFsdWVzJywgKCkgPT4ge1xuICAgIC8vIEdJVkVOXG4gICAgY29uc3Qgc3RhY2sgPSBuZXcgU3RhY2soKTtcbiAgICBjb25zdCB0b2tlbiA9IExhenkuc3RyaW5nKHsgcHJvZHVjZTogKCkgPT4gJ2ZvbycgfSk7XG4gICAgY29uc3QgZXhwZWN0ZWQgPSAvQ2Fubm90IHVzZSB0b2tlbnMgaW4ga2V5cyBvciB2YWx1ZXMgb2YgXCJidWlsZEFyZ3NcIiBzaW5jZSB0aGV5IGFyZSBuZWVkZWQgYmVmb3JlIGRlcGxveW1lbnQvO1xuXG4gICAgLy8gVEhFTlxuICAgIGV4cGVjdCgoKSA9PiBuZXcgRG9ja2VySW1hZ2VBc3NldChzdGFjaywgJ015QXNzZXQxJywge1xuICAgICAgZGlyZWN0b3J5OiBwYXRoLmpvaW4oX19kaXJuYW1lLCAnZGVtby1pbWFnZScpLFxuICAgICAgYnVpbGRBcmdzOiB7IFt0b2tlbl06ICd2YWx1ZScgfSxcbiAgICB9KSkudG9UaHJvdyhleHBlY3RlZCk7XG5cbiAgICBleHBlY3QoKCkgPT4gbmV3IERvY2tlckltYWdlQXNzZXQoc3RhY2ssICdNeUFzc2V0MicsIHtcbiAgICAgIGRpcmVjdG9yeTogcGF0aC5qb2luKF9fZGlybmFtZSwgJ2RlbW8taW1hZ2UnKSxcbiAgICAgIGJ1aWxkQXJnczogeyBrZXk6IHRva2VuIH0sXG4gICAgfSkpLnRvVGhyb3coZXhwZWN0ZWQpO1xuICB9KTtcblxuICB0ZXN0RGVwcmVjYXRlZCgnZmFpbHMgaWYgdXNpbmcgdG9rZW4gYXMgcmVwb3NpdG9yeU5hbWUnLCAoKSA9PiB7XG4gICAgLy8gR0lWRU5cbiAgICBjb25zdCBzdGFjayA9IG5ldyBTdGFjaygpO1xuICAgIGNvbnN0IHRva2VuID0gTGF6eS5zdHJpbmcoeyBwcm9kdWNlOiAoKSA9PiAnZm9vJyB9KTtcblxuICAgIC8vIFRIRU5cbiAgICBleHBlY3QoKCkgPT4gbmV3IERvY2tlckltYWdlQXNzZXQoc3RhY2ssICdNeUFzc2V0MScsIHtcbiAgICAgIGRpcmVjdG9yeTogcGF0aC5qb2luKF9fZGlybmFtZSwgJ2RlbW8taW1hZ2UnKSxcbiAgICAgIHJlcG9zaXRvcnlOYW1lOiB0b2tlbixcbiAgICB9KSkudG9UaHJvdygvQ2Fubm90IHVzZSBUb2tlbiBhcyB2YWx1ZSBvZiAncmVwb3NpdG9yeU5hbWUnLyk7XG4gIH0pO1xuXG4gIHRlc3QoJ2RvY2tlciBidWlsZCBvcHRpb25zIGFyZSBpbmNsdWRlZCBpbiB0aGUgYXNzZXQgaWQnLCAoKSA9PiB7XG4gICAgLy8gR0lWRU5cbiAgICBjb25zdCBhcHAgPSBuZXcgQXBwKCk7XG4gICAgY29uc3Qgc3RhY2sgPSBuZXcgU3RhY2soYXBwKTtcbiAgICBjb25zdCBkaXJlY3RvcnkgPSBwYXRoLmpvaW4oX19kaXJuYW1lLCAnZGVtby1pbWFnZS1jdXN0b20tZG9ja2VyLWZpbGUnKTtcblxuICAgIGNvbnN0IGFzc2V0MSA9IG5ldyBEb2NrZXJJbWFnZUFzc2V0KHN0YWNrLCAnQXNzZXQxJywgeyBkaXJlY3RvcnkgfSk7XG4gICAgY29uc3QgYXNzZXQyID0gbmV3IERvY2tlckltYWdlQXNzZXQoc3RhY2ssICdBc3NldDInLCB7IGRpcmVjdG9yeSwgZmlsZTogJ0RvY2tlcmZpbGUuQ3VzdG9tJyB9KTtcbiAgICBjb25zdCBhc3NldDMgPSBuZXcgRG9ja2VySW1hZ2VBc3NldChzdGFjaywgJ0Fzc2V0MycsIHsgZGlyZWN0b3J5LCB0YXJnZXQ6ICdOb25EZWZhdWx0VGFyZ2V0JyB9KTtcbiAgICBjb25zdCBhc3NldDQgPSBuZXcgRG9ja2VySW1hZ2VBc3NldChzdGFjaywgJ0Fzc2V0NCcsIHsgZGlyZWN0b3J5LCBidWlsZEFyZ3M6IHsgb3B0MTogJzEyMycsIG9wdDI6ICdib29tJyB9IH0pO1xuICAgIGNvbnN0IGFzc2V0NSA9IG5ldyBEb2NrZXJJbWFnZUFzc2V0KHN0YWNrLCAnQXNzZXQ1JywgeyBkaXJlY3RvcnksIGZpbGU6ICdEb2NrZXJmaWxlLkN1c3RvbScsIHRhcmdldDogJ05vbkRlZmF1bHRUYXJnZXQnIH0pO1xuICAgIGNvbnN0IGFzc2V0NiA9IG5ldyBEb2NrZXJJbWFnZUFzc2V0KHN0YWNrLCAnQXNzZXQ2JywgeyBkaXJlY3RvcnksIGV4dHJhSGFzaDogJ3JhbmRvbS1leHRyYScgfSk7XG4gICAgY29uc3QgYXNzZXQ3ID0gbmV3IERvY2tlckltYWdlQXNzZXQoc3RhY2ssICdBc3NldDcnLCB7IGRpcmVjdG9yeSwgb3V0cHV0czogWycxMjMnXSB9KTtcbiAgICBjb25zdCBhc3NldDggPSBuZXcgRG9ja2VySW1hZ2VBc3NldChzdGFjaywgJ0Fzc2V0OCcsIHsgZGlyZWN0b3J5LCBidWlsZFNlY3JldHM6IHsgbXlTZWNyZXQ6IERvY2tlckJ1aWxkU2VjcmV0LmZyb21TcmMoJ2FiYy50eHQnKSB9IH0pO1xuICAgIGNvbnN0IGFzc2V0OSA9IG5ldyBEb2NrZXJJbWFnZUFzc2V0KHN0YWNrLCAnQXNzZXQ5JywgeyBkaXJlY3RvcnksIGJ1aWxkU2VjcmV0czogeyBteVNlY3JldDogRG9ja2VyQnVpbGRTZWNyZXQuZnJvbUVudmlyb25tZW50KCdOT0RFX0VOVicpIH0gfSk7XG5cbiAgICBleHBlY3QoYXNzZXQxLmFzc2V0SGFzaCkudG9FcXVhbCgnMTMyNDhjNTU2MzNmM2IxOThhNjI4YmIyZWE0NjYzY2I1MjI2ZjhiMjgwMTA1MWJkMGM3MjU5NTAyNjZmZDU5MCcpO1xuICAgIGV4cGVjdChhc3NldDIuYXNzZXRIYXNoKS50b0VxdWFsKCczNmJmMjA1ZmI5YWRjNWU0NWJhMWM4ZDUzNDE1OGEwYWVkOTZkMTkwZWZmNDMzYWYxZDkwZjNiOTRmOTZlNzUxJyk7XG4gICAgZXhwZWN0KGFzc2V0My5hc3NldEhhc2gpLnRvRXF1YWwoJzRjODViZDcwZTczMTE3YjcxMjljMmRlZmJlNmRjNDBhOGEzODcyMzI5ZjRkZGNhMThkNzVhZmE2NzFiMzgyNzYnKTtcbiAgICBleHBlY3QoYXNzZXQ0LmFzc2V0SGFzaCkudG9FcXVhbCgnOGE5MTIxOWE3YmIwZjU4YjMyODJkZDg0YWNiZjRjMDNjNDljNzY1YmU1NGZmYjdiMTI1YmU2YTUwYjZjNTY0NScpO1xuICAgIGV4cGVjdChhc3NldDUuYXNzZXRIYXNoKS50b0VxdWFsKCdjMDJiZmJhMTNiMmU3ZTFmZjVjNzc4YTc2ZTEwMjk2YjllOGQxN2Y3ZjgyNTJkMDk3ZjQxNzBhZTA0Y2UwZWI0Jyk7XG4gICAgZXhwZWN0KGFzc2V0Ni5hc3NldEhhc2gpLnRvRXF1YWwoJzM1MjhkNjgzODY0N2E1ZTkwMTFiMGYzNWFlYzUxNGQwM2FkMTFhZjA1YTk0NjUzY2RjZjRkYWNkYmIwNzBhMDYnKTtcbiAgICBleHBlY3QoYXNzZXQ3LmFzc2V0SGFzaCkudG9FcXVhbCgnY2VkMGEzMDc2ZWZlMjE3ZjljYmRmZjA5NDNlNTQzZjM2ZWNmNzdmNzBiOWE2ZmUyOGI4NjMzZGViNzI4YTQ2MicpO1xuICAgIGV4cGVjdChhc3NldDguYXNzZXRIYXNoKS50b0VxdWFsKCdmZmMyNzE4ZTYxNjE0MWQxOGM4ZjQ2MjNkMTNjZGZkNjhjYjhmMDEwY2E1ZGIzMWM5MTZjOGI1ZjEwYzE2MmJlJyk7XG4gICAgZXhwZWN0KGFzc2V0OS5hc3NldEhhc2gpLnRvRXF1YWwoJ2QxY2MwM2E4NDA5Yzk0YTc5NzVjNjQ2NGYxOTAwYTJjZGY1Y2M2Zjg2OTIyZmIxNGE2YWVhYzQ1MTVjNTc4NWInKTtcblxuICB9KTtcblxuICB0ZXN0RGVwcmVjYXRlZCgncmVwb3NpdG9yeU5hbWUgaXMgaW5jbHVkZWQgaW4gdGhlIGFzc2V0IGlkJywgKCkgPT4ge1xuICAgIGNvbnN0IHN0YWNrID0gbmV3IFN0YWNrKCk7XG4gICAgY29uc3QgZGlyZWN0b3J5ID0gcGF0aC5qb2luKF9fZGlybmFtZSwgJ2RlbW8taW1hZ2UtY3VzdG9tLWRvY2tlci1maWxlJyk7XG5cbiAgICBjb25zdCBhc3NldDEgPSBuZXcgRG9ja2VySW1hZ2VBc3NldChzdGFjaywgJ0Fzc2V0MScsIHsgZGlyZWN0b3J5IH0pO1xuICAgIGNvbnN0IGFzc2V0MiA9IG5ldyBEb2NrZXJJbWFnZUFzc2V0KHN0YWNrLCAnQXNzZXQyJywgeyBkaXJlY3RvcnksIHJlcG9zaXRvcnlOYW1lOiAnZm9vJyB9KTtcblxuICAgIGV4cGVjdChhc3NldDEuYXNzZXRIYXNoKS50b0VxdWFsKCcxMzI0OGM1NTYzM2YzYjE5OGE2MjhiYjJlYTQ2NjNjYjUyMjZmOGIyODAxMDUxYmQwYzcyNTk1MDI2NmZkNTkwJyk7XG4gICAgZXhwZWN0KGFzc2V0Mi5hc3NldEhhc2gpLnRvRXF1YWwoJ2I3ODk3OGNhNzAyYThlY2NkMzc4MDRjZTMxZDc2Y2Q4M2E2OTViNTU3ZGJmOTVhZWIxMDkzMzJlZThiMWZkMzInKTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2ltYWdlVGFnIGlzIGNvcnJlY3QgZm9yIGRpZmZlcmVudCBzdGFjayBzeW50aGVzaXplcnMnLCAoKSA9PiB7XG4gICAgY29uc3Qgc3RhY2sxID0gbmV3IFN0YWNrKCk7XG4gICAgY29uc3Qgc3RhY2syID0gbmV3IFN0YWNrKHVuZGVmaW5lZCwgdW5kZWZpbmVkLCB7XG4gICAgICBzeW50aGVzaXplcjogbmV3IERlZmF1bHRTdGFja1N5bnRoZXNpemVyKHtcbiAgICAgICAgZG9ja2VyVGFnUHJlZml4OiAnYmFuYW5hJyxcbiAgICAgIH0pLFxuICAgIH0pO1xuXG4gICAgY29uc3QgZGlyZWN0b3J5ID0gcGF0aC5qb2luKF9fZGlybmFtZSwgJ2RlbW8taW1hZ2UtY3VzdG9tLWRvY2tlci1maWxlJyk7XG5cbiAgICBjb25zdCBhc3NldDEgPSBuZXcgRG9ja2VySW1hZ2VBc3NldChzdGFjazEsICdBc3NldDEnLCB7IGRpcmVjdG9yeSB9KTtcbiAgICBjb25zdCBhc3NldDIgPSBuZXcgRG9ja2VySW1hZ2VBc3NldChzdGFjazIsICdBc3NldDInLCB7IGRpcmVjdG9yeSB9KTtcblxuICAgIHRlc3QoJ3N0YWNrIHdpdGggZGVmYXVsdCBzeW50aGVzaXplcicsICgpID0+IHtcbiAgICAgIGV4cGVjdChhc3NldDEuYXNzZXRIYXNoKS50b0VxdWFsKCcxMzI0OGM1NTYzM2YzYjE5OGE2MjhiYjJlYTQ2NjNjYjUyMjZmOGIyODAxMDUxYmQwYzcyNTk1MDI2NmZkNTkwJyk7XG4gICAgICBleHBlY3QoYXNzZXQxLmltYWdlVGFnKS50b0VxdWFsKCcxMzI0OGM1NTYzM2YzYjE5OGE2MjhiYjJlYTQ2NjNjYjUyMjZmOGIyODAxMDUxYmQwYzcyNTk1MDI2NmZkNTkwJyk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdzdGFjayB3aXRoIG92ZXJ3cml0dGVuIHN5bnRoZXNpemVyJywgKCkgPT4ge1xuICAgICAgZXhwZWN0KGFzc2V0Mi5hc3NldEhhc2gpLnRvRXF1YWwoJzEzMjQ4YzU1NjMzZjNiMTk4YTYyOGJiMmVhNDY2M2NiNTIyNmY4YjI4MDEwNTFiZDBjNzI1OTUwMjY2ZmQ1OTAnKTtcbiAgICAgIGV4cGVjdChhc3NldDIuaW1hZ2VUYWcpLnRvRXF1YWwoJ2JhbmFuYTEzMjQ4YzU1NjMzZjNiMTk4YTYyOGJiMmVhNDY2M2NiNTIyNmY4YjI4MDEwNTFiZDBjNzI1OTUwMjY2ZmQ1OTAnKTtcbiAgICB9KTtcbiAgfSk7XG59KTtcblxuZnVuY3Rpb24gdGVzdERvY2tlckRpcmVjdG9yeUlzU3RhZ2VkV2l0aG91dEZpbGVzU3BlY2lmaWVkSW5Eb2NrZXJpZ25vcmUoYXBwOiBBcHAsIGlnbm9yZU1vZGU/OiBJZ25vcmVNb2RlKSB7XG4gIGNvbnN0IHN0YWNrID0gbmV3IFN0YWNrKGFwcCk7XG4gIGNvbnN0IGltYWdlID0gbmV3IERvY2tlckltYWdlQXNzZXQoc3RhY2ssICdNeUFzc2V0Jywge1xuICAgIGlnbm9yZU1vZGUsXG4gICAgZGlyZWN0b3J5OiBwYXRoLmpvaW4oX19kaXJuYW1lLCAnZG9ja2VyaWdub3JlLWltYWdlJyksXG4gIH0pO1xuXG4gIGNvbnN0IHNlc3Npb24gPSBhcHAuc3ludGgoKTtcblxuICAvLyAuZG9ja2VyaWdub3JlIGl0c2VsZiBzaG91bGQgYmUgaW5jbHVkZWQgaW4gb3V0cHV0IHRvIGJlIHByb2Nlc3NlZCBkdXJpbmcgZG9ja2VyIGJ1aWxkXG4gIGV4cGVjdChmcy5leGlzdHNTeW5jKHBhdGguam9pbihzZXNzaW9uLmRpcmVjdG9yeSwgYGFzc2V0LiR7aW1hZ2UuYXNzZXRIYXNofWAsICcuZG9ja2VyaWdub3JlJykpKS50b0JlKHRydWUpO1xuICBleHBlY3QoZnMuZXhpc3RzU3luYyhwYXRoLmpvaW4oc2Vzc2lvbi5kaXJlY3RvcnksIGBhc3NldC4ke2ltYWdlLmFzc2V0SGFzaH1gLCAnRG9ja2VyZmlsZScpKSkudG9CZSh0cnVlKTtcbiAgZXhwZWN0KGZzLmV4aXN0c1N5bmMocGF0aC5qb2luKHNlc3Npb24uZGlyZWN0b3J5LCBgYXNzZXQuJHtpbWFnZS5hc3NldEhhc2h9YCwgJ2luZGV4LnB5JykpKS50b0JlKHRydWUpO1xuICBleHBlY3QoIWZzLmV4aXN0c1N5bmMocGF0aC5qb2luKHNlc3Npb24uZGlyZWN0b3J5LCBgYXNzZXQuJHtpbWFnZS5hc3NldEhhc2h9YCwgJ2Zvb2Jhci50eHQnKSkpLnRvQmUodHJ1ZSk7XG4gIGV4cGVjdChmcy5leGlzdHNTeW5jKHBhdGguam9pbihzZXNzaW9uLmRpcmVjdG9yeSwgYGFzc2V0LiR7aW1hZ2UuYXNzZXRIYXNofWAsICdzdWJkaXJlY3RvcnknKSkpLnRvQmUodHJ1ZSk7XG4gIGV4cGVjdChmcy5leGlzdHNTeW5jKHBhdGguam9pbihzZXNzaW9uLmRpcmVjdG9yeSwgYGFzc2V0LiR7aW1hZ2UuYXNzZXRIYXNofWAsICdzdWJkaXJlY3RvcnknLCAnYmF6LnR4dCcpKSkudG9CZSh0cnVlKTtcbn1cblxuZnVuY3Rpb24gdGVzdERvY2tlckRpcmVjdG9yeUlzU3RhZ2VkV2l0aG91dEZpbGVzU3BlY2lmaWVkSW5FeGNsdWRlT3B0aW9uKGFwcDogQXBwLCBpZ25vcmVNb2RlPzogSWdub3JlTW9kZSkge1xuICBjb25zdCBzdGFjayA9IG5ldyBTdGFjayhhcHApO1xuICBjb25zdCBpbWFnZSA9IG5ldyBEb2NrZXJJbWFnZUFzc2V0KHN0YWNrLCAnTXlBc3NldCcsIHtcbiAgICBkaXJlY3Rvcnk6IHBhdGguam9pbihfX2Rpcm5hbWUsICdkb2NrZXJpZ25vcmUtaW1hZ2UnKSxcbiAgICBleGNsdWRlOiBbJ3N1YmRpcmVjdG9yeSddLFxuICAgIGlnbm9yZU1vZGUsXG4gIH0pO1xuXG4gIGNvbnN0IHNlc3Npb24gPSBhcHAuc3ludGgoKTtcblxuICBleHBlY3QoZnMuZXhpc3RzU3luYyhwYXRoLmpvaW4oc2Vzc2lvbi5kaXJlY3RvcnksIGBhc3NldC4ke2ltYWdlLmFzc2V0SGFzaH1gLCAnLmRvY2tlcmlnbm9yZScpKSkudG9CZSh0cnVlKTtcbiAgZXhwZWN0KGZzLmV4aXN0c1N5bmMocGF0aC5qb2luKHNlc3Npb24uZGlyZWN0b3J5LCBgYXNzZXQuJHtpbWFnZS5hc3NldEhhc2h9YCwgJ0RvY2tlcmZpbGUnKSkpLnRvQmUodHJ1ZSk7XG4gIGV4cGVjdChmcy5leGlzdHNTeW5jKHBhdGguam9pbihzZXNzaW9uLmRpcmVjdG9yeSwgYGFzc2V0LiR7aW1hZ2UuYXNzZXRIYXNofWAsICdpbmRleC5weScpKSkudG9CZSh0cnVlKTtcbiAgZXhwZWN0KCFmcy5leGlzdHNTeW5jKHBhdGguam9pbihzZXNzaW9uLmRpcmVjdG9yeSwgYGFzc2V0LiR7aW1hZ2UuYXNzZXRIYXNofWAsICdmb29iYXIudHh0JykpKS50b0JlKHRydWUpO1xuICBleHBlY3QoIWZzLmV4aXN0c1N5bmMocGF0aC5qb2luKHNlc3Npb24uZGlyZWN0b3J5LCBgYXNzZXQuJHtpbWFnZS5hc3NldEhhc2h9YCwgJ3N1YmRpcmVjdG9yeScpKSkudG9CZSh0cnVlKTtcbiAgZXhwZWN0KCFmcy5leGlzdHNTeW5jKHBhdGguam9pbihzZXNzaW9uLmRpcmVjdG9yeSwgYGFzc2V0LiR7aW1hZ2UuYXNzZXRIYXNofWAsICdzdWJkaXJlY3RvcnknLCAnYmF6LnR4dCcpKSkudG9CZSh0cnVlKTtcbn1cblxudGVzdCgnbmVzdGVkIGFzc2VtYmxpZXMgc2hhcmUgYXNzZXRzOiBsZWdhY3kgc3ludGggZWRpdGlvbicsICgpID0+IHtcbiAgLy8gR0lWRU5cbiAgY29uc3QgYXBwID0gbmV3IEFwcCgpO1xuICBjb25zdCBzdGFjazEgPSBuZXcgU3RhY2sobmV3IFN0YWdlKGFwcCwgJ1N0YWdlMScpLCAnU3RhY2snLCB7IHN5bnRoZXNpemVyOiBuZXcgTGVnYWN5U3RhY2tTeW50aGVzaXplcigpIH0pO1xuICBjb25zdCBzdGFjazIgPSBuZXcgU3RhY2sobmV3IFN0YWdlKGFwcCwgJ1N0YWdlMicpLCAnU3RhY2snLCB7IHN5bnRoZXNpemVyOiBuZXcgTGVnYWN5U3RhY2tTeW50aGVzaXplcigpIH0pO1xuXG4gIC8vIFdIRU5cbiAgbmV3IERvY2tlckltYWdlQXNzZXQoc3RhY2sxLCAnSW1hZ2UnLCB7IGRpcmVjdG9yeTogcGF0aC5qb2luKF9fZGlybmFtZSwgJ2RlbW8taW1hZ2UnKSB9KTtcbiAgbmV3IERvY2tlckltYWdlQXNzZXQoc3RhY2syLCAnSW1hZ2UnLCB7IGRpcmVjdG9yeTogcGF0aC5qb2luKF9fZGlybmFtZSwgJ2RlbW8taW1hZ2UnKSB9KTtcblxuICAvLyBUSEVOXG4gIGNvbnN0IGFzc2VtYmx5ID0gYXBwLnN5bnRoKCk7XG5cbiAgLy8gUmVhZCB0aGUgYXNzZXRzIGZyb20gdGhlIHN0YWNrIG1ldGFkYXRhXG4gIGZvciAoY29uc3Qgc3RhZ2VOYW1lIG9mIFsnU3RhZ2UxJywgJ1N0YWdlMiddKSB7XG4gICAgY29uc3Qgc3RhY2tBcnRpZmFjdCA9IGFzc2VtYmx5LmdldE5lc3RlZEFzc2VtYmx5KGBhc3NlbWJseS0ke3N0YWdlTmFtZX1gKS5hcnRpZmFjdHMuZmlsdGVyKGlzU3RhY2tBcnRpZmFjdClbMF07XG4gICAgY29uc3QgYXNzZXRNZXRhID0gc3RhY2tBcnRpZmFjdC5maW5kTWV0YWRhdGFCeVR5cGUoY3hzY2hlbWEuQXJ0aWZhY3RNZXRhZGF0YUVudHJ5VHlwZS5BU1NFVCk7XG4gICAgZXhwZWN0KGFzc2V0TWV0YVswXSkudG9FcXVhbChcbiAgICAgIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcbiAgICAgICAgZGF0YTogZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICAgIHBhdGg6IGAuLi9hc3NldC4ke0RFTU9fSU1BR0VfQVNTRVRfSEFTSH1gLFxuICAgICAgICB9KSxcbiAgICAgIH0pLFxuICAgICk7XG4gIH1cbn0pO1xuXG50ZXN0KCduZXN0ZWQgYXNzZW1ibGllcyBzaGFyZSBhc3NldHM6IGRlZmF1bHQgc3ludGggZWRpdGlvbicsICgpID0+IHtcbiAgLy8gR0lWRU5cbiAgY29uc3QgYXBwID0gbmV3IEFwcCgpO1xuICBjb25zdCBzdGFjazEgPSBuZXcgU3RhY2sobmV3IFN0YWdlKGFwcCwgJ1N0YWdlMScpLCAnU3RhY2snLCB7IHN5bnRoZXNpemVyOiBuZXcgRGVmYXVsdFN0YWNrU3ludGhlc2l6ZXIoKSB9KTtcbiAgY29uc3Qgc3RhY2syID0gbmV3IFN0YWNrKG5ldyBTdGFnZShhcHAsICdTdGFnZTInKSwgJ1N0YWNrJywgeyBzeW50aGVzaXplcjogbmV3IERlZmF1bHRTdGFja1N5bnRoZXNpemVyKCkgfSk7XG5cbiAgLy8gV0hFTlxuICBuZXcgRG9ja2VySW1hZ2VBc3NldChzdGFjazEsICdJbWFnZScsIHsgZGlyZWN0b3J5OiBwYXRoLmpvaW4oX19kaXJuYW1lLCAnZGVtby1pbWFnZScpIH0pO1xuICBuZXcgRG9ja2VySW1hZ2VBc3NldChzdGFjazIsICdJbWFnZScsIHsgZGlyZWN0b3J5OiBwYXRoLmpvaW4oX19kaXJuYW1lLCAnZGVtby1pbWFnZScpIH0pO1xuXG4gIC8vIFRIRU5cbiAgY29uc3QgYXNzZW1ibHkgPSBhcHAuc3ludGgoKTtcblxuICAvLyBSZWFkIHRoZSBhc3NldCBtYW5pZmVzdHMgdG8gdmVyaWZ5IHRoZSBmaWxlIHBhdGhzXG4gIGZvciAoY29uc3Qgc3RhZ2VOYW1lIG9mIFsnU3RhZ2UxJywgJ1N0YWdlMiddKSB7XG4gICAgY29uc3QgbWFuaWZlc3RBcnRpZmFjdCA9IGFzc2VtYmx5LmdldE5lc3RlZEFzc2VtYmx5KGBhc3NlbWJseS0ke3N0YWdlTmFtZX1gKS5hcnRpZmFjdHMuZmlsdGVyKGN4YXBpLkFzc2V0TWFuaWZlc3RBcnRpZmFjdC5pc0Fzc2V0TWFuaWZlc3RBcnRpZmFjdClbMF07XG4gICAgY29uc3QgbWFuaWZlc3QgPSBKU09OLnBhcnNlKGZzLnJlYWRGaWxlU3luYyhtYW5pZmVzdEFydGlmYWN0LmZpbGUsIHsgZW5jb2Rpbmc6ICd1dGYtOCcgfSkpO1xuXG4gICAgZXhwZWN0KG1hbmlmZXN0LmRvY2tlckltYWdlc1tERU1PX0lNQUdFX0FTU0VUX0hBU0hdLnNvdXJjZSkudG9FcXVhbCh7XG4gICAgICBkaXJlY3Rvcnk6IGAuLi9hc3NldC4ke0RFTU9fSU1BR0VfQVNTRVRfSEFTSH1gLFxuICAgIH0pO1xuICB9XG59KTtcblxuZnVuY3Rpb24gaXNTdGFja0FydGlmYWN0KHg6IGFueSk6IHggaXMgY3hhcGkuQ2xvdWRGb3JtYXRpb25TdGFja0FydGlmYWN0IHtcbiAgcmV0dXJuIHggaW5zdGFuY2VvZiBjeGFwaS5DbG91ZEZvcm1hdGlvblN0YWNrQXJ0aWZhY3Q7XG59XG4iXX0=