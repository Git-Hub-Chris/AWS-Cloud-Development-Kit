"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const aws_route53_1 = require("@aws-cdk/aws-route53");
const cdk_build_tools_1 = require("@aws-cdk/cdk-build-tools");
const core_1 = require("@aws-cdk/core");
const lib_1 = require("../lib");
const util_1 = require("../lib/util");
describe('apex domain', () => {
    test('returns right domain', () => {
        expect(util_1.apexDomain('domain.com')).toEqual('domain.com');
        expect(util_1.apexDomain('test.domain.com')).toEqual('domain.com');
    });
    test('understands eTLDs', () => {
        expect(util_1.apexDomain('test.domain.co.uk')).toEqual('domain.co.uk');
    });
});
describe('isDnsValidatedCertificate', () => {
    cdk_build_tools_1.testDeprecated('new DnsValidatedCertificate is a DnsValidatedCertificate', () => {
        const stack = new core_1.Stack();
        const hostedZone = new aws_route53_1.PublicHostedZone(stack, 'ExampleDotCom', {
            zoneName: 'example.com',
        });
        const cert = new lib_1.DnsValidatedCertificate(stack, 'Certificate', {
            domainName: 'test.example.com',
            hostedZone,
        });
        expect(util_1.isDnsValidatedCertificate(cert)).toBeTruthy();
    });
    test('new Certificate is not a DnsValidatedCertificate', () => {
        const stack = new core_1.Stack();
        const cert = new lib_1.Certificate(stack, 'Certificate', {
            domainName: 'test.example.com',
        });
        expect(util_1.isDnsValidatedCertificate(cert)).toBeFalsy();
    });
    test('fromCertificateArn is not a DnsValidatedCertificate', () => {
        const stack = new core_1.Stack();
        const cert = lib_1.Certificate.fromCertificateArn(stack, 'Certificate', 'cert-arn');
        expect(util_1.isDnsValidatedCertificate(cert)).toBeFalsy();
    });
});
describe('getCertificateRegion', () => {
    test('from stack', () => {
        // GIVEN
        const app = new core_1.App();
        const stack = new core_1.Stack(app, 'RegionStack', { env: { region: 'eu-west-1' } });
        const certificate = new lib_1.Certificate(stack, 'TestCertificate', {
            domainName: 'www.example.com',
        });
        expect(util_1.getCertificateRegion(certificate)).toEqual('eu-west-1');
    });
    cdk_build_tools_1.testDeprecated('from DnsValidatedCertificate region', () => {
        // GIVEN
        const app = new core_1.App();
        const stack = new core_1.Stack(app, 'RegionStack', { env: { region: 'eu-west-1' } });
        const hostedZone = new aws_route53_1.PublicHostedZone(stack, 'ExampleDotCom', {
            zoneName: 'example.com',
        });
        const certificate = new lib_1.DnsValidatedCertificate(stack, 'TestCertificate', {
            domainName: 'www.example.com',
            hostedZone,
            region: 'eu-west-3',
        });
        expect(util_1.getCertificateRegion(certificate)).toEqual('eu-west-3');
    });
    test('fromCertificateArn', () => {
        // GIVEN
        const app = new core_1.App();
        const stack = new core_1.Stack(app, 'RegionStack', { env: { region: 'eu-west-1' } });
        const certificate = lib_1.Certificate.fromCertificateArn(stack, 'TestCertificate', 'arn:aws:acm:us-east-2:1111111:certificate/11-3336f1-44483d-adc7-9cd375c5169d');
        expect(util_1.getCertificateRegion(certificate)).toEqual('us-east-2');
    });
    test('region agnostic stack', () => {
        // GIVEN
        const stack = new core_1.Stack();
        const certificate = new lib_1.Certificate(stack, 'TestCertificate', {
            domainName: 'www.example.com',
        });
        expect(util_1.getCertificateRegion(certificate)).toEqual(core_1.Aws.REGION);
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbC50ZXN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsidXRpbC50ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsc0RBQXdEO0FBQ3hELDhEQUEwRDtBQUMxRCx3Q0FBZ0Q7QUFDaEQsZ0NBQThEO0FBQzlELHNDQUEwRjtBQUUxRixRQUFRLENBQUMsYUFBYSxFQUFFLEdBQUcsRUFBRTtJQUMzQixJQUFJLENBQUMsc0JBQXNCLEVBQUUsR0FBRyxFQUFFO1FBQ2hDLE1BQU0sQ0FBQyxpQkFBVSxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLFlBQVksQ0FBQyxDQUFDO1FBQ3ZELE1BQU0sQ0FBQyxpQkFBVSxDQUFDLGlCQUFpQixDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsWUFBWSxDQUFDLENBQUM7SUFDOUQsQ0FBQyxDQUFDLENBQUM7SUFFSCxJQUFJLENBQUMsbUJBQW1CLEVBQUUsR0FBRyxFQUFFO1FBQzdCLE1BQU0sQ0FBQyxpQkFBVSxDQUFDLG1CQUFtQixDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsY0FBYyxDQUFDLENBQUM7SUFDbEUsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQztBQUVILFFBQVEsQ0FBQywyQkFBMkIsRUFBRSxHQUFHLEVBQUU7SUFDekMsZ0NBQWMsQ0FBQywwREFBMEQsRUFBRSxHQUFHLEVBQUU7UUFDOUUsTUFBTSxLQUFLLEdBQUcsSUFBSSxZQUFLLEVBQUUsQ0FBQztRQUUxQixNQUFNLFVBQVUsR0FBRyxJQUFJLDhCQUFnQixDQUFDLEtBQUssRUFBRSxlQUFlLEVBQUU7WUFDOUQsUUFBUSxFQUFFLGFBQWE7U0FDeEIsQ0FBQyxDQUFDO1FBQ0gsTUFBTSxJQUFJLEdBQUcsSUFBSSw2QkFBdUIsQ0FBQyxLQUFLLEVBQUUsYUFBYSxFQUFFO1lBQzdELFVBQVUsRUFBRSxrQkFBa0I7WUFDOUIsVUFBVTtTQUNYLENBQUMsQ0FBQztRQUVILE1BQU0sQ0FBQyxnQ0FBeUIsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLFVBQVUsRUFBRSxDQUFDO0lBQ3ZELENBQUMsQ0FBQyxDQUFDO0lBRUgsSUFBSSxDQUFDLGtEQUFrRCxFQUFFLEdBQUcsRUFBRTtRQUM1RCxNQUFNLEtBQUssR0FBRyxJQUFJLFlBQUssRUFBRSxDQUFDO1FBRTFCLE1BQU0sSUFBSSxHQUFHLElBQUksaUJBQVcsQ0FBQyxLQUFLLEVBQUUsYUFBYSxFQUFFO1lBQ2pELFVBQVUsRUFBRSxrQkFBa0I7U0FDL0IsQ0FBQyxDQUFDO1FBRUgsTUFBTSxDQUFDLGdDQUF5QixDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsU0FBUyxFQUFFLENBQUM7SUFDdEQsQ0FBQyxDQUFDLENBQUM7SUFFSCxJQUFJLENBQUMscURBQXFELEVBQUUsR0FBRyxFQUFFO1FBQy9ELE1BQU0sS0FBSyxHQUFHLElBQUksWUFBSyxFQUFFLENBQUM7UUFFMUIsTUFBTSxJQUFJLEdBQUcsaUJBQVcsQ0FBQyxrQkFBa0IsQ0FBQyxLQUFLLEVBQUUsYUFBYSxFQUFFLFVBQVUsQ0FBQyxDQUFDO1FBRTlFLE1BQU0sQ0FBQyxnQ0FBeUIsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLFNBQVMsRUFBRSxDQUFDO0lBQ3RELENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUM7QUFFSCxRQUFRLENBQUMsc0JBQXNCLEVBQUUsR0FBRyxFQUFFO0lBQ3BDLElBQUksQ0FBQyxZQUFZLEVBQUUsR0FBRyxFQUFFO1FBQ3RCLFFBQVE7UUFDUixNQUFNLEdBQUcsR0FBRyxJQUFJLFVBQUcsRUFBRSxDQUFDO1FBQ3RCLE1BQU0sS0FBSyxHQUFHLElBQUksWUFBSyxDQUFDLEdBQUcsRUFBRSxhQUFhLEVBQUUsRUFBRSxHQUFHLEVBQUUsRUFBRSxNQUFNLEVBQUUsV0FBVyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBRTlFLE1BQU0sV0FBVyxHQUFHLElBQUksaUJBQVcsQ0FBQyxLQUFLLEVBQUUsaUJBQWlCLEVBQUU7WUFDNUQsVUFBVSxFQUFFLGlCQUFpQjtTQUM5QixDQUFDLENBQUM7UUFFSCxNQUFNLENBQUMsMkJBQW9CLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsV0FBVyxDQUFDLENBQUM7SUFDakUsQ0FBQyxDQUFDLENBQUM7SUFFSCxnQ0FBYyxDQUFDLHFDQUFxQyxFQUFFLEdBQUcsRUFBRTtRQUN6RCxRQUFRO1FBQ1IsTUFBTSxHQUFHLEdBQUcsSUFBSSxVQUFHLEVBQUUsQ0FBQztRQUN0QixNQUFNLEtBQUssR0FBRyxJQUFJLFlBQUssQ0FBQyxHQUFHLEVBQUUsYUFBYSxFQUFFLEVBQUUsR0FBRyxFQUFFLEVBQUUsTUFBTSxFQUFFLFdBQVcsRUFBRSxFQUFFLENBQUMsQ0FBQztRQUM5RSxNQUFNLFVBQVUsR0FBRyxJQUFJLDhCQUFnQixDQUFDLEtBQUssRUFBRSxlQUFlLEVBQUU7WUFDOUQsUUFBUSxFQUFFLGFBQWE7U0FDeEIsQ0FBQyxDQUFDO1FBRUgsTUFBTSxXQUFXLEdBQUcsSUFBSSw2QkFBdUIsQ0FBQyxLQUFLLEVBQUUsaUJBQWlCLEVBQUU7WUFDeEUsVUFBVSxFQUFFLGlCQUFpQjtZQUM3QixVQUFVO1lBQ1YsTUFBTSxFQUFFLFdBQVc7U0FDcEIsQ0FBQyxDQUFDO1FBRUgsTUFBTSxDQUFDLDJCQUFvQixDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLFdBQVcsQ0FBQyxDQUFDO0lBQ2pFLENBQUMsQ0FBQyxDQUFDO0lBRUgsSUFBSSxDQUFDLG9CQUFvQixFQUFFLEdBQUcsRUFBRTtRQUM5QixRQUFRO1FBQ1IsTUFBTSxHQUFHLEdBQUcsSUFBSSxVQUFHLEVBQUUsQ0FBQztRQUN0QixNQUFNLEtBQUssR0FBRyxJQUFJLFlBQUssQ0FBQyxHQUFHLEVBQUUsYUFBYSxFQUFFLEVBQUUsR0FBRyxFQUFFLEVBQUUsTUFBTSxFQUFFLFdBQVcsRUFBRSxFQUFFLENBQUMsQ0FBQztRQUU5RSxNQUFNLFdBQVcsR0FBRyxpQkFBVyxDQUFDLGtCQUFrQixDQUNoRCxLQUFLLEVBQUUsaUJBQWlCLEVBQUUsOEVBQThFLENBQ3pHLENBQUM7UUFFRixNQUFNLENBQUMsMkJBQW9CLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsV0FBVyxDQUFDLENBQUM7SUFDakUsQ0FBQyxDQUFDLENBQUM7SUFFSCxJQUFJLENBQUMsdUJBQXVCLEVBQUUsR0FBRyxFQUFFO1FBQ2pDLFFBQVE7UUFDUixNQUFNLEtBQUssR0FBRyxJQUFJLFlBQUssRUFBRSxDQUFDO1FBRTFCLE1BQU0sV0FBVyxHQUFHLElBQUksaUJBQVcsQ0FBQyxLQUFLLEVBQUUsaUJBQWlCLEVBQUU7WUFDNUQsVUFBVSxFQUFFLGlCQUFpQjtTQUM5QixDQUFDLENBQUM7UUFFSCxNQUFNLENBQUMsMkJBQW9CLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsVUFBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQ2hFLENBQUMsQ0FBQyxDQUFDO0FBRUwsQ0FBQyxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQdWJsaWNIb3N0ZWRab25lIH0gZnJvbSAnQGF3cy1jZGsvYXdzLXJvdXRlNTMnO1xuaW1wb3J0IHsgdGVzdERlcHJlY2F0ZWQgfSBmcm9tICdAYXdzLWNkay9jZGstYnVpbGQtdG9vbHMnO1xuaW1wb3J0IHsgQXBwLCBBd3MsIFN0YWNrIH0gZnJvbSAnQGF3cy1jZGsvY29yZSc7XG5pbXBvcnQgeyBDZXJ0aWZpY2F0ZSwgRG5zVmFsaWRhdGVkQ2VydGlmaWNhdGUgfSBmcm9tICcuLi9saWInO1xuaW1wb3J0IHsgYXBleERvbWFpbiwgZ2V0Q2VydGlmaWNhdGVSZWdpb24sIGlzRG5zVmFsaWRhdGVkQ2VydGlmaWNhdGUgfSBmcm9tICcuLi9saWIvdXRpbCc7XG5cbmRlc2NyaWJlKCdhcGV4IGRvbWFpbicsICgpID0+IHtcbiAgdGVzdCgncmV0dXJucyByaWdodCBkb21haW4nLCAoKSA9PiB7XG4gICAgZXhwZWN0KGFwZXhEb21haW4oJ2RvbWFpbi5jb20nKSkudG9FcXVhbCgnZG9tYWluLmNvbScpO1xuICAgIGV4cGVjdChhcGV4RG9tYWluKCd0ZXN0LmRvbWFpbi5jb20nKSkudG9FcXVhbCgnZG9tYWluLmNvbScpO1xuICB9KTtcblxuICB0ZXN0KCd1bmRlcnN0YW5kcyBlVExEcycsICgpID0+IHtcbiAgICBleHBlY3QoYXBleERvbWFpbigndGVzdC5kb21haW4uY28udWsnKSkudG9FcXVhbCgnZG9tYWluLmNvLnVrJyk7XG4gIH0pO1xufSk7XG5cbmRlc2NyaWJlKCdpc0Ruc1ZhbGlkYXRlZENlcnRpZmljYXRlJywgKCkgPT4ge1xuICB0ZXN0RGVwcmVjYXRlZCgnbmV3IERuc1ZhbGlkYXRlZENlcnRpZmljYXRlIGlzIGEgRG5zVmFsaWRhdGVkQ2VydGlmaWNhdGUnLCAoKSA9PiB7XG4gICAgY29uc3Qgc3RhY2sgPSBuZXcgU3RhY2soKTtcblxuICAgIGNvbnN0IGhvc3RlZFpvbmUgPSBuZXcgUHVibGljSG9zdGVkWm9uZShzdGFjaywgJ0V4YW1wbGVEb3RDb20nLCB7XG4gICAgICB6b25lTmFtZTogJ2V4YW1wbGUuY29tJyxcbiAgICB9KTtcbiAgICBjb25zdCBjZXJ0ID0gbmV3IERuc1ZhbGlkYXRlZENlcnRpZmljYXRlKHN0YWNrLCAnQ2VydGlmaWNhdGUnLCB7XG4gICAgICBkb21haW5OYW1lOiAndGVzdC5leGFtcGxlLmNvbScsXG4gICAgICBob3N0ZWRab25lLFxuICAgIH0pO1xuXG4gICAgZXhwZWN0KGlzRG5zVmFsaWRhdGVkQ2VydGlmaWNhdGUoY2VydCkpLnRvQmVUcnV0aHkoKTtcbiAgfSk7XG5cbiAgdGVzdCgnbmV3IENlcnRpZmljYXRlIGlzIG5vdCBhIERuc1ZhbGlkYXRlZENlcnRpZmljYXRlJywgKCkgPT4ge1xuICAgIGNvbnN0IHN0YWNrID0gbmV3IFN0YWNrKCk7XG5cbiAgICBjb25zdCBjZXJ0ID0gbmV3IENlcnRpZmljYXRlKHN0YWNrLCAnQ2VydGlmaWNhdGUnLCB7XG4gICAgICBkb21haW5OYW1lOiAndGVzdC5leGFtcGxlLmNvbScsXG4gICAgfSk7XG5cbiAgICBleHBlY3QoaXNEbnNWYWxpZGF0ZWRDZXJ0aWZpY2F0ZShjZXJ0KSkudG9CZUZhbHN5KCk7XG4gIH0pO1xuXG4gIHRlc3QoJ2Zyb21DZXJ0aWZpY2F0ZUFybiBpcyBub3QgYSBEbnNWYWxpZGF0ZWRDZXJ0aWZpY2F0ZScsICgpID0+IHtcbiAgICBjb25zdCBzdGFjayA9IG5ldyBTdGFjaygpO1xuXG4gICAgY29uc3QgY2VydCA9IENlcnRpZmljYXRlLmZyb21DZXJ0aWZpY2F0ZUFybihzdGFjaywgJ0NlcnRpZmljYXRlJywgJ2NlcnQtYXJuJyk7XG5cbiAgICBleHBlY3QoaXNEbnNWYWxpZGF0ZWRDZXJ0aWZpY2F0ZShjZXJ0KSkudG9CZUZhbHN5KCk7XG4gIH0pO1xufSk7XG5cbmRlc2NyaWJlKCdnZXRDZXJ0aWZpY2F0ZVJlZ2lvbicsICgpID0+IHtcbiAgdGVzdCgnZnJvbSBzdGFjaycsICgpID0+IHtcbiAgICAvLyBHSVZFTlxuICAgIGNvbnN0IGFwcCA9IG5ldyBBcHAoKTtcbiAgICBjb25zdCBzdGFjayA9IG5ldyBTdGFjayhhcHAsICdSZWdpb25TdGFjaycsIHsgZW52OiB7IHJlZ2lvbjogJ2V1LXdlc3QtMScgfSB9KTtcblxuICAgIGNvbnN0IGNlcnRpZmljYXRlID0gbmV3IENlcnRpZmljYXRlKHN0YWNrLCAnVGVzdENlcnRpZmljYXRlJywge1xuICAgICAgZG9tYWluTmFtZTogJ3d3dy5leGFtcGxlLmNvbScsXG4gICAgfSk7XG5cbiAgICBleHBlY3QoZ2V0Q2VydGlmaWNhdGVSZWdpb24oY2VydGlmaWNhdGUpKS50b0VxdWFsKCdldS13ZXN0LTEnKTtcbiAgfSk7XG5cbiAgdGVzdERlcHJlY2F0ZWQoJ2Zyb20gRG5zVmFsaWRhdGVkQ2VydGlmaWNhdGUgcmVnaW9uJywgKCkgPT4ge1xuICAgIC8vIEdJVkVOXG4gICAgY29uc3QgYXBwID0gbmV3IEFwcCgpO1xuICAgIGNvbnN0IHN0YWNrID0gbmV3IFN0YWNrKGFwcCwgJ1JlZ2lvblN0YWNrJywgeyBlbnY6IHsgcmVnaW9uOiAnZXUtd2VzdC0xJyB9IH0pO1xuICAgIGNvbnN0IGhvc3RlZFpvbmUgPSBuZXcgUHVibGljSG9zdGVkWm9uZShzdGFjaywgJ0V4YW1wbGVEb3RDb20nLCB7XG4gICAgICB6b25lTmFtZTogJ2V4YW1wbGUuY29tJyxcbiAgICB9KTtcblxuICAgIGNvbnN0IGNlcnRpZmljYXRlID0gbmV3IERuc1ZhbGlkYXRlZENlcnRpZmljYXRlKHN0YWNrLCAnVGVzdENlcnRpZmljYXRlJywge1xuICAgICAgZG9tYWluTmFtZTogJ3d3dy5leGFtcGxlLmNvbScsXG4gICAgICBob3N0ZWRab25lLFxuICAgICAgcmVnaW9uOiAnZXUtd2VzdC0zJyxcbiAgICB9KTtcblxuICAgIGV4cGVjdChnZXRDZXJ0aWZpY2F0ZVJlZ2lvbihjZXJ0aWZpY2F0ZSkpLnRvRXF1YWwoJ2V1LXdlc3QtMycpO1xuICB9KTtcblxuICB0ZXN0KCdmcm9tQ2VydGlmaWNhdGVBcm4nLCAoKSA9PiB7XG4gICAgLy8gR0lWRU5cbiAgICBjb25zdCBhcHAgPSBuZXcgQXBwKCk7XG4gICAgY29uc3Qgc3RhY2sgPSBuZXcgU3RhY2soYXBwLCAnUmVnaW9uU3RhY2snLCB7IGVudjogeyByZWdpb246ICdldS13ZXN0LTEnIH0gfSk7XG5cbiAgICBjb25zdCBjZXJ0aWZpY2F0ZSA9IENlcnRpZmljYXRlLmZyb21DZXJ0aWZpY2F0ZUFybihcbiAgICAgIHN0YWNrLCAnVGVzdENlcnRpZmljYXRlJywgJ2Fybjphd3M6YWNtOnVzLWVhc3QtMjoxMTExMTExOmNlcnRpZmljYXRlLzExLTMzMzZmMS00NDQ4M2QtYWRjNy05Y2QzNzVjNTE2OWQnLFxuICAgICk7XG5cbiAgICBleHBlY3QoZ2V0Q2VydGlmaWNhdGVSZWdpb24oY2VydGlmaWNhdGUpKS50b0VxdWFsKCd1cy1lYXN0LTInKTtcbiAgfSk7XG5cbiAgdGVzdCgncmVnaW9uIGFnbm9zdGljIHN0YWNrJywgKCkgPT4ge1xuICAgIC8vIEdJVkVOXG4gICAgY29uc3Qgc3RhY2sgPSBuZXcgU3RhY2soKTtcblxuICAgIGNvbnN0IGNlcnRpZmljYXRlID0gbmV3IENlcnRpZmljYXRlKHN0YWNrLCAnVGVzdENlcnRpZmljYXRlJywge1xuICAgICAgZG9tYWluTmFtZTogJ3d3dy5leGFtcGxlLmNvbScsXG4gICAgfSk7XG5cbiAgICBleHBlY3QoZ2V0Q2VydGlmaWNhdGVSZWdpb24oY2VydGlmaWNhdGUpKS50b0VxdWFsKEF3cy5SRUdJT04pO1xuICB9KTtcblxufSk7XG4iXX0=