{
  "Resources": {
    "SubmitJobFB773A16": {
      "Type": "AWS::StepFunctions::Activity",
      "Properties": {
        "Name": "awsstepfunctionsintegSubmitJobA2508960"
      }
    },
    "CheckJob5FFC1D6F": {
      "Type": "AWS::StepFunctions::Activity",
      "Properties": {
        "Name": "awsstepfunctionsintegCheckJobC4AC762D"
      }
    },
    "StateMachineRoleB840431D": {
      "Type": "AWS::IAM::Role",
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": {
                  "Fn::Join": [
                    "",
                    [
                      "states.",
                      {
                        "Ref": "AWS::Region"
                      },
                      ".amazonaws.com"
                    ]
                  ]
                }
              }
            }
          ],
          "Version": "2012-10-17"
        }
      }
    },
    "StateMachine2E01A3A5": {
      "Type": "AWS::StepFunctions::StateMachine",
      "Properties": {
        "DefinitionString": {
          "Fn::Join": [
            "",
            [
              "{\n  \"StartAt\": \"Submit Job\",\n  \"States\": {\n    \"Submit Job\": {\n      \"Next\": \"Wait X Seconds\",\n      \"Type\": \"Task\",\n      \"Resource\": \"",
              {
                "Ref": "SubmitJobFB773A16"
              },
              "\",\n      \"ResultPath\": \"$.guid\"\n    },\n    \"Wait X Seconds\": {\n      \"Type\": \"Wait\",\n      \"SecondsPath\": \"$.wait_time\",\n      \"Next\": \"Get Job Status\"\n    },\n    \"Get Job Status\": {\n      \"Next\": \"Job Complete?\",\n      \"InputPath\": \"$.guid\",\n      \"Type\": \"Task\",\n      \"Resource\": \"",
              {
                "Ref": "CheckJob5FFC1D6F"
              },
              "\",\n      \"ResultPath\": \"$.status\"\n    },\n    \"Job Complete?\": {\n      \"Type\": \"Choice\",\n      \"Choices\": [\n        {\n          \"Variable\": \"$.status\",\n          \"StringEquals\": \"FAILED\",\n          \"Next\": \"Job Failed\"\n        },\n        {\n          \"Variable\": \"$.status\",\n          \"StringEquals\": \"SUCCEEDED\",\n          \"Next\": \"Get Final Job Status\"\n        }\n      ],\n      \"Default\": \"Wait X Seconds\"\n    },\n    \"Job Failed\": {\n      \"Type\": \"Fail\",\n      \"Error\": \"DescribeJob returned FAILED\",\n      \"Cause\": \"AWS Batch Job Failed\"\n    },\n    \"Get Final Job Status\": {\n      \"End\": true,\n      \"InputPath\": \"$.guid\",\n      \"Type\": \"Task\",\n      \"Resource\": \"",
              {
                "Ref": "CheckJob5FFC1D6F"
              },
              "\"\n    }\n  },\n  \"TimeoutSeconds\": 30\n}"
            ]
          ]
        },
        "RoleArn": {
          "Fn::GetAtt": [
            "StateMachineRoleB840431D",
            "Arn"
          ]
        }
      },
      "DependsOn": [
        "StateMachineRoleB840431D"
      ]
    }
  }
}