"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
jest.mock('child_process');
const cloud_assembly_schema_1 = require("@aws-cdk/cloud-assembly-schema");
const mockfs = require("mock-fs");
const fake_listener_1 = require("./fake-listener");
const mock_aws_1 = require("./mock-aws");
const mock_child_process_1 = require("./mock-child_process");
const lib_1 = require("../lib");
const ABS_PATH = '/simple/cdk.out/some_external_file';
const DEFAULT_DESTINATION = {
    region: 'us-north-50',
    assumeRoleArn: 'arn:aws:role',
    bucketName: 'some_bucket',
    objectKey: 'some_key',
};
let aws;
beforeEach(() => {
    jest.resetAllMocks();
    mockfs({
        '/simple/cdk.out/assets.json': JSON.stringify({
            version: cloud_assembly_schema_1.Manifest.version(),
            files: {
                theAsset: {
                    source: {
                        path: 'some_file',
                    },
                    destinations: { theDestination: DEFAULT_DESTINATION },
                },
            },
        }),
        '/simple/cdk.out/some_file': 'FILE_CONTENTS',
        [ABS_PATH]: 'ZIP_FILE_THAT_IS_DEFINITELY_NOT_EMPTY',
        '/abs/cdk.out/assets.json': JSON.stringify({
            version: cloud_assembly_schema_1.Manifest.version(),
            files: {
                theAsset: {
                    source: {
                        path: '/simple/cdk.out/some_file',
                    },
                    destinations: { theDestination: { ...DEFAULT_DESTINATION, bucketName: 'some_other_bucket' } },
                },
            },
        }),
        '/external/cdk.out/assets.json': JSON.stringify({
            version: cloud_assembly_schema_1.Manifest.version(),
            files: {
                externalAsset: {
                    source: {
                        executable: ['sometool'],
                    },
                    destinations: { theDestination: { ...DEFAULT_DESTINATION, bucketName: 'some_external_bucket' } },
                },
            },
        }),
        '/types/cdk.out/assets.json': JSON.stringify({
            version: cloud_assembly_schema_1.Manifest.version(),
            files: {
                theTextAsset: {
                    source: {
                        path: 'plain_text.txt',
                    },
                    destinations: { theDestination: { ...DEFAULT_DESTINATION, objectKey: 'some_key.txt' } },
                },
                theImageAsset: {
                    source: {
                        path: 'image.png',
                    },
                    destinations: { theDestination: { ...DEFAULT_DESTINATION, objectKey: 'some_key.png' } },
                },
            },
        }),
        '/types/cdk.out/plain_text.txt': 'FILE_CONTENTS',
        '/types/cdk.out/image.png': 'FILE_CONTENTS',
        '/emptyzip/cdk.out/assets.json': JSON.stringify({
            version: cloud_assembly_schema_1.Manifest.version(),
            files: {
                theTextAsset: {
                    source: {
                        path: 'empty_dir',
                        packaging: 'zip',
                    },
                    destinations: { theDestination: DEFAULT_DESTINATION },
                },
            },
        }),
        '/emptyzip/cdk.out/empty_dir': {}, // Empty directory
    });
    aws = (0, mock_aws_1.mockAws)();
});
afterEach(() => {
    mockfs.restore();
});
test('pass destination properties to AWS client', async () => {
    const pub = new lib_1.AssetPublishing(lib_1.AssetManifest.fromPath('/simple/cdk.out'), { aws, throwOnError: false });
    aws.mockS3.listObjectsV2 = (0, mock_aws_1.mockedApiResult)({});
    await pub.publish();
    expect(aws.s3Client).toHaveBeenCalledWith(expect.objectContaining({
        region: 'us-north-50',
        assumeRoleArn: 'arn:aws:role',
    }));
});
test('Do nothing if file already exists', async () => {
    const pub = new lib_1.AssetPublishing(lib_1.AssetManifest.fromPath('/simple/cdk.out'), { aws });
    aws.mockS3.listObjectsV2 = (0, mock_aws_1.mockedApiResult)({ Contents: [{ Key: 'some_key' }] });
    aws.mockS3.upload = (0, mock_aws_1.mockUpload)();
    await pub.publish();
    expect(aws.mockS3.listObjectsV2).toHaveBeenCalledWith(expect.objectContaining({
        Bucket: 'some_bucket',
        Prefix: 'some_key',
        MaxKeys: 1,
    }));
    expect(aws.mockS3.upload).not.toHaveBeenCalled();
});
test('tiny file does not count as cache hit', async () => {
    const pub = new lib_1.AssetPublishing(lib_1.AssetManifest.fromPath('/simple/cdk.out'), { aws });
    aws.mockS3.listObjectsV2 = (0, mock_aws_1.mockedApiResult)({ Contents: [{ Key: 'some_key', Size: 5 }] });
    aws.mockS3.upload = (0, mock_aws_1.mockUpload)();
    await pub.publish();
    expect(aws.mockS3.upload).toHaveBeenCalled();
});
test('upload file if new (list returns other key)', async () => {
    const pub = new lib_1.AssetPublishing(lib_1.AssetManifest.fromPath('/simple/cdk.out'), { aws });
    aws.mockS3.listObjectsV2 = (0, mock_aws_1.mockedApiResult)({ Contents: [{ Key: 'some_key.but_not_the_one' }] });
    aws.mockS3.upload = (0, mock_aws_1.mockUpload)('FILE_CONTENTS');
    await pub.publish();
    expect(aws.mockS3.upload).toHaveBeenCalledWith(expect.objectContaining({
        Bucket: 'some_bucket',
        Key: 'some_key',
        ContentType: 'application/octet-stream',
    }));
    // We'll just have to assume the contents are correct
});
test('upload with server side encryption AES256 header', async () => {
    const pub = new lib_1.AssetPublishing(lib_1.AssetManifest.fromPath('/simple/cdk.out'), { aws });
    aws.mockS3.getBucketEncryption = (0, mock_aws_1.mockedApiResult)({
        ServerSideEncryptionConfiguration: {
            Rules: [
                {
                    ApplyServerSideEncryptionByDefault: {
                        SSEAlgorithm: 'AES256',
                    },
                    BucketKeyEnabled: false,
                },
            ],
        },
    });
    aws.mockS3.listObjectsV2 = (0, mock_aws_1.mockedApiResult)({ Contents: [{ Key: 'some_key.but_not_the_one' }] });
    aws.mockS3.upload = (0, mock_aws_1.mockUpload)('FILE_CONTENTS');
    await pub.publish();
    expect(aws.mockS3.upload).toHaveBeenCalledWith(expect.objectContaining({
        Bucket: 'some_bucket',
        Key: 'some_key',
        ContentType: 'application/octet-stream',
        ServerSideEncryption: 'AES256',
    }));
    // We'll just have to assume the contents are correct
});
test('upload with server side encryption aws:kms header and key id', async () => {
    const pub = new lib_1.AssetPublishing(lib_1.AssetManifest.fromPath('/simple/cdk.out'), { aws });
    aws.mockS3.getBucketEncryption = (0, mock_aws_1.mockedApiResult)({
        ServerSideEncryptionConfiguration: {
            Rules: [
                {
                    ApplyServerSideEncryptionByDefault: {
                        SSEAlgorithm: 'aws:kms',
                        KMSMasterKeyID: 'the-key-id',
                    },
                    BucketKeyEnabled: false,
                },
            ],
        },
    });
    aws.mockS3.listObjectsV2 = (0, mock_aws_1.mockedApiResult)({ Contents: [{ Key: 'some_key.but_not_the_one' }] });
    aws.mockS3.upload = (0, mock_aws_1.mockUpload)('FILE_CONTENTS');
    await pub.publish();
    expect(aws.mockS3.upload).toHaveBeenCalledWith(expect.objectContaining({
        Bucket: 'some_bucket',
        Key: 'some_key',
        ContentType: 'application/octet-stream',
        ServerSideEncryption: 'aws:kms',
        SSEKMSKeyId: 'the-key-id',
    }));
    // We'll just have to assume the contents are correct
});
test('will only read bucketEncryption once even for multiple assets', async () => {
    const pub = new lib_1.AssetPublishing(lib_1.AssetManifest.fromPath('/types/cdk.out'), { aws });
    aws.mockS3.listObjectsV2 = (0, mock_aws_1.mockedApiResult)({ Contents: [{ Key: 'some_key.but_not_the_one' }] });
    aws.mockS3.upload = (0, mock_aws_1.mockUpload)('FILE_CONTENTS');
    await pub.publish();
    expect(aws.mockS3.upload).toHaveBeenCalledTimes(2);
    expect(aws.mockS3.getBucketEncryption).toHaveBeenCalledTimes(1);
});
test('no server side encryption header if access denied for bucket encryption', async () => {
    const progressListener = new fake_listener_1.FakeListener();
    const pub = new lib_1.AssetPublishing(lib_1.AssetManifest.fromPath('/simple/cdk.out'), { aws, progressListener });
    aws.mockS3.getBucketEncryption = (0, mock_aws_1.mockedApiFailure)('AccessDenied', 'Access Denied');
    aws.mockS3.listObjectsV2 = (0, mock_aws_1.mockedApiResult)({ Contents: [{ Key: 'some_key.but_not_the_one' }] });
    aws.mockS3.upload = (0, mock_aws_1.mockUpload)('FILE_CONTENTS');
    await pub.publish();
    expect(aws.mockS3.upload).toHaveBeenCalledWith(expect.not.objectContaining({
        ServerSideEncryption: 'aws:kms',
    }));
    expect(aws.mockS3.upload).toHaveBeenCalledWith(expect.not.objectContaining({
        ServerSideEncryption: 'AES256',
    }));
});
test('correctly looks up content type', async () => {
    const pub = new lib_1.AssetPublishing(lib_1.AssetManifest.fromPath('/types/cdk.out'), { aws });
    aws.mockS3.listObjectsV2 = (0, mock_aws_1.mockedApiResult)({ Contents: [{ Key: 'some_key.but_not_the_one' }] });
    aws.mockS3.upload = (0, mock_aws_1.mockUpload)('FILE_CONTENTS');
    await pub.publish();
    expect(aws.mockS3.upload).toHaveBeenCalledWith(expect.objectContaining({
        Bucket: 'some_bucket',
        Key: 'some_key.txt',
        ContentType: 'text/plain',
    }));
    expect(aws.mockS3.upload).toHaveBeenCalledWith(expect.objectContaining({
        Bucket: 'some_bucket',
        Key: 'some_key.png',
        ContentType: 'image/png',
    }));
    // We'll just have to assume the contents are correct
});
test('upload file if new (list returns no key)', async () => {
    const pub = new lib_1.AssetPublishing(lib_1.AssetManifest.fromPath('/simple/cdk.out'), { aws });
    aws.mockS3.listObjectsV2 = (0, mock_aws_1.mockedApiResult)({ Contents: undefined });
    aws.mockS3.upload = (0, mock_aws_1.mockUpload)('FILE_CONTENTS');
    await pub.publish();
    expect(aws.mockS3.upload).toHaveBeenCalledWith(expect.objectContaining({
        Bucket: 'some_bucket',
        Key: 'some_key',
    }));
    // We'll just have to assume the contents are correct
});
test('successful run does not need to query account ID', async () => {
    const pub = new lib_1.AssetPublishing(lib_1.AssetManifest.fromPath('/simple/cdk.out'), { aws });
    aws.mockS3.listObjectsV2 = (0, mock_aws_1.mockedApiResult)({ Contents: undefined });
    aws.mockS3.upload = (0, mock_aws_1.mockUpload)('FILE_CONTENTS');
    await pub.publish();
    expect(aws.discoverCurrentAccount).not.toHaveBeenCalled();
    expect(aws.discoverTargetAccount).not.toHaveBeenCalled();
});
test('correctly identify asset path if path is absolute', async () => {
    const pub = new lib_1.AssetPublishing(lib_1.AssetManifest.fromPath('/abs/cdk.out'), { aws });
    aws.mockS3.listObjectsV2 = (0, mock_aws_1.mockedApiResult)({ Contents: undefined });
    aws.mockS3.upload = (0, mock_aws_1.mockUpload)('FILE_CONTENTS');
    await pub.publish();
    expect(true).toBeTruthy(); // No exception, satisfy linter
});
describe('external assets', () => {
    let pub;
    beforeEach(() => {
        pub = new lib_1.AssetPublishing(lib_1.AssetManifest.fromPath('/external/cdk.out'), { aws });
    });
    test('do nothing if file exists already', async () => {
        aws.mockS3.listObjectsV2 = (0, mock_aws_1.mockedApiResult)({ Contents: [{ Key: 'some_key' }] });
        await pub.publish();
        expect(aws.mockS3.listObjectsV2).toHaveBeenCalledWith(expect.objectContaining({
            Bucket: 'some_external_bucket',
            Prefix: 'some_key',
            MaxKeys: 1,
        }));
    });
    test('upload external asset correctly', async () => {
        aws.mockS3.listObjectsV2 = (0, mock_aws_1.mockedApiResult)({ Contents: undefined });
        aws.mockS3.upload = (0, mock_aws_1.mockUpload)('ZIP_FILE_THAT_IS_DEFINITELY_NOT_EMPTY');
        const expectAllSpawns = (0, mock_child_process_1.mockSpawn)({ commandLine: ['sometool'], stdout: ABS_PATH });
        await pub.publish();
        expect(aws.s3Client).toHaveBeenCalledWith(expect.objectContaining({
            region: 'us-north-50',
            assumeRoleArn: 'arn:aws:role',
        }));
        expectAllSpawns();
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmlsZXMudGVzdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImZpbGVzLnRlc3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxJQUFJLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxDQUFDO0FBRTNCLDBFQUEwRDtBQUMxRCxrQ0FBa0M7QUFDbEMsbURBQStDO0FBQy9DLHlDQUFvRjtBQUNwRiw2REFBaUQ7QUFDakQsZ0NBQXdEO0FBRXhELE1BQU0sUUFBUSxHQUFHLG9DQUFvQyxDQUFDO0FBRXRELE1BQU0sbUJBQW1CLEdBQUc7SUFDMUIsTUFBTSxFQUFFLGFBQWE7SUFDckIsYUFBYSxFQUFFLGNBQWM7SUFDN0IsVUFBVSxFQUFFLGFBQWE7SUFDekIsU0FBUyxFQUFFLFVBQVU7Q0FDdEIsQ0FBQztBQUVGLElBQUksR0FBK0IsQ0FBQztBQUNwQyxVQUFVLENBQUMsR0FBRyxFQUFFO0lBQ2QsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO0lBRXJCLE1BQU0sQ0FBQztRQUNMLDZCQUE2QixFQUFFLElBQUksQ0FBQyxTQUFTLENBQUM7WUFDNUMsT0FBTyxFQUFFLGdDQUFRLENBQUMsT0FBTyxFQUFFO1lBQzNCLEtBQUssRUFBRTtnQkFDTCxRQUFRLEVBQUU7b0JBQ1IsTUFBTSxFQUFFO3dCQUNOLElBQUksRUFBRSxXQUFXO3FCQUNsQjtvQkFDRCxZQUFZLEVBQUUsRUFBRSxjQUFjLEVBQUUsbUJBQW1CLEVBQUU7aUJBQ3REO2FBQ0Y7U0FDRixDQUFDO1FBQ0YsMkJBQTJCLEVBQUUsZUFBZTtRQUM1QyxDQUFDLFFBQVEsQ0FBQyxFQUFFLHVDQUF1QztRQUNuRCwwQkFBMEIsRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDO1lBQ3pDLE9BQU8sRUFBRSxnQ0FBUSxDQUFDLE9BQU8sRUFBRTtZQUMzQixLQUFLLEVBQUU7Z0JBQ0wsUUFBUSxFQUFFO29CQUNSLE1BQU0sRUFBRTt3QkFDTixJQUFJLEVBQUUsMkJBQTJCO3FCQUNsQztvQkFDRCxZQUFZ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S0FBSyxJQUFJLEVBQUU7UUFDakQsR0FBRyxDQUFDLE1BQU0sQ0FBQyxhQUFhLEdBQUcsSUFBQSwwQkFBZSxFQUFDLEVBQUUsUUFBUSxFQUFFLFNBQVMsRUFBRSxDQUFDLENBQUM7UUFDcEUsR0FBRyxDQUFDLE1BQU0sQ0FBQyxNQUFNLEdBQUcsSUFBQSxxQkFBVSxFQUFDLHVDQUF1QyxDQUFDLENBQUM7UUFDeEUsTUFBTSxlQUFlLEdBQUcsSUFBQSw4QkFBUyxFQUFDLEVBQUUsV0FBVyxFQUFFLENBQUMsVUFBVSxDQUFDLEVBQUUsTUFBTSxFQUFFLFFBQVEsRUFBRSxDQUFDLENBQUM7UUFFbkYsTUFBTSxHQUFHLENBQUMsT0FBTyxFQUFFLENBQUM7UUFFcEIsTUFBTSxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsQ0FBQyxvQkFBb0IsQ0FBQyxNQUFNLENBQUMsZ0JBQWdCLENBQUM7WUFDaEUsTUFBTSxFQUFFLGFBQWE7WUFDckIsYUFBYSxFQUFFLGNBQWM7U0FDOUIsQ0FBQyxDQUFDLENBQUM7UUFFSixlQUFlLEVBQUUsQ0FBQztJQUNwQixDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiamVzdC5tb2NrKCdjaGlsZF9wcm9jZXNzJyk7XG5cbmltcG9ydCB7IE1hbmlmZXN0IH0gZnJvbSAnQGF3cy1jZGsvY2xvdWQtYXNzZW1ibHktc2NoZW1hJztcbmltcG9ydCAqIGFzIG1vY2tmcyBmcm9tICdtb2NrLWZzJztcbmltcG9ydCB7IEZha2VMaXN0ZW5lciB9IGZyb20gJy4vZmFrZS1saXN0ZW5lcic7XG5pbXBvcnQgeyBtb2NrQXdzLCBtb2NrZWRBcGlGYWlsdXJlLCBtb2NrZWRBcGlSZXN1bHQsIG1vY2tVcGxvYWQgfSBmcm9tICcuL21vY2stYXdzJztcbmltcG9ydCB7IG1vY2tTcGF3biB9IGZyb20gJy4vbW9jay1jaGlsZF9wcm9jZXNzJztcbmltcG9ydCB7IEFzc2V0UHVibGlzaGluZywgQXNzZXRNYW5pZmVzdCB9IGZyb20gJy4uL2xpYic7XG5cbmNvbnN0IEFCU19QQVRIID0gJy9zaW1wbGUvY2RrLm91dC9zb21lX2V4dGVybmFsX2ZpbGUnO1xuXG5jb25zdCBERUZBVUxUX0RFU1RJTkFUSU9OID0ge1xuICByZWdpb246ICd1cy1ub3J0aC01MCcsXG4gIGFzc3VtZVJvbGVBcm46ICdhcm46YXdzOnJvbGUnLFxuICBidWNrZXROYW1lOiAnc29tZV9idWNrZXQnLFxuICBvYmplY3RLZXk6ICdzb21lX2tleScsXG59O1xuXG5sZXQgYXdzOiBSZXR1cm5UeXBlPHR5cGVvZiBtb2NrQXdzPjtcbmJlZm9yZUVhY2goKCkgPT4ge1xuICBqZXN0LnJlc2V0QWxsTW9ja3MoKTtcblxuICBtb2NrZnMoe1xuICAgICcvc2ltcGxlL2Nkay5vdXQvYXNzZXRzLmpzb24nOiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICB2ZXJzaW9uOiBNYW5pZmVzdC52ZXJzaW9uKCksXG4gICAgICBmaWxlczoge1xuICAgICAgICB0aGVBc3NldDoge1xuICAgICAgICAgIHNvdXJjZToge1xuICAgICAgICAgICAgcGF0aDogJ3NvbWVfZmlsZScsXG4gICAgICAgICAgfSxcbiAgICAgICAgICBkZXN0aW5hdGlvbnM6IHsgdGhlRGVzdGluYXRpb246IERFRkFVTFRfREVTVElOQVRJT04gfSxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSksXG4gICAgJy9zaW1wbGUvY2RrLm91dC9zb21lX2ZpbGUnOiAnRklMRV9DT05URU5UUycsXG4gICAgW0FCU19QQVRIXTogJ1pJUF9GSUxFX1RIQVRfSVNfREVGSU5JVEVMWV9OT1RfRU1QVFknLFxuICAgICcvYWJzL2Nkay5vdXQvYXNzZXRzLmpzb24nOiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICB2ZXJzaW9uOiBNYW5pZmVzdC52ZXJzaW9uKCksXG4gICAgICBmaWxlczoge1xuICAgICAgICB0aGVBc3NldDoge1xuICAgICAgICAgIHNvdXJjZToge1xuICAgICAgICAgICAgcGF0aDogJy9zaW1wbGUvY2RrLm91dC9zb21lX2ZpbGUnLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgZGVzdGluYXRpb25zOiB7IHRoZURlc3RpbmF0aW9uOiB7IC4uLkRFRkFVTFRfREVTVElOQVRJT04sIGJ1Y2tldE5hbWU6ICdzb21lX290aGVyX2J1Y2tldCcgfSB9LFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9KSxcbiAgICAnL2V4dGVybmFsL2Nkay5vdXQvYXNzZXRzLmpzb24nOiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICB2ZXJzaW9uOiBNYW5pZmVzdC52ZXJzaW9uKCksXG4gICAgICBmaWxlczoge1xuICAgICAgICBleHRlcm5hbEFzc2V0OiB7XG4gICAgICAgICAgc291cmNlOiB7XG4gICAgICAgICAgICBleGVjdXRhYmxlOiBbJ3NvbWV0b29sJ10sXG4gICAgICAgICAgfSxcbiAgICAgICAgICBkZXN0aW5hdGlvbnM6IHsgdGhlRGVzdGluYXRpb246IHsgLi4uREVGQVVMVF9ERVNUSU5BVElPTiwgYnVja2V0TmFtZTogJ3NvbWVfZXh0ZXJuYWxfYnVja2V0JyB9IH0sXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0pLFxuICAgICcvdHlwZXMvY2RrLm91dC9hc3NldHMuanNvbic6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgIHZlcnNpb246IE1hbmlmZXN0LnZlcnNpb24oKSxcbiAgICAgIGZpbGVzOiB7XG4gICAgICAgIHRoZVRleHRBc3NldDoge1xuICAgICAgICAgIHNvdXJjZToge1xuICAgICAgICAgICAgcGF0aDogJ3BsYWluX3RleHQudHh0JyxcbiAgICAgICAgICB9LFxuICAgICAgICAgIGRlc3RpbmF0aW9uczogeyB0aGVEZXN0aW5hdGlvbjogeyAuLi5ERUZBVUxUX0RFU1RJTkFUSU9OLCBvYmplY3RLZXk6ICdzb21lX2tleS50eHQnIH0gfSxcbiAgICAgICAgfSxcbiAgICAgICAgdGhlSW1hZ2VBc3NldDoge1xuICAgICAgICAgIHNvdXJjZToge1xuICAgICAgICAgICAgcGF0aDogJ2ltYWdlLnBuZycsXG4gICAgICAgICAgfSxcbiAgICAgICAgICBkZXN0aW5hdGlvbnM6IHsgdGhlRGVzdGluYXRpb246IHsgLi4uREVGQVVMVF9ERVNUSU5BVElPTiwgb2JqZWN0S2V5OiAnc29tZV9rZXkucG5nJyB9IH0sXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0pLFxuICAgICcvdHlwZXMvY2RrLm91dC9wbGFpbl90ZXh0LnR4dCc6ICdGSUxFX0NPTlRFTlRTJyxcbiAgICAnL3R5cGVzL2Nkay5vdXQvaW1hZ2UucG5nJzogJ0ZJTEVfQ09OVEVOVFMnLFxuICAgICcvZW1wdHl6aXAvY2RrLm91dC9hc3NldHMuanNvbic6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgIHZlcnNpb246IE1hbmlmZXN0LnZlcnNpb24oKSxcbiAgICAgIGZpbGVzOiB7XG4gICAgICAgIHRoZVRleHRBc3NldDoge1xuICAgICAgICAgIHNvdXJjZToge1xuICAgICAgICAgICAgcGF0aDogJ2VtcHR5X2RpcicsXG4gICAgICAgICAgICBwYWNrYWdpbmc6ICd6aXAnLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgZGVzdGluYXRpb25zOiB7IHRoZURlc3RpbmF0aW9uOiBERUZBVUxUX0RFU1RJTkFUSU9OIH0sXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0pLFxuICAgICcvZW1wdHl6aXAvY2RrLm91dC9lbXB0eV9kaXInOiB7IH0sIC8vIEVtcHR5IGRpcmVjdG9yeVxuICB9KTtcblxuICBhd3MgPSBtb2NrQXdzKCk7XG59KTtcblxuYWZ0ZXJFYWNoKCgpID0+IHtcbiAgbW9ja2ZzLnJlc3RvcmUoKTtcbn0pO1xuXG50ZXN0KCdwYXNzIGRlc3RpbmF0aW9uIHByb3BlcnRpZXMgdG8gQVdTIGNsaWVudCcsIGFzeW5jICgpID0+IHtcbiAgY29uc3QgcHViID0gbmV3IEFzc2V0UHVibGlzaGluZyhBc3NldE1hbmlmZXN0LmZyb21QYXRoKCcvc2ltcGxlL2Nkay5vdXQnKSwgeyBhd3MsIHRocm93T25FcnJvcjogZmFsc2UgfSk7XG4gIGF3cy5tb2NrUzMubGlzdE9iamVjdHNWMiA9IG1vY2tlZEFwaVJlc3VsdCh7fSk7XG5cbiAgYXdhaXQgcHViLnB1Ymxpc2goKTtcblxuICBleHBlY3QoYXdzLnMzQ2xpZW50KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgcmVnaW9uOiAndXMtbm9ydGgtNTAnLFxuICAgIGFzc3VtZVJvbGVBcm46ICdhcm46YXdzOnJvbGUnLFxuICB9KSk7XG59KTtcblxudGVzdCgnRG8gbm90aGluZyBpZiBmaWxlIGFscmVhZHkgZXhpc3RzJywgYXN5bmMgKCkgPT4ge1xuICBjb25zdCBwdWIgPSBuZXcgQXNzZXRQdWJsaXNoaW5nKEFzc2V0TWFuaWZlc3QuZnJvbVBhdGgoJy9zaW1wbGUvY2RrLm91dCcpLCB7IGF3cyB9KTtcblxuICBhd3MubW9ja1MzLmxpc3RPYmplY3RzVjIgPSBtb2NrZWRBcGlSZXN1bHQoeyBDb250ZW50czogW3sgS2V5OiAnc29tZV9rZXknIH1dIH0pO1xuICBhd3MubW9ja1MzLnVwbG9hZCA9IG1vY2tVcGxvYWQoKTtcbiAgYXdhaXQgcHViLnB1Ymxpc2goKTtcblxuICBleHBlY3QoYXdzLm1vY2tTMy5saXN0T2JqZWN0c1YyKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgQnVja2V0OiAnc29tZV9idWNrZXQnLFxuICAgIFByZWZpeDogJ3NvbWVfa2V5JyxcbiAgICBNYXhLZXlzOiAxLFxuICB9KSk7XG4gIGV4cGVjdChhd3MubW9ja1MzLnVwbG9hZCkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcbn0pO1xuXG50ZXN0KCd0aW55IGZpbGUgZG9lcyBub3QgY291bnQgYXMgY2FjaGUgaGl0JywgYXN5bmMgKCkgPT4ge1xuICBjb25zdCBwdWIgPSBuZXcgQXNzZXRQdWJsaXNoaW5nKEFzc2V0TWFuaWZlc3QuZnJvbVBhdGgoJy9zaW1wbGUvY2RrLm91dCcpLCB7IGF3cyB9KTtcblxuICBhd3MubW9ja1MzLmxpc3RPYmplY3RzVjIgPSBtb2NrZWRBcGlSZXN1bHQoeyBDb250ZW50czogW3sgS2V5OiAnc29tZV9rZXknLCBTaXplOiA1IH1dIH0pO1xuICBhd3MubW9ja1MzLnVwbG9hZCA9IG1vY2tVcGxvYWQoKTtcblxuICBhd2FpdCBwdWIucHVibGlzaCgpO1xuXG4gIGV4cGVjdChhd3MubW9ja1MzLnVwbG9hZCkudG9IYXZlQmVlbkNhbGxlZCgpO1xufSk7XG5cbnRlc3QoJ3VwbG9hZCBmaWxlIGlmIG5ldyAobGlzdCByZXR1cm5zIG90aGVyIGtleSknLCBhc3luYyAoKSA9PiB7XG4gIGNvbnN0IHB1YiA9IG5ldyBBc3NldFB1Ymxpc2hpbmcoQXNzZXRNYW5pZmVzdC5mcm9tUGF0aCgnL3NpbXBsZS9jZGsub3V0JyksIHsgYXdzIH0pO1xuXG4gIGF3cy5tb2NrUzMubGlzdE9iamVjdHNWMiA9IG1vY2tlZEFwaVJlc3VsdCh7IENvbnRlbnRzOiBbeyBLZXk6ICdzb21lX2tleS5idXRfbm90X3RoZV9vbmUnIH1dIH0pO1xuICBhd3MubW9ja1MzLnVwbG9hZCA9IG1vY2tVcGxvYWQoJ0ZJTEVfQ09OVEVOVFMnKTtcblxuICBhd2FpdCBwdWIucHVibGlzaCgpO1xuXG4gIGV4cGVjdChhd3MubW9ja1MzLnVwbG9hZCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgIEJ1Y2tldDogJ3NvbWVfYnVja2V0JyxcbiAgICBLZXk6ICdzb21lX2tleScsXG4gICAgQ29udGVudFR5cGU6ICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nLFxuICB9KSk7XG5cbiAgLy8gV2UnbGwganVzdCBoYXZlIHRvIGFzc3VtZSB0aGUgY29udGVudHMgYXJlIGNvcnJlY3Rcbn0pO1xuXG50ZXN0KCd1cGxvYWQgd2l0aCBzZXJ2ZXIgc2lkZSBlbmNyeXB0aW9uIEFFUzI1NiBoZWFkZXInLCBhc3luYyAoKSA9PiB7XG4gIGNvbnN0IHB1YiA9IG5ldyBBc3NldFB1Ymxpc2hpbmcoQXNzZXRNYW5pZmVzdC5mcm9tUGF0aCgnL3NpbXBsZS9jZGsub3V0JyksIHsgYXdzIH0pO1xuXG4gIGF3cy5tb2NrUzMuZ2V0QnVja2V0RW5jcnlwdGlvbiA9IG1vY2tlZEFwaVJlc3VsdCh7XG4gICAgU2VydmVyU2lkZUVuY3J5cHRpb25Db25maWd1cmF0aW9uOiB7XG4gICAgICBSdWxlczogW1xuICAgICAgICB7XG4gICAgICAgICAgQXBwbHlTZXJ2ZXJTaWRlRW5jcnlwdGlvbkJ5RGVmYXVsdDoge1xuICAgICAgICAgICAgU1NFQWxnb3JpdGhtOiAnQUVTMjU2JyxcbiAgICAgICAgICB9LFxuICAgICAgICAgIEJ1Y2tldEtleUVuYWJsZWQ6IGZhbHNlLFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICB9LFxuICB9KTtcbiAgYXdzLm1vY2tTMy5saXN0T2JqZWN0c1YyID0gbW9ja2VkQXBpUmVzdWx0KHsgQ29udGVudHM6IFt7IEtleTogJ3NvbWVfa2V5LmJ1dF9ub3RfdGhlX29uZScgfV0gfSk7XG4gIGF3cy5tb2NrUzMudXBsb2FkID0gbW9ja1VwbG9hZCgnRklMRV9DT05URU5UUycpO1xuXG4gIGF3YWl0IHB1Yi5wdWJsaXNoKCk7XG5cbiAgZXhwZWN0KGF3cy5tb2NrUzMudXBsb2FkKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgQnVja2V0OiAnc29tZV9idWNrZXQnLFxuICAgIEtleTogJ3NvbWVfa2V5JyxcbiAgICBDb250ZW50VHlwZTogJ2FwcGxpY2F0aW9uL29jdGV0LXN0cmVhbScsXG4gICAgU2VydmVyU2lkZUVuY3J5cHRpb246ICdBRVMyNTYnLFxuICB9KSk7XG5cbiAgLy8gV2UnbGwganVzdCBoYXZlIHRvIGFzc3VtZSB0aGUgY29udGVudHMgYXJlIGNvcnJlY3Rcbn0pO1xuXG50ZXN0KCd1cGxvYWQgd2l0aCBzZXJ2ZXIgc2lkZSBlbmNyeXB0aW9uIGF3czprbXMgaGVhZGVyIGFuZCBrZXkgaWQnLCBhc3luYyAoKSA9PiB7XG4gIGNvbnN0IHB1YiA9IG5ldyBBc3NldFB1Ymxpc2hpbmcoQXNzZXRNYW5pZmVzdC5mcm9tUGF0aCgnL3NpbXBsZS9jZGsub3V0JyksIHsgYXdzIH0pO1xuXG4gIGF3cy5tb2NrUzMuZ2V0QnVja2V0RW5jcnlwdGlvbiA9IG1vY2tlZEFwaVJlc3VsdCh7XG4gICAgU2VydmVyU2lkZUVuY3J5cHRpb25Db25maWd1cmF0aW9uOiB7XG4gICAgICBSdWxlczogW1xuICAgICAgICB7XG4gICAgICAgICAgQXBwbHlTZXJ2ZXJTaWRlRW5jcnlwdGlvbkJ5RGVmYXVsdDoge1xuICAgICAgICAgICAgU1NFQWxnb3JpdGhtOiAnYXdzOmttcycsXG4gICAgICAgICAgICBLTVNNYXN0ZXJLZXlJRDogJ3RoZS1rZXktaWQnLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgQnVja2V0S2V5RW5hYmxlZDogZmFsc2UsXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgIH0sXG4gIH0pO1xuXG4gIGF3cy5tb2NrUzMubGlzdE9iamVjdHNWMiA9IG1vY2tlZEFwaVJlc3VsdCh7IENvbnRlbnRzOiBbeyBLZXk6ICdzb21lX2tleS5idXRfbm90X3RoZV9vbmUnIH1dIH0pO1xuICBhd3MubW9ja1MzLnVwbG9hZCA9IG1vY2tVcGxvYWQoJ0ZJTEVfQ09OVEVOVFMnKTtcblxuICBhd2FpdCBwdWIucHVibGlzaCgpO1xuXG4gIGV4cGVjdChhd3MubW9ja1MzLnVwbG9hZCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgIEJ1Y2tldDogJ3NvbWVfYnVja2V0JyxcbiAgICBLZXk6ICdzb21lX2tleScsXG4gICAgQ29udGVudFR5cGU6ICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nLFxuICAgIFNlcnZlclNpZGVFbmNyeXB0aW9uOiAnYXdzOmttcycsXG4gICAgU1NFS01TS2V5SWQ6ICd0aGUta2V5LWlkJyxcbiAgfSkpO1xuXG4gIC8vIFdlJ2xsIGp1c3QgaGF2ZSB0byBhc3N1bWUgdGhlIGNvbnRlbnRzIGFyZSBjb3JyZWN0XG59KTtcblxudGVzdCgnd2lsbCBvbmx5IHJlYWQgYnVja2V0RW5jcnlwdGlvbiBvbmNlIGV2ZW4gZm9yIG11bHRpcGxlIGFzc2V0cycsIGFzeW5jICgpID0+IHtcbiAgY29uc3QgcHViID0gbmV3IEFzc2V0UHVibGlzaGluZyhBc3NldE1hbmlmZXN0LmZyb21QYXRoKCcvdHlwZXMvY2RrLm91dCcpLCB7IGF3cyB9KTtcblxuICBhd3MubW9ja1MzLmxpc3RPYmplY3RzVjIgPSBtb2NrZWRBcGlSZXN1bHQoeyBDb250ZW50czogW3sgS2V5OiAnc29tZV9rZXkuYnV0X25vdF90aGVfb25lJyB9XSB9KTtcbiAgYXdzLm1vY2tTMy51cGxvYWQgPSBtb2NrVXBsb2FkKCdGSUxFX0NPTlRFTlRTJyk7XG5cbiAgYXdhaXQgcHViLnB1Ymxpc2goKTtcblxuICBleHBlY3QoYXdzLm1vY2tTMy51cGxvYWQpLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygyKTtcbiAgZXhwZWN0KGF3cy5tb2NrUzMuZ2V0QnVja2V0RW5jcnlwdGlvbikudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDEpO1xufSk7XG5cbnRlc3QoJ25vIHNlcnZlciBzaWRlIGVuY3J5cHRpb24gaGVhZGVyIGlmIGFjY2VzcyBkZW5pZWQgZm9yIGJ1Y2tldCBlbmNyeXB0aW9uJywgYXN5bmMgKCkgPT4ge1xuICBjb25zdCBwcm9ncmVzc0xpc3RlbmVyID0gbmV3IEZha2VMaXN0ZW5lcigpO1xuICBjb25zdCBwdWIgPSBuZXcgQXNzZXRQdWJsaXNoaW5nKEFzc2V0TWFuaWZlc3QuZnJvbVBhdGgoJy9zaW1wbGUvY2RrLm91dCcpLCB7IGF3cywgcHJvZ3Jlc3NMaXN0ZW5lciB9KTtcblxuICBhd3MubW9ja1MzLmdldEJ1Y2tldEVuY3J5cHRpb24gPSBtb2NrZWRBcGlGYWlsdXJlKCdBY2Nlc3NEZW5pZWQnLCAnQWNjZXNzIERlbmllZCcpO1xuXG4gIGF3cy5tb2NrUzMubGlzdE9iamVjdHNWMiA9IG1vY2tlZEFwaVJlc3VsdCh7IENvbnRlbnRzOiBbeyBLZXk6ICdzb21lX2tleS5idXRfbm90X3RoZV9vbmUnIH1dIH0pO1xuICBhd3MubW9ja1MzLnVwbG9hZCA9IG1vY2tVcGxvYWQoJ0ZJTEVfQ09OVEVOVFMnKTtcblxuICBhd2FpdCBwdWIucHVibGlzaCgpO1xuXG4gIGV4cGVjdChhd3MubW9ja1MzLnVwbG9hZCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoZXhwZWN0Lm5vdC5vYmplY3RDb250YWluaW5nKHtcbiAgICBTZXJ2ZXJTaWRlRW5jcnlwdGlvbjogJ2F3czprbXMnLFxuICB9KSk7XG5cbiAgZXhwZWN0KGF3cy5tb2NrUzMudXBsb2FkKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChleHBlY3Qubm90Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgIFNlcnZlclNpZGVFbmNyeXB0aW9uOiAnQUVTMjU2JyxcbiAgfSkpO1xufSk7XG5cbnRlc3QoJ2NvcnJlY3RseSBsb29rcyB1cCBjb250ZW50IHR5cGUnLCBhc3luYyAoKSA9PiB7XG4gIGNvbnN0IHB1YiA9IG5ldyBBc3NldFB1Ymxpc2hpbmcoQXNzZXRNYW5pZmVzdC5mcm9tUGF0aCgnL3R5cGVzL2Nkay5vdXQnKSwgeyBhd3MgfSk7XG5cbiAgYXdzLm1vY2tTMy5saXN0T2JqZWN0c1YyID0gbW9ja2VkQXBpUmVzdWx0KHsgQ29udGVudHM6IFt7IEtleTogJ3NvbWVfa2V5LmJ1dF9ub3RfdGhlX29uZScgfV0gfSk7XG4gIGF3cy5tb2NrUzMudXBsb2FkID0gbW9ja1VwbG9hZCgnRklMRV9DT05URU5UUycpO1xuXG4gIGF3YWl0IHB1Yi5wdWJsaXNoKCk7XG5cbiAgZXhwZWN0KGF3cy5tb2NrUzMudXBsb2FkKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgQnVja2V0OiAnc29tZV9idWNrZXQnLFxuICAgIEtleTogJ3NvbWVfa2V5LnR4dCcsXG4gICAgQ29udGVudFR5cGU6ICd0ZXh0L3BsYWluJyxcbiAgfSkpO1xuXG4gIGV4cGVjdChhd3MubW9ja1MzLnVwbG9hZCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgIEJ1Y2tldDogJ3NvbWVfYnVja2V0JyxcbiAgICBLZXk6ICdzb21lX2tleS5wbmcnLFxuICAgIENvbnRlbnRUeXBlOiAnaW1hZ2UvcG5nJyxcbiAgfSkpO1xuXG4gIC8vIFdlJ2xsIGp1c3QgaGF2ZSB0byBhc3N1bWUgdGhlIGNvbnRlbnRzIGFyZSBjb3JyZWN0XG59KTtcblxudGVzdCgndXBsb2FkIGZpbGUgaWYgbmV3IChsaXN0IHJldHVybnMgbm8ga2V5KScsIGFzeW5jICgpID0+IHtcbiAgY29uc3QgcHViID0gbmV3IEFzc2V0UHVibGlzaGluZyhBc3NldE1hbmlmZXN0LmZyb21QYXRoKCcvc2ltcGxlL2Nkay5vdXQnKSwgeyBhd3MgfSk7XG5cbiAgYXdzLm1vY2tTMy5saXN0T2JqZWN0c1YyID0gbW9ja2VkQXBpUmVzdWx0KHsgQ29udGVudHM6IHVuZGVmaW5lZCB9KTtcbiAgYXdzLm1vY2tTMy51cGxvYWQgPSBtb2NrVXBsb2FkKCdGSUxFX0NPTlRFTlRTJyk7XG5cbiAgYXdhaXQgcHViLnB1Ymxpc2goKTtcblxuICBleHBlY3QoYXdzLm1vY2tTMy51cGxvYWQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcbiAgICBCdWNrZXQ6ICdzb21lX2J1Y2tldCcsXG4gICAgS2V5OiAnc29tZV9rZXknLFxuICB9KSk7XG5cbiAgLy8gV2UnbGwganVzdCBoYXZlIHRvIGFzc3VtZSB0aGUgY29udGVudHMgYXJlIGNvcnJlY3Rcbn0pO1xuXG50ZXN0KCdzdWNjZXNzZnVsIHJ1biBkb2VzIG5vdCBuZWVkIHRvIHF1ZXJ5IGFjY291bnQgSUQnLCBhc3luYyAoKSA9PiB7XG4gIGNvbnN0IHB1YiA9IG5ldyBBc3NldFB1Ymxpc2hpbmcoQXNzZXRNYW5pZmVzdC5mcm9tUGF0aCgnL3NpbXBsZS9jZGsub3V0JyksIHsgYXdzIH0pO1xuXG4gIGF3cy5tb2NrUzMubGlzdE9iamVjdHNWMiA9IG1vY2tlZEFwaVJlc3VsdCh7IENvbnRlbnRzOiB1bmRlZmluZWQgfSk7XG4gIGF3cy5tb2NrUzMudXBsb2FkID0gbW9ja1VwbG9hZCgnRklMRV9DT05URU5UUycpO1xuXG4gIGF3YWl0IHB1Yi5wdWJsaXNoKCk7XG5cbiAgZXhwZWN0KGF3cy5kaXNjb3ZlckN1cnJlbnRBY2NvdW50KS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xuICBleHBlY3QoYXdzLmRpc2NvdmVyVGFyZ2V0QWNjb3VudCkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcbn0pO1xuXG50ZXN0KCdjb3JyZWN0bHkgaWRlbnRpZnkgYXNzZXQgcGF0aCBpZiBwYXRoIGlzIGFic29sdXRlJywgYXN5bmMgKCkgPT4ge1xuICBjb25zdCBwdWIgPSBuZXcgQXNzZXRQdWJsaXNoaW5nKEFzc2V0TWFuaWZlc3QuZnJvbVBhdGgoJy9hYnMvY2RrLm91dCcpLCB7IGF3cyB9KTtcblxuICBhd3MubW9ja1MzLmxpc3RPYmplY3RzVjIgPSBtb2NrZWRBcGlSZXN1bHQoeyBDb250ZW50czogdW5kZWZpbmVkIH0pO1xuICBhd3MubW9ja1MzLnVwbG9hZCA9IG1vY2tVcGxvYWQoJ0ZJTEVfQ09OVEVOVFMnKTtcblxuICBhd2FpdCBwdWIucHVibGlzaCgpO1xuXG4gIGV4cGVjdCh0cnVlKS50b0JlVHJ1dGh5KCk7IC8vIE5vIGV4Y2VwdGlvbiwgc2F0aXNmeSBsaW50ZXJcbn0pO1xuXG5kZXNjcmliZSgnZXh0ZXJuYWwgYXNzZXRzJywgKCkgPT4ge1xuICBsZXQgcHViOiBBc3NldFB1Ymxpc2hpbmc7XG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIHB1YiA9IG5ldyBBc3NldFB1Ymxpc2hpbmcoQXNzZXRNYW5pZmVzdC5mcm9tUGF0aCgnL2V4dGVybmFsL2Nkay5vdXQnKSwgeyBhd3MgfSk7XG4gIH0pO1xuXG4gIHRlc3QoJ2RvIG5vdGhpbmcgaWYgZmlsZSBleGlzdHMgYWxyZWFkeScsIGFzeW5jICgpID0+IHtcbiAgICBhd3MubW9ja1MzLmxpc3RPYmplY3RzVjIgPSBtb2NrZWRBcGlSZXN1bHQoeyBDb250ZW50czogW3sgS2V5OiAnc29tZV9rZXknIH1dIH0pO1xuXG4gICAgYXdhaXQgcHViLnB1Ymxpc2goKTtcblxuICAgIGV4cGVjdChhd3MubW9ja1MzLmxpc3RPYmplY3RzVjIpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcbiAgICAgIEJ1Y2tldDogJ3NvbWVfZXh0ZXJuYWxfYnVja2V0JyxcbiAgICAgIFByZWZpeDogJ3NvbWVfa2V5JyxcbiAgICAgIE1heEtleXM6IDEsXG4gICAgfSkpO1xuICB9KTtcblxuICB0ZXN0KCd1cGxvYWQgZXh0ZXJuYWwgYXNzZXQgY29ycmVjdGx5JywgYXN5bmMgKCkgPT4ge1xuICAgIGF3cy5tb2NrUzMubGlzdE9iamVjdHNWMiA9IG1vY2tlZEFwaVJlc3VsdCh7IENvbnRlbnRzOiB1bmRlZmluZWQgfSk7XG4gICAgYXdzLm1vY2tTMy51cGxvYWQgPSBtb2NrVXBsb2FkKCdaSVBfRklMRV9USEFUX0lTX0RFRklOSVRFTFlfTk9UX0VNUFRZJyk7XG4gICAgY29uc3QgZXhwZWN0QWxsU3Bhd25zID0gbW9ja1NwYXduKHsgY29tbWFuZExpbmU6IFsnc29tZXRvb2wnXSwgc3Rkb3V0OiBBQlNfUEFUSCB9KTtcblxuICAgIGF3YWl0IHB1Yi5wdWJsaXNoKCk7XG5cbiAgICBleHBlY3QoYXdzLnMzQ2xpZW50KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICByZWdpb246ICd1cy1ub3J0aC01MCcsXG4gICAgICBhc3N1bWVSb2xlQXJuOiAnYXJuOmF3czpyb2xlJyxcbiAgICB9KSk7XG5cbiAgICBleHBlY3RBbGxTcGF3bnMoKTtcbiAgfSk7XG59KTtcbiJdfQ==