<h1 id="getting-started-with-the-cdk">Getting Started with the |cdk|</h1>
<p>This topic walks you through creating and deploying your first |cdk| app.</p>
<h2 id="setup">Setup</h2>
<h3 id="prerequisites">Prerequisites</h3>
<p><a href="https://nodejs.org/en/download">Node.js (&gt;= 8.11.x)</a> - required for the command-line toolkit and language bindings.</p>
<p><a href="https://aws.amazon.com/cli">AWS CLI</a> - recommended in general, and can be used to setup the credentials &lt;credentials&gt; for your AWS account.</p>
<h3 id="install-the-command-line-toolkit">Install the command-line toolkit</h3>
<p>Install the toolkit using the following <a href="https://www.npmjs.org">npm</a> command.</p>
<pre class="sourceCode sh"><code>npm install -g aws-cdk</code></pre>
<p>After you've installed the toolkit, run the following command to see the currently installed version of the toolkit.</p>
<pre class="sourceCode sh"><code>cdk --version</code></pre>
<p>You should see |version|.</p>
<h2 id="creating-a-project">Creating a Project</h2>
<blockquote>
<p><strong>note</strong></p>
<p>This guide walks you through the manually creating a |cdk| project. See Using cdk init to Create a Project_ for instructions on using the <code class="sourceCode">cdk init</code> command to create a project from a template in any of the supported languages.</p>
</blockquote>
<p>Create an empty project structure for the |cdk| app.</p>
<h2 id="add-aws-cdkcdk-as-a-dependency">Add @aws-cdk/cdk as a Dependency</h2>
<p>Install the |cdk| core library (:py@aws-cdk/cdk). This library includes the basic classes needed to write |cdk| stacks and apps.</p>
<h2 id="define-the-cdk-app">Define the |cdk| App</h2>
<p>|cdk| apps are modeled as classes which extend the :pyApp &lt;@aws-cdk/cdk.App&gt; class. Let's create our first, empty <strong>App</strong>:</p>
<blockquote>
<p><strong>note</strong></p>
<dl>
<dt>The code that reads <strong>argv</strong>, runs the app and writes the output to <strong>STDOUT</strong> is</dt>
<dd><p>currently needed in order to allow the |cdk| Toolkit to interact with your app.</p>
</dd>
</dl>
</blockquote>
<h2 id="compiling-the-code">Compiling the Code</h2>
<p>If needed, compile the code:</p>
<p>You have now created an empty |cdk| app.</p>
<h2 id="configure-the-cdk-toolkit">Configure the |cdk| Toolkit</h2>
<p>Use the |cdk| toolkit to view the contents of this app.</p>
<blockquote>
<p><strong>note</strong></p>
<p>You must specify your default credentials and region to use the toolkit.</p>
<p>Use the <a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-welcome.html">AWS Command Line Interface</a> <code>aws configure</code> command to specify your default credentials and region.</p>
<p>Important: make sure that you explicitly specify a <strong>region</strong>.</p>
<p>You can also set environment variables for your default credentials and region. Environment variables take precedence over settings in the credentials or config file.</p>
<ul>
<li><em>AWS_ACCESS_KEY_ID</em> specifies your access key</li>
<li><em>AWS_SECRET_ACCESS_KEY</em> specifies your secret access key</li>
<li><em>AWS_DEFAULT_REGION</em> specifies your default region</li>
</ul>
<p>See <a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-environment.html">Environment Variables</a> in the CLI User Guide for details.</p>
</blockquote>
<p>The |cdk| toolkit needs to know how to execute your |cdk| app. It requires that the <code class="sourceCode">--app</code> command-line option points to an executable program that adheres to the toolkit's protocol (this is what the <strong>ARGV/STDOUT</strong> boilerplate implements). Alternatively, to explicitly specifying <code class="sourceCode">--app</code> every time you use the toolkit, we recommend that you create a <code class="sourceCode">cdk.json</code> file at the root of your project directory:</p>
<h2 id="list-the-stacks-in-the-app">List the Stacks in the App</h2>
<p>Use the |cdk| toolkit's <strong>ls</strong> command to list the stacks in the app.</p>
<pre class="sourceCode sh"><code>cdk ls -l</code></pre>
<p>The result is an empty array:</p>
<pre class="sourceCode sh"><code>[]</code></pre>
<p>An empty array makes sense, since our app doesn't have any stacks.</p>
<h2 id="define-a-stack">Define a Stack</h2>
<p>Define a stack and add it to the app.</p>
<p>The initializer signature of <strong>cdk.Stack</strong> includes the arguments: <strong>parent</strong>, <strong>id</strong>, and <strong>props</strong>. This is the signature for every class in the |cdk| framework. These classes are called <strong>&quot;constructs&quot;</strong> and they are composed together into a tree:</p>
<ul>
<li><strong>parent</strong> represents the parent construct. By specifying the parent construct upon initialization, constructs can obtain contextual information when they are initialized. For example, the region a stack is deployed to can be obtained via a call to :pyStack.find(this).requireRegion() &lt;@aws-cdk/cdk.Stack.requireRegion&gt;. See context for more information.</li>
<li><strong>id</strong> is a string that locally identifies this construct within the tree. Constructs must have a unique ID amongst their siblings.</li>
<li><strong>props</strong> is the set of initialization properties for this construct.</li>
</ul>
<p>Compile your program:</p>
<p>Run <strong>cdk ls</strong> to see that the app includes a single stack:</p>
<pre class="sourceCode sh"><code>cdk ls -l
-
    name: hello-cdk
    environment:
        name: &lt;your-account-id&gt;/&lt;your-default-region&gt;
        account: &#39;&lt;your-account-id&gt;&#39;
        region: &lt;your-default-region&gt;</code></pre>
<p>Notice that your stack has been automatically associated with the default AWS account and region configured in the AWS CLI. See environments for more details on how to associate stacks to environments.</p>
<h2 id="define-an-s3-bucket">Define an |S3| Bucket</h2>
<p>Now, what can we do with this app? Nothing yet. Our stack is still empty, so there's nothing to deploy.</p>
<p>Let's define an |S3| bucket.</p>
<p>Install the <script type="text/javascript">
<!--
h='&#x61;&#x77;&#x73;&#x2d;&#x63;&#100;&#x6b;&#x2f;&#x61;&#x77;&#x73;&#x2d;&#x73;&#x33;&#42;';a='&#64;';n='&#42;&#42;';e=n+a+h;
document.write('<a h'+'ref'+'="ma'+'ilto'+':'+e+'" clas'+'s="em' + 'ail">'+e+'<\/'+'a'+'>');
// -->
</script><noscript>&#42;&#42;&#32;&#x61;&#116;&#32;&#x61;&#x77;&#x73;&#x2d;&#x63;&#100;&#x6b;&#x2f;&#x61;&#x77;&#x73;&#x2d;&#x73;&#x33;&#42;</noscript>* package:</p>
<p>Next, define an |S3| bucket in the stack. |S3| buckets are represented by the :pyBucket &lt;@aws-cdk/aws-s3.Bucket&gt; class:</p>
<p>A few things to notice:</p>
<ul>
<li>:pyBucket &lt;@aws-cdk/aws-s3.Bucket&gt; is a construct. This means it's initialization signature has <strong>parent</strong>, <strong>id</strong>, and <strong>props</strong>. In this case, the bucket is an immediate child of <strong>MyStack</strong>.</li>
<li><code>MyFirstBucket</code> is the <strong>logical id</strong> of the bucket construct, <strong>not</strong> the physical name of the S3 bucket. The logical ID is used to uniquely identify resources in your stack across deployments. See logical-ids for more details on how to work with logical IDs. To specify a physical name for your bucket, you can set the :pybucketName &lt;@aws-cdk/aws-s3.BucketProps.bucketName&gt; property when you define your bucket.</li>
<li>Since the bucket's :pyversioned &lt;@aws-cdk/aws-s3.BucketProps.versioned&gt; property is <code class="sourceCode">true</code>, <a href="https://docs.aws.amazon.com/AmazonS3/latest/dev/Versioning.html">versioning</a> is enabled on the bucket.</li>
</ul>
<p>Compile your program:</p>
<h2 id="synthesize-an-cfn-template">Synthesize an |CFN| Template</h2>
<p>Synthesize a |cfn| template for the stack:</p>
<pre class="sourceCode sh"><code>cdk synth hello-cdk</code></pre>
<blockquote>
<p><strong>note</strong></p>
<p>Since the |cdk| app only contains a single stack, you can omit <code class="sourceCode">hello-cdk</code>.</p>
</blockquote>
<p>This command executes the |cdk| app and synthesize an |CFN| template for the <strong>hello-cdk</strong> stack:</p>
<div class="sourceCode"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span class="fu">Resources:</span>
    <span class="fu">MyFirstBucketB8884501:</span>
        <span class="fu">Type:</span> <span class="st">&#39;AWS::S3::Bucket&#39;</span>
        <span class="fu">Properties:</span>
            <span class="fu">VersioningConfiguration:</span>
                <span class="fu">Status:</span> Enabled
    <span class="fu">CDKMetadata:</span>
        <span class="fu">Type:</span> <span class="st">&#39;AWS::CDK::Metadata&#39;</span>
        <span class="fu">Properties:</span>
            <span class="fu">Modules:</span> <span class="co"># ...</span></code></pre></div>
<p>You can see that the stack contains an <strong>AWS::S3::Bucket</strong> resource with the desired versioning configuration.</p>
<blockquote>
<p><strong>note</strong></p>
<p>The <strong>AWS::CDK::Metadata</strong> resource was automatically added to your template by the toolkit. This allows us to learn which libraries were used in your stack. See version-reporting for more details and how to opt-out &lt;version-reporting-opt-out&gt;.</p>
</blockquote>
<h2 id="deploying-the-stack">Deploying the Stack</h2>
<p>Use <strong>cdk deploy</strong> to deploy the stack:</p>
<pre class="sourceCode sh"><code>cdk deploy</code></pre>
<p>The <strong>deploy</strong> command synthesizes an |CFN| template from the stack and then invokes the |CFN| create/update API to deploy it into your AWS account. The command displays information as it progresses.</p>
<h2 id="modifying-the-code">Modifying the Code</h2>
<p>Configure the bucket to use KMS managed encryption:</p>
<p>Compile the program:</p>
<h2 id="preparing-for-deployment">Preparing for Deployment</h2>
<p>Before you deploy the updated stack, use the <code>cdk diff</code> command to evaluate the difference between the |cdk| app and the deployed stack:</p>
<pre class="sourceCode sh"><code>cdk diff</code></pre>
<p>The toolkit queries your AWS account for the current |CFN| template for the <strong>hello-cdk</strong> stack, and compares the result with the template synthesized from the app. The output should look like the following:</p>
<pre class="sourceCode sh"><code>[~] 🛠 Updating MyFirstBucketB8884501 (type: AWS::S3::Bucket)
└─ [+] .BucketEncryption:
    └─ New value: {&quot;ServerSideEncryptionConfiguration&quot;:[{&quot;ServerSideEncryptionByDefault&quot;:{&quot;SSEAlgorithm&quot;:&quot;aws:kms&quot;}}]}</code></pre>
<p>As you can see, the diff indicates that the <strong>ServerSideEncryptionConfiguration</strong> property of the bucket is now set to enable server-side encryption.</p>
<p>You can also see that the bucket is not going to be replaced but rather updated (&quot;<strong>Updating MyFirstBucketB8884501</strong>&quot;).</p>
<p>Run <strong>cdk deploy</strong> to update the stack:</p>
<pre class="sourceCode sh"><code>cdk deploy</code></pre>
<p>The toolkit updates the bucket configuration to enable server-side KMS encryption for the bucket:</p>
<pre class="sourceCode sh"><code>⏳  Starting deployment of stack hello-cdk...
[0/2] UPDATE_IN_PROGRESS  [AWS::S3::Bucket] MyFirstBucketB8884501
[1/2] UPDATE_COMPLETE     [AWS::S3::Bucket] MyFirstBucketB8884501
[1/2] UPDATE_COMPLETE_CLEANUP_IN_PROGRESS  [AWS::CloudFormation::Stack] hello-cdk
[2/2] UPDATE_COMPLETE     [AWS::CloudFormation::Stack] hello-cdk
✅  Deployment of stack hello-cdk completed successfully</code></pre>
<h2 id="using-cdk-init-to-create-a-project">Using cdk init to Create a Project</h2>
<p>If you've already created your project using the previous, manual steps, you can skip these instructions and continue on with Compiling the Code_.</p>
<p>Create the directory for your project, and navigate into that directory.</p>
<pre class="sourceCode sh"><code>mkdir hello-cdk
cd hello-cdk</code></pre>
<p>You now have an |cdk| app.</p>
<ul>
<li>To compile your code, if required, see Compiling the Code_</li>
<li>To list the stacks in your app, see List the Stacks in the App_</li>
<li>To synthesize an |CFN| template, see Synthesize an |CFN| Template_</li>
<li>To deploy your stack (create your AWS resources), see Deploying the Stack_</li>
</ul>
<h2 id="what-next">What Next?</h2>
<blockquote>
<ul>
<li>Learn more about CDK Concepts &lt;concepts&gt;</li>
<li>Check out the <a href="https://github.com/awslabs/aws-cdk/tree/master/examples">examples directory</a> in your GitHub repository</li>
<li>Learn about the rich APIs offered by the AWS Construct Library &lt;aws-construct-lib&gt;</li>
<li>Work directly with CloudFormation using the AWS CloudFormation Library &lt;cloudformation&gt;</li>
<li>Come talk to us on <a href="https://gitter.im/awslabs/aws-cdk">Gitter</a></li>
</ul>
</blockquote>
