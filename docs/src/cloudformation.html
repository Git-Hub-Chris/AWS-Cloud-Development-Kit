<h1 id="aws-cloudformation-library">AWS CloudFormation Library</h1>
<p>The AWS Construct Library includes constructs with rich APIs for defining AWS infrastructure. For example, the :py@aws-cdk/aws-s3.Bucket construct can be used to define S3 Buckets, the :py@aws-cdk/aws-sns.Topic construct can be used to define SNS Topics, etc.</p>
<p>Under the hood, these constructs are implemented using CloudFormation resources, which are available under the <strong>cloudformation</strong> namespace of each library. For example, the :py@aws-cdk/aws-s3.Bucket construct uses the :py@aws-cdk/aws-s3.cloudformation.BucketResource resource (as well as other resources, depending on what bucket APIs are used).</p>
<blockquote>
<p><strong>important</strong></p>
<p>Generally, when building CDK apps, you shouldn't need to interact with CloudFormation directly. However, there might be advanced use cases and migration scenarios where this might be required. We are also aware that there might be gaps in capabilities in the AWS Construct Library over time.</p>
</blockquote>
<h2 id="resources">Resources</h2>
<p>CloudFormation resource classes are automatically generated from the <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/cfn-resource-specification.html">AWS CloudFormation Resource Specification</a> and available under the <strong>cloudformation</strong> namespace of each AWS library. Their API matches 1:1 with how you would use these resources in CloudFormation.</p>
<p>When defining CloudFormation resource, the <strong>props</strong> argument of the class initializer will match 1:1 to the resource's properties in CloudFormation.</p>
<p>For example, to define an <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-sqs-queues.html">AWS::SQS::Queue</a> resource encrypted with an AWS managed key you can directly specify the <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-sqs-queues.html#aws-sqs-queue-kmsmasterkeyid">KmsMasterKeyId</a> property.</p>
<pre class="sourceCode js"><code>import { cloudformation } from &#39;@aws-cdk/aws-sqs&#39;;

new cloudformation.QueueResource(this, &#39;MyQueueResource&#39;, {
    kmsMasterKeyId: &#39;alias/aws/sqs&#39;
});</code></pre>
<p>For reference, if you use the :py@aws-cdk/aws-sqs.Queue construct, you can define managed queue encryption as follows:</p>
<pre class="sourceCode js"><code>import sqs = require(&#39;@aws-cdk/aws-sqs&#39;);

new sqs.Queue(this, &#39;MyQueue&#39;, {
    encryption: sqs.QueueEncryption.KmsManaged
});</code></pre>
<h3 id="resource-attributes">Resource Attributes</h3>
<p>To reference the runtime attributes of CloudFormation resources, use one of the properties available on the resource object.</p>
<p>The following example configures a |LAM| function's dead letter queue to use a the ARN of an |SQS| queue resource.</p>
<pre class="sourceCode js"><code>import { cloudformation as sqscfn } from &#39;@aws-cdk/aws-sqs&#39;;
import { cloudformation as lambdacfn } from &#39;@aws-cdk/aws-lambda&#39;;

const dlq = new sqscfn.QueueResource(this, { name: &#39;DLQ&#39; });

new lambdacfn.FunctionResource(this, {
   deadLetterConfig: {
      targetArn: dlq.queueArn
   }
});</code></pre>
<p>The :py@aws-cdk/cdk.Resource.ref attribute represents the |cfn| resource's intrinsic reference (or &quot;Return Value&quot;). For example, for dlq.ref will also <a href="http://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-sqs-queues.html#aws-properties-sqs-queues-ref">refer</a> to the queue's ARN. When possible, it is preferrable to use an explicitly named attribute instead of <em>ref</em>.</p>
<h3 id="resource-options">Resource Options</h3>
<p>The :py@aws-cdk/cdk.Resource.options object includes |CFN| options, such as <code class="sourceCode">condition</code>, <code class="sourceCode">updatePolicy</code>, <code class="sourceCode">createPolicy</code> and <code class="sourceCode">metadata</code>, for a resource.</p>
<h3 id="parameters">Parameters</h3>
<pre class="sourceCode js"><code>import { cloudformation } from &#39;@aws-cdk/aws-sns&#39;;
import cdk = require(&#39;@aws-cdk/cdk&#39;);

const p = new cdk.Parameter(this, &#39;MyParam&#39;, { type: &#39;String&#39; });
new cloudformation.TopicResource(this, &#39;MyTopic&#39;, { displayName: p.ref });</code></pre>
<h3 id="outputs">Outputs</h3>
<pre class="sourceCode js"><code>import { cloudformation } from &#39;@aws-cdk/aws-sqs&#39;;
import cdk = require(&#39;@aws-cdk/cdk&#39;);

const queue = new cloudformation.QueueResource(this, &#39;MyQueue&#39;);
const out = new cdk.Output(this, &#39;MyQueueArn&#39;, { value: queue.queueArn });

const import = out.makeImportValue();
assert(import === { &quot;Fn::ImportValue&quot;: out.exportName }</code></pre>
<h3 id="conditions">Conditions</h3>
<pre class="sourceCode js"><code>import { cloudformation } from &#39;@aws-cdk/aws-sqs&#39;;
import cdk = require(&#39;@aws-cdk/cdk&#39;);
const cond = new cdk.Condition(this, &#39;MyCondition&#39;, {
    expression: new cdk.FnIf(...)
});

const queue = new cloudformation.QueueResource(this, &#39;MyQueue&#39;);
queue.options.condition = cond;</code></pre>
<h3 id="intrinsic-functions">Intrinsic Functions</h3>
<pre class="sourceCode js"><code>import cdk = require(&#39;@aws-cdk/cdk&#39;);
new cdk.FnJoin(&quot;,&quot;, [...])</code></pre>
<h3 id="pseudo-parameters">Pseudo Parameters</h3>
<pre class="sourceCode js"><code>import cdk = require(&#39;@aws-cdk/cdk&#39;);
new cdk.AwsRegion()</code></pre>
<h2 id="creating-a-higher-level-resource">Creating a Higher-Level Resource</h2>
<p>There may be times when the only |cdk| resource available is a basic |l1| resource. In this section we describe how to create your own, higher-level resource from a basic resource. This resource needs a role ARN so that it can perform actions in your behalf, so we'll create one.</p>
<p>The following example uses placeholders for some values:</p>
<ul>
<li><strong>MyResource</strong> is the name of the class that represents a higher-level resource</li>
<li><em>RESOURCE_Name</em> is the name you give the resource</li>
<li><em>RESOURCE_Role</em> is the name you give the role</li>
<li><em>NAMESPACE</em> is the namespace for service principal for the resource, which you can find from <a href="https://docs.aws.amazon.com/general/latest/gr/aws-arns-and-namespaces.html#genref-aws-service-namespaces">AWS Service Namespaces</a></li>
<li><em>RESOURCE-TYPE</em> is the type of the resource, which you can find from <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-template-resource-type-ref.html">AWS Resource Types Reference</a></li>
<li><em>ARN-PROPERTY</em> is the property representing the ARN for the resource.</li>
</ul>
<p>Each <em>RESOURCE-TYPE</em> has different properties. You must set all required properties, otherwise deployments will fail. For resources that need an ARN to perform actions on your behalf, you must set the <em>ARN-ROLE-PROPERTY</em> property, otherwise you will get run-time errors.</p>
<p>Set other properties to customize the higher-level resource for your use case.</p>
<pre class="sourceCode js"><code>import cdk = require(&#39;@aws-cdk/cdk&#39;);
import iam = require(&#39;@aws-cdk/aws-iam&#39;);

class MyResource extends cdk.Construct {
    constructor(parent: cdk.Construct, id: string) {
        super(parent, id);

        const role = new iam.Role(this, &#39;RESOURCE_Role&#39;, {
            assumeBy: new cdk.ServicePrincipal(&#39;NAMESPACE.amazonaws.com&#39;)
        });

        new cdk.Resource(this, &#39;RESOURCE_Name&#39;, {
            type: &#39;RESOURCE-TYPE&#39;,
            properties: {
                ARN-PROPERTY: role.roleArn,
                // ...
            }
        });
    }
}</code></pre>
